"use strict";var app=angular.module("celebrate-taste",["ngCookies","ngSanitize","ngComponentRouter","ui.bootstrap","ui.select","ngAnimate","toastr","ngFileUpload"]);app.value("$routerRootComponent","mainApp"),app.config(["$locationProvider","$httpProvider",function(e,t){e.html5Mode(!0),t.interceptors.push("authInterceptor")}]),app.config(["toastrConfig",function(e){angular.extend(e,{positionClass:"toast-top-center"})}]),app.run(["$rootScope","$location","userService","$window",function(e,t,n,r){e.$on("$routeChangeStart",function(e,r,o){r.authenticate&&!n.isLoggedIn&&(e.preventDefault(),t.path("/login"))}),e.$on("$routeChangeSuccess",function(n,o,i){o.hasOwnProperty("$$route")&&(e.pageTitle=o.$$route.title),r.ga&&r.ga("send","pageview",{page:t.path(),title:e.pageTitle})}),e.goBack=function(){r.history.back()}}]),function(){var e=angular.module("celebrate-taste");e.component("mainApp",{template:"\n            <lm-navbar></lm-navbar>\n            <ng-outlet></ng-outlet>\n        ",$routeConfig:[{path:"/admin",component:"home",name:"Home"},{path:"/admin/customerEmployees",component:"customerEmployeeList",name:"CustomerEmployeeList"},{path:"/admin/customerEmployees/create",component:"customerEmployee",name:"CustomerEmployeeCreate"},{path:"/admin/customerEmployees/:id",component:"customerEmployee",name:"CustomerEmployeeEdit",data:{action:"edit"}},{path:"/admin/users",component:"userList",name:"UserList"},{path:"/admin/users/create",component:"user",name:"UserCreate"},{path:"/admin/users/:id",component:"user",name:"UserEdit",data:{action:"edit"}},{path:"/admin/dishes",component:"dishList",name:"DishList"},{path:"/admin/dishes/create",component:"dish",name:"DishCreate"},{path:"/admin/dishes/:id",component:"dish",name:"DishEdit",data:{action:"edit"}},{path:"/admin/menus",component:"menuList",name:"MenuList"},{path:"/admin/menus/:menuId/dishes/:dishId",component:"editDishForMenu",name:"EditDishForMenu"},{path:"/admin/menus/:id/add",component:"addDishToMenu",name:"AddDishToMenu"},{path:"/admin/preferences",component:"preferenceList",name:"PreferenceList"},{path:"/admin/preferences/create",component:"addPreferences",name:"PreferenceCreate"},{path:"/admin/preferences/:id",component:"preference",name:"PreferenceEdit"},{path:"/admin/orders",component:"orderList",name:"OrderList"},{path:"/admin/orders/:id",component:"order",name:"OrderEdit"},{path:"/admin/orders/:id/orderLines/create",component:"orderLine",name:"OrderLineCreate"},{path:"/admin/orders/:id/orderLines/:id2",component:"orderLine",name:"OrderLineEdit",data:{action:"edit"}},{path:"/admin/orders/:id/orderLines/import",component:"orderLineImport",name:"OrderLineImport"},{path:"/admin/deliveries",component:"deliveryList",name:"PreferenceList"},{path:"/admin/deliveries/:id",component:"delivery",name:"DeliveryEdit"},{path:"/admin/deliveryLogs",component:"deliveryLogList",name:"DeliveryLogList"},{path:"/admin/partnerOrders",component:"partnerOrderList",name:"PartnerOrderList"},{path:"/admin/reviews",component:"reviewList",name:"ReviewList"},{path:"/admin/assignedNames",component:"assignedNameList",name:"AssignedNameList"},{path:"/admin/assignedNames/create",component:"assignedName",name:"AssignedNameCreate"},{path:"/admin/assignedNames/:id",component:"assignedName",name:"AssignedNameEdit",data:{action:"edit"}},{path:"/admin/badges",component:"badgeList",name:"BadgeList"}]})}(),function(){function e(e,n,r,o){function i(e,t){var n="assignedName";o.setAllFildsAsValid(t),o.required50(e,t,n,"badgeOwnerCode"),o.required50(e,t,n,"employeeId")}function a(){r.getById(t).then(function(e){c.assignedName=e})["catch"](function(e){alert(JSON.stringify(e,null,4))})}var c=this;c.$onInit=function(){c.assignedName={},c.errors={},c.isFocusOnName=!c.isEditMode,c.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}],c.badges=[{code:"0009877",ownerCode:"AMolnar AAaaa"},{code:"000987",ownerCode:"Molnar Aaaa"}],c.employees=[{_id:"112233445",name:"BMolnar Aaaa123"},{_id:"11223344",name:"Molnar Aaaa123"}]},c.$routerOnActivate=function(e,n){t=e.params.id,c.isEditMode="edit"===e.routeData.data.action,c.isEditMode?(c.pageTitle="Editeaza asociere",a()):c.pageTitle="Adauga asociere"},c.create=function(e){if(i(c,e),e.$invalid)return!1;var t=_.find(c.employees,{_id:c.assignedName.employeeId});c.assignedName.employeeName=t.name,r.create(c.assignedName).then(function(e){c.goBack()})["catch"](function(t){t.data.errors?o.updateValidity(c,e,t.data.errors):alert(JSON.stringify(t.data,null,4))})},c.update=function(e){if(c.assignedName.askForNotification&&!c.assignedName.email)return alert("Ai ales sa notifici clientul dar lipseste adresa de email!"),!1;if(i(c,e),e.$invalid)return!1;var t=_.find(c.employees,{_id:c.assignedName.employeeId});c.assignedName.employeeName=t.name,r.update(c.assignedName).then(function(e){c.goBack()})["catch"](function(t){t.data.errors?o.updateValidity(c,e,t.data.errors):alert(JSON.stringify(t.data,null,4))})},c.goBack=function(){n.history.back()}}var t,n=angular.module("celebrate-taste");n.component("assignedName",{templateUrl:"app/assignedName/assignedName.html",controllerAs:"vm",controller:["$route","$window","assignedNameService","helperValidator",e]})}(),function(){function e(e,t,n,r,o,i){function a(){n.getAll().then(function(e){u.badges=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function c(e,t){return e.size>1024*t*1024?"Sunt acceptate doar fisiere cu dimensiunea de maximum "+t+" MB.":""}var u=this;u.$onInit=function(){u.pageTitle="Carduri",u.badges=[],u.errors={},a()},u.screenSize=window.getComputedStyle(document.body,":after").getPropertyValue("content").replace(/"/g,""),u.upload=function(e){if(e){if(u.errors.fileErrorMsg=c(e,5),u.errors.fileErrorMsg)return!1;u.inProgress=!0,r.upload({url:"api/badges/upload",data:{file:e}}).then(function(e){u.errors.fileErrorMsg="",u.inProgress=!1,u.refresh(),i.success(e.data.importedBadges+" carduri au fost importate cu succes.")},function(e){u.errors.fileErrorMsg=e.data.msg,u.inProgress=!1},function(e){u.progressPercentage=Math.min(100,parseInt(100*e.loaded/e.total))})}},u.filterBySearch=function(e){var t=!1;return u.search?(new RegExp(u.search,"i").test(e.code)||new RegExp(u.search,"i").test(e.ownerCode))&&(t=!0):t=!0,t},u.refresh=function(){a()},u.goBack=function(){t.history.back()}}var t=angular.module("celebrate-taste");t.component("badgeList",{templateUrl:"app/badge/badgeList.html",controllerAs:"vm",controller:["$location","$window","badgeService","Upload","modalService","toastr",e]})}(),app.factory("badgeService",["$http",function(e){var t={},n="/api/badges/";return t.create=function(t){return e.post(n,t)},t.getAll=function(){return e.get(n).then(function(e){return e.data})},t.getById=function(t){return e.get(n+encodeURIComponent(t)).then(function(e){return e.data})},t.update=function(t){return e.put(n,t)},t["delete"]=function(t){return e["delete"](n+encodeURIComponent(t))},t.getByCode=function(t){var r="?$filter=code eq '"+encodeURIComponent(t)+"'";return e.get(n+r).then(function(e){return e.data})},t}]),app.controller("createDeliveryTplController",["$scope","$uibModalInstance","helperService","deliveryService","helperValidator","$q","orderService","orderLineService","dataToModal",function(e,t,n,r,o,i,a,c,u){function s(){e.existNewSeries=!1,a.getEatSeriesList(e.selectedOrder._id).then(function(t){0===t.length?e.noSeries=!0:e.noSeries=!1,e.eatSeriesList=_.map(t,function(t){var n=!!_.some(u,{orderId:e.selectedOrder._id,eatSeries:t});return n||(e.existNewSeries=!0),{name:t,selected:!n,disabled:n}})})}e.errors={},e.noOrders=!1,e.noSeries=!1,e.eatSeriesList=[],e.delivery={},a.getAllOpen().then(function(t){e.orders=t,e.orders.length>0?(e.selectedOrder=t[0],s()):e.noOrders=!0})["catch"](function(e){alert(JSON.stringify(e,null,4))}),e.selectOrder=function(){s()},e.create=function(n){e.selectedOrder&&(e.delivery.orderId=e.selectedOrder._id,e.delivery.orderDate=e.selectedOrder.date),e.delivery.eatSeriesList=_.chain(e.eatSeriesList).filter({selected:!0}).map("name").sortBy().value(),r.createMany(e.delivery).then(function(e){t.close()})["catch"](function(e){})},e.cancel=function(){t.dismiss("cancel")}}]),function(){function e(e,n,r,o,i,a,c,u,s,l,d,f,p,m){function g(){r.getById(t).then(function(e){I.delivery=e,I.dateAsShortString=O(I.delivery.orderDate).dateAsShortString,v(I.delivery.orderDate),h(e.orderId,e.eatSeries)})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function h(e,t){d.getDeliverySummary(e,t).then(function(e){I.deliverySummary=e})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function v(e){u.getMenu(e).then(function(e){I.menu=e[0]})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function y(){p.getAll().then(function(e){I.badges=e})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function S(){l.getAll().then(function(e){I.customerEmployees=e})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function O(e){return i.getObjFromString(e)}function A(){a.getOrderLinesBySeriesAndStatus(I.delivery.orderId,I.delivery.eatSeries,"open").then(function(e){I.orderLinesOpen=e})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function $(){a.getOrderLinesBySeriesAndStatus(I.delivery.orderId,I.delivery.eatSeries,"completed").then(function(e){I.orderLinesCompleted=_.orderBy(e,"deliveryDate","desc")})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function b(e){I.menu&&(I.option1=_.find(I.menu.dishes,{option:e.option1}),I.option2=_.find(I.menu.dishes,{option:e.option2}))}function E(e){var t=parseInt(e,10),n=t.toString(16),r=n.substr(0,n.length-4),o=n.substr(n.length-4);r.length>2&&(r=r.substr(r.length-2));var i=parseInt(r,16),a=parseInt(o,16),c=L(i,5),u=L(a,5);return c+u}function L(e,t){return Array(Math.max(t-String(e).length+1,0)).join("0")+e}function D(e){if(e)return e.toLowerCase().replace(/-/g," ").replace(/ {2,}/g," ")}function N(e){I.errorValidation=!0,I.errorMessage=e;var t={orderDate:I.delivery.orderDate,series:I.delivery.eatSeries,msg:e};f.create(t).then(function(){s.success("Datele despre acest card au fost memorate pt. investigatii ulterioare.")})["catch"](function(e){alert(JSON.stringify(e.data,null,4))})}var I=this;I.$onInit=function(){I.delivery={},I.errors={},I.selectedPreference="Toate pref.",I.deliverySummary={},I.obj={},I.obj.isFocusOnBadge=!0,I.preferences=["A","B","C","D"],y(),S()},I.$routerOnActivate=function(e,n){t=e.params.id,I.isEditMode="edit"===e.routeData.data.action,g()},I.openDeliveryLine=function(e,t){var n="app/delivery/openToCompleteTpl.html";"completed"===e.status&&(n="app/delivery/openToRevokeTpl.html"),b(e);var r=c.open({animation:!1,templateUrl:n,controller:"openDeliveryLineTplController",resolve:{dataToModal:function(){return{orderLine:e,option1:I.option1,option2:I.option2}}}});r.result.then(function(){"open"===t?I.refreshOpen():I.refreshCompleted()},function(){})},I.goBack=function(){n.history.back()},I.refreshOpen=function(){A()},I.selectTabOpen=function(){A()},I.refreshCompleted=function(){$()},I.selectTabCompleted=function(e){$()},I.selectTab1=function(){I.obj.isFocusOnBadge=!0,I.errorValidation=!1,I.orderLine=void 0,h(I.delivery.orderId,I.delivery.eatSeries)},I.deliverByBadge=function(e){if(I.errorValidation=!1,I.orderLine=void 0,I.obj.badgeCode=I.obj.badgeCode.trim(),10!==I.obj.badgeCode.length||isNaN(I.obj.badgeCode))return N("'"+I.obj.badgeCode+"' este un cod invalid! (nu are 10 cifre)"),I.obj.badgeCode="",void(I.obj.isFocusOnBadge=!0);var t=E(I.obj.badgeCode),n=_.find(I.badges,{code:t});if(n){var r=n.ownerCode,o=_.find(I.customerEmployees,function(e){return D(e.adjustedName)===D(n.ownerCode)});o&&(r=o.name),a.getOrderLinesByEmployeeName(I.delivery.orderId,r).then(function(e){if(0===e.length)N("Lipsa comanda pt. '"+r+"'.");else if(e.length>1)N("Exista mai multe comenzi pentru aceeasi persoana: '"+r+"'.");else if(e[0].eatSeries!==I.delivery.eatSeries)N("completed"===e[0].status?"'"+r+"' a mancat in "+e[0].eatSeries+".":"'"+r+"' a fost programat in "+e[0].eatSeries+".");else{if(I.orderLine=e[0],"completed"!==I.orderLine.status){var t={};angular.copy(I.orderLine,t),t.status="completed",t.deliveryDate=new Date,t.deliveryMode="card",a.update(t).then(function(e){I.deliverySummary=e.data,s.success("Livrarea a fost inregistrata!")})["catch"](function(e){alert(JSON.stringify(e.data,null,4))})}b(I.orderLine)}I.obj.badgeCode="",I.obj.isFocusOnBadge=!0})["catch"](function(e){alert(JSON.stringify(e,null,4))})}else N("Card negasit: "+t),I.obj.badgeCode="",I.obj.isFocusOnBadge=!0},I.revoke=function(e){e.status="open",delete e.deliveryDate,a.update(e).then(function(e){s.success("Livrarea a fost anulata!"),I.orderLine=void 0,I.obj.isFocusOnBadge=!0,I.deliverySummary=e.data})["catch"](function(e){alert(JSON.stringify(e.data,null,4))})},I.badgesFilter=function(e){return!I.obj.onlyNoBadges||!e.badgeCode},I.selectPreference=function(e){"Toate pref."===e?I.selectedPreference="Toate pref.":I.selectedPreference=e},I.preferencesFilter=function(e){return"Toate pref."===I.selectedPreference||("A"===I.selectedPreference||"B"===I.selectedPreference?e.option1===I.selectedPreference:"C"===I.selectedPreference||"D"===I.selectedPreference?e.option2===I.selectedPreference:"Fara pref."===I.selectedPreference?!(e.option1&&e.option2):void 0)}}var t,n=angular.module("celebrate-taste");n.component("delivery",{templateUrl:"app/delivery/delivery.html",controllerAs:"vm",controller:["$route","$window","deliveryService","helperValidator","helperService","orderLineService","$uibModal","menuService","toastr","customerEmployeeService","orderService","deliveryLogService","badgeService","$timeout",e]})}(),function(){function e(e,t,n,r,o,i,a){function c(){n.getAll().then(function(e){u.deliveries=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}var u=this;u.$onInit=function(){u.pageTitle="Livrari",u.deliveries=[],u.errors={},c()},u.openCreateDelivery=function(){var e=a.open({animation:!1,templateUrl:"app/delivery/createDeliveryTpl.html",controller:"createDeliveryTplController",resolve:{dataToModal:function(){return u.deliveries}}});e.result.then(function(){u.refresh()},function(){})},u.refresh=function(){c()},u.goBack=function(){t.history.back()},u.dt=function(e){return i.getObjFromString(e)}}var t=angular.module("celebrate-taste");t.component("deliveryList",{templateUrl:"app/delivery/deliveryList.html",controllerAs:"vm",controller:["$location","$window","deliveryService","modalService","toastr","helperService","$uibModal",e]})}(),app.factory("deliveryService",["$http",function(e){var t={},n="/api/deliveries/";return t.create=function(t){return e.post(n,t)},t.createMany=function(t){return e.post(n+"rpc/createMany",t)},t.getAll=function(){return e.get(n).then(function(e){return e.data})},t.getById=function(t){return e.get(n+encodeURIComponent(t)).then(function(e){return e.data})},t.update=function(t){return e.put(n,t)},t["delete"]=function(t){return e["delete"](n+encodeURIComponent(t))},t.count=function(t,r){return e.get(n+"$count?$filter="+t+" eq '"+r+"'").then(function(e){return e.data})},t}]),app.controller("openDeliveryLineTplController",["$scope","$uibModalInstance","helperService","deliveryService","helperValidator","$q","orderService","orderLineService","dataToModal",function(e,t,n,r,o,i,a,c,u){e.errors={},e.orderLine=u.orderLine,e.option1=u.option1,e.option2=u.option2,e.cancel=function(){t.dismiss("cancel")},e.update=function(n){e.orderLine.status="completed",e.orderLine.deliveryMode="manual",e.orderLine.deliveryDate=new Date,c.update(e.orderLine).then(function(e){t.close()})["catch"](function(e){alert(JSON.stringify(e.data,null,4))})},e.revoke=function(){e.orderLine.status="open",delete e.orderLine.deliveryDate,c.update(e.orderLine).then(function(e){t.close()})["catch"](function(e){alert(JSON.stringify(e.data,null,4))})}}]),function(){function e(e,t,n,r,o,i){function a(){n.getAll().then(function(e){c.deliveryLogs=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}var c=this;c.$onInit=function(){c.pageTitle="Notificari",c.deliveryLogs=[],c.errors={},a()},c.refresh=function(){a()},c.goBack=function(){t.history.back()},c.dt=function(e){return i.getObjFromString(e)}}var t=angular.module("celebrate-taste");t.component("deliveryLogList",{templateUrl:"app/deliveryLog/deliveryLogList.html",controllerAs:"vm",controller:["$location","$window","deliveryLogService","modalService","toastr","helperService",e]})}(),app.factory("deliveryLogService",["$http",function(e){var t={},n="/api/deliveryLogs/";return t.getAll=function(){return e.get(n).then(function(e){return e.data})},t.create=function(t){return e.post(n,t)},t}]),function(){function e(e,n,r,o){function i(e,t){var n="customerEmployee";o.setAllFildsAsValid(t),o.required50(e,t,n,"name"),o.optionalEmail(e,t,n,"email")}function a(){r.getById(t).then(function(e){c.customerEmployee=e})["catch"](function(e){alert(JSON.stringify(e,null,4))})}var c=this;c.$onInit=function(){c.customerEmployee={},c.errors={},c.isFocusOnName=!c.isEditMode,c.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},c.$routerOnActivate=function(e,n){t=e.params.id,c.isEditMode="edit"===e.routeData.data.action,c.isEditMode?(c.pageTitle="Editeaza angajat",a()):c.pageTitle="Adauga angajat"},c.create=function(e){return i(c,e),!e.$invalid&&void r.create(c.customerEmployee).then(function(e){c.goBack()})["catch"](function(t){t.data.errors?o.updateValidity(c,e,t.data.errors):alert(JSON.stringify(t.data,null,4))})},c.update=function(e){return c.customerEmployee.askForNotification&&!c.customerEmployee.email?(alert("Ai ales sa notifici clientul dar lipseste adresa de email!"),!1):(i(c,e),!e.$invalid&&void r.update(c.customerEmployee).then(function(e){c.goBack()})["catch"](function(t){t.data.errors?o.updateValidity(c,e,t.data.errors):alert(JSON.stringify(t.data,null,4))}))},c.goBack=function(){n.history.back()}}var t,n=angular.module("celebrate-taste");n.component("customerEmployee",{templateUrl:"app/customerEmployee/customerEmployee.html",controllerAs:"vm",controller:["$route","$window","customerEmployeeService","helperValidator",e]})}(),function(){function e(e,t,n,r){function o(){n.getAllWithBadgeInfo().then(function(e){i.customerEmployees=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}var i=this;i.$onInit=function(){i.pageTitle="Angajati client",i.customerEmployees=[],i.errors={},o()},i.create=function(){e.path("/admin/customerEmployees/create")},i["delete"]=function(e){var t={bodyDetails:e.name};r.confirm(t).then(function(t){n["delete"](e._id).then(function(){_.remove(i.customerEmployees,{_id:e._id})})["catch"](function(e){i.errors=JSON.stringify(e.data,null,4),alert(i.errors)})},function(){})},i.filterBySearch=function(e){var t=!1;return i.search?(new RegExp(i.search,"i").test(e.name)||new RegExp(i.search,"i").test(e.badgeCode)||new RegExp(i.search,"i").test(e.adjustedName))&&(t=!0):t=!0,t},i.refresh=function(){o()},i.goBack=function(){t.history.back()}}var t=angular.module("celebrate-taste");t.component("customerEmployeeList",{templateUrl:"app/customerEmployee/customerEmployeeList.html",controllerAs:"vm",controller:["$location","$window","customerEmployeeService","modalService",e]})}(),app.factory("customerEmployeeService",["$http",function(e){var t={},n="/api/customerEmployees/";return t.getByBadge=function(t){var r="?$filter=badgeCode eq '"+t+"' and isActive eq true";return e.get(n+r).then(function(e){return e.data})},t.create=function(t){return e.post(n,t)},t.getAll=function(){return e.get(n).then(function(e){return e.data})},t.getAllWithBadgeInfo=function(){return e.get(n+"/getAllWithBadgeInfo").then(function(e){return e.data})},t.getById=function(t){return e.get(n+encodeURIComponent(t)).then(function(e){return e.data})},t.update=function(t){return e.put(n,t)},t["delete"]=function(t){return e["delete"](n+encodeURIComponent(t))},t}]),function(){function e(e,r,o,i,a,c,u){function s(e,t){var n="dish";i.setAllFildsAsValid(t),i.required50(e,t,n,"name"),i.required50(e,t,n,"category")}function l(){o.getById(n).then(function(e){d.dish=e})["catch"](function(e){alert(JSON.stringify(e,null,4))})}var d=this;d.$onInit=function(){d.dish={},d.errors={},d.isFocusOnName=!d.isEditMode,d.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},d.$routerOnActivate=function(e,t){n=e.params.id,d.isEditMode="edit"===e.routeData.data.action,d.isEditMode?(d.pageTitle="Editeaza felul de mancare",l()):d.pageTitle="Adauga un fel de mancare"},d.create=function(e){return s(d,e),!e.$invalid&&void o.create(d.dish).then(function(e){d.goBack()})["catch"](function(t){t.data.errors?i.updateValidity(d,e,t.data.errors):alert(JSON.stringify(t.data,null,4))})},d.update=function(e){return s(d,e),!e.$invalid&&void o.update(d.dish).then(function(e){d.goBack()})["catch"](function(t){t.data.errors?i.updateValidity(d,e,t.data.errors):alert(JSON.stringify(t.data,null,4))})},d.goBack=function(){r.history.back()},d.screenSize=window.getComputedStyle(document.body,":after").getPropertyValue("content").replace(/"/g,""),d.upload=function(e){if(e){if(d.errors.fileErrorMsg=t(e,10,960,640),d.errors.fileErrorMsg)return!1;d.inProgress=!0,c.upload({url:"api/dishes/upload",data:{file:e}}).then(function(e){d.dish.image=e.data,d.errors.fileErrorMsg="",d.inProgress=!1},function(e){d.errors.fileErrorMsg=e.data.msg,d.inProgress=!1},function(e){d.progressPercentage=Math.min(100,parseInt(100*e.loaded/e.total))})}},d.removeImage=function(){delete d.dish.image,d.errors.fileErrorMsg=""},d.showModal=function(e){var t={imageUrl:e.image.large};u.showImage(t).then(function(e){})}}function t(e,t,n,r){return e.size>1024*t*1024?"Sunt acceptate doar poze cu dimensiunea de maximum "+t+" MB.":"image/jpeg"!==e.type?"Sunt acceptate doar poze in format '.jpg'.":e.$ngfWidth<e.$ngfHeight?"Sunt acceptate doar poze in format 'landscape' (latime > inaltime).":e.$ngfWidth<n?"Sunt acceptate doar poze cu latimea de minimum "+n+" px.":e.$ngfHeight<r?"Sunt acceptate doar poze cu inaltimea de minimum "+r+" px.":""}var n,r=angular.module("celebrate-taste");r.component("dish",{templateUrl:"app/dish/dish.html",controllerAs:"vm",controller:["$route","$window","dishService","helperValidator","toastr","Upload","modalService",e]})}(),function(){function e(e,t,n,r,o){function i(){n.getAll().then(function(e){a.dishes=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}var a=this;a.$onInit=function(){a.pageTitle="Feluri de mancare",a.dishes=[],a.errors={},i()},a.create=function(){e.path("/admin/dishes/create")},a["delete"]=function(e){var t={bodyDetails:e.name};r.confirm(t).then(function(t){n["delete"](e._id).then(function(){_.remove(a.dishes,{_id:e._id})})["catch"](function(e){a.errors=JSON.stringify(e.data,null,4),alert(a.errors)})},function(){})},a.refresh=function(){i()},a.goBack=function(){t.history.back()},a.showModal=function(e){var t={imageUrl:e.image.large};r.showImage(t).then(function(e){})}}var t=angular.module("celebrate-taste");t.component("dishList",{templateUrl:"app/dish/dishList.html",controllerAs:"vm",controller:["$location","$window","dishService","modalService","toastr",e]})}(),app.factory("dishService",["$http",function(e){var t={},n="/api/dishes/";return t.create=function(t){return e.post(n,t)},t.getAll=function(){return e.get(n).then(function(e){return e.data})},t.getById=function(t){return e.get(n+encodeURIComponent(t)).then(function(e){return e.data})},t.update=function(t){return e.put(n,t)},t["delete"]=function(t){return e["delete"](n+encodeURIComponent(t))},t}]),function(){function e(e){var t=this;t.$onInit=function(){t.isAdmin=e.isAdmin}}var t=angular.module("celebrate-taste");t.component("home",{template:'\n            <div class="container">    \n                </br>\n                </br>\n                <p ng-if-start="vm.isAdmin()"><a ng-href="/admin/users">Utilizatori</a></p>\n                <p><a ng-href="/admin/customerEmployees">Angajati client</a></p>\n                <p><a ng-href="/admin/badges">Carduri</a></p>                \n                <p><a ng-href="/admin/dishes">Feluri de mancare</a></p>\n                <p><a ng-href="/admin/menus">Meniuri</a></p>\n                <p><a ng-href="/admin/preferences">Preferinte</a></p>\n                <p><a ng-href="/admin/orders">Comenzi</a></p>\n                <p><a ng-href="/admin/deliveries">Livrari</a></p>                                            \n                <p ng-if-end><a ng-href="/admin/reviews">Feedback clienti</a></p>\n                \n                <p><a ng-href="/admin/deliveryLogs">Notificari</a></p>\n                <p><a ng-href="/admin/partnerOrders">Raport comenzi</a></p>\n            </div>        \n        ',controllerAs:"vm",controller:["userService",e]})}(),function(){function e(e,n,r,o,i,a,c){function u(){n.getById(t).then(function(e){d.menu=e,d.roMenuDate=i.getStringFromString(e.menuDate)})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function s(){r.getAll().then(function(e){d.dishes=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function l(e,t){var n="A";if(void 0===e||0===e.length)return n;var r=e[e.length-1];return String.fromCharCode(r.option.charCodeAt(0)+1)}var d=this;d.$onInit=function(){d.pageTitle="Editeaza produsul din meniu",d.menu={},d.categories=[{value:0,name:"Toate felurile"},{value:1,name:"Supa"},{value:2,name:"Felul 2"},{value:3,name:"Salata"},{value:4,name:"Desert"}],d.selectedCategory=d.categories[0],d.isFastingSelected=!1,d.selectCategory=function(e){d.selectedCategory=e},d.dishes=[],d.status={isopen:!1}},d.$routerOnActivate=function(e,n){t=e.params.id,s(),u()},d.addToMenu=function(e){var t={};angular.copy(e,t),"1"!==e.category&&"2"!==e.category||(t.option=l(d.menu.dishes,e)),void 0===d.menu.dishes&&(d.menu.dishes=[]),d.menu.dishes.push(t),n.update(d.menu).then(function(t){e.isAddedTmp=!0,u()})["catch"](function(e){alert(JSON.stringify(e.data,null,4))})},d.removeFromMenu=function(e){_.remove(d.menu.dishes,function(t){return t._id===e._id}),n.update(d.menu).then(function(t){delete e.isAddedTmp})["catch"](function(e){alert(JSON.stringify(e.data,null,4))})},d.goBack=function(){e.history.back()},d.refresh=function(){s(),u()},d.showModal=function(e){var t={imageUrl:e.image.large};c.showImage(t).then(function(e){})}}var t,n=angular.module("celebrate-taste");n.component("addDishToMenu",{templateUrl:"app/menu/addDishToMenu.html",controllerAs:"vm",controller:["$window","menuService","dishService","helperValidator","helperService","toastr","modalService",e]})}(),app.controller("createMenuTplController",["$scope","$uibModalInstance","dataToModal","helperService",function(e,t,n,r){e.menuDate=r.getDateFromString(n),e.menuDate.setDate(e.menuDate.getDate()+1),e.ok=function(){t.close(e.menuDate)},e.cancel=function(){t.dismiss("cancel")},e.dateOptions={startingDay:1},e.isOpen=!1,e.open=function(){e.isOpen=!0}}]),function(){function e(e,r,o,i,a,c){function u(e,t){var n="dish";i.setAllFildsAsValid(t),i.required50(e,t,n,"name"),i.required50(e,t,n,"category")}function s(){o.getById(t).then(function(e){d.menu=e,d.menuDateAsString=l(d.menu.menuDate).dateAsShortString,d.dish=_.find(e.dishes,{_id:n})})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function l(e){return a.getObjFromString(e)}var d=this;d.$onInit=function(){d.pageTitle="Editeaza produsul din meniu",d.menu={},d.dish={},d.errors={},d.isFocusOnName=!d.isEditMode,d.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},d.$routerOnActivate=function(e,r){t=e.params.menuId,n=e.params.dishId,s()},d.update=function(e){return u(d,e),!e.$invalid&&void o.update(d.menu).then(function(e){d.goBack()})["catch"](function(t){t.data.errors?i.updateValidity(d,e,t.data.errors):alert(JSON.stringify(t.data,null,4))})},d.goBack=function(){r.history.back()}}var t,n,r=angular.module("celebrate-taste");r.component("editDishForMenu",{templateUrl:"app/menu/editDishForMenu.html",controllerAs:"vm",controller:["$route","$window","menuService","helperValidator","helperService","toastr",e]})}(),function(){function e(e,t,n,r,o,i,a){function c(){n.getActiveMenus().then(function(e){u.menus=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}var u=this;u.$onInit=function(){u.pageTitle="Meniuri",u.menus=[],u.errors={},c()},u.create=function(e){var t={menuDate:e};n.create(t).then(function(e){u.refresh()})["catch"](function(e){alert(JSON.stringify(e.data,null,4))})},u["delete"]=function(e){var t={bodyDetails:"Meniul de "+u.friendlyDate(e.menuDate)};r.confirm(t).then(function(t){n["delete"](e._id).then(function(){_.remove(u.menus,{_id:e._id})})["catch"](function(e){u.errors=JSON.stringify(e.data,null,4),alert(u.errors)})},function(){})},u.filterBySearch=function(e){var t=!1;return u.search?(new RegExp(u.search,"i").test(e.name)||new RegExp(u.search,"i").test(e.email))&&(t=!0):t=!0,t},u.refresh=function(){c()},u.goBack=function(){t.history.back()},u.friendlyDate=function(e){return o.getStringFromString(e)},u.deleteDishFromMenu=function(e,t){var o={bodyDetails:e.name};r.confirm(o).then(function(r){_.remove(t.dishes,{_id:e._id}),n.update(t).then(function(e){u.refresh()})["catch"](function(e){alert(JSON.stringify(e.data,null,4))})})},u.openCreateMenu=function(){var e=_.chain(u.menus).sortBy("menuDate").last().value(),t=e&&e.menuDate||o.getStringFromDate(new Date),n=a.open({animation:!1,templateUrl:"app/menu/createMenuTpl.html",controller:"createMenuTplController",resolve:{dataToModal:function(){return t}}});n.result.then(function(e){var t=o.getStringFromDate(e);u.create(t)},function(){})},u.showModal=function(e){var t={imageUrl:e.image.large};r.showImage(t).then(function(e){})}}var t=angular.module("celebrate-taste");t.component("menuList",{templateUrl:"app/menu/menuList.html",controllerAs:"vm",controller:["$location","$window","menuService","modalService","helperService","toastr","$uibModal",e]})}(),app.factory("menuService",["$http","helperService",function(e,t){var n={},r="/api/menus/";return n.create=function(t){return e.post(r,t)},n.getAll=function(){return e.get(r).then(function(e){return e.data})},n.getNextMenus=function(){return e.get(r+"nextMenus/").then(function(e){return e.data})},n.getActiveMenus=function(){var n=t.getStringFromDate(new Date);return e.get(r+"rpc/getActiveMenus?today="+n).then(function(e){return e.data})},n.getById=function(t){return e.get(r+encodeURIComponent(t)).then(function(e){return e.data})},n.getMenu=function(t){var n="?$filter=menuDate eq '"+t+"'";return e.get(r+n).then(function(e){return e.data})},n.update=function(t){return e.put(r,t)},n["delete"]=function(t){return e["delete"](r+encodeURIComponent(t))},n}]),function(){function e(e,t,n){var r=this;r.$onInit=function(){r.isCollapsed=!0,r.isLoggedIn=t.isLoggedIn,r.isAdmin=t.isAdmin,r.isPartnerOrAdmin=t.isPartnerOrAdmin,r.getCurrentUser=t.getCurrentUser},r.isActive=function(e){return e===n.path()}}var t=angular.module("celebrate-taste");t.component("lmNavbar",{templateUrl:"app/navbar/navbar.html",controllerAs:"vm",controller:["$http","userService","$location",e]})}(),app.controller("nextMenusController",["$scope","$location","menuService","helperService",function(e,t,n,r){function o(){n.getNextMenus().then(function(t){e.menus=t})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}e.menus=[],e.errors={},e.friendlyDate=function(e){return r.getStringFromString(e)},o()}]),app.controller("nextMenusItemController",["$scope","$route","menuService",function(e,t,n){function r(){o()}function o(){n.getById(t.current.params.menuId).then(function(n){e.menu=n,e.dish=_.find(n.dishes,"_id",t.current.params.dishId)})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}e.menu={},e.dish={},r()}]),app.controller("createOrderTplController",["$scope","$uibModalInstance","helperService","orderService","helperValidator","$q",function(e,t,n,r,o,i){function a(e,t){var n=i.defer(),r="order";return o.setAllFildsAsValid(t),o.requiredDate(e,t,r,"date"),t.$invalid?(n.resolve(),n.promise):(c(t).then(function(){
n.resolve()}),n.promise)}e.errors={},e.order={date:new Date},e.minDate=new Date,e.create=function(o){a(e,o).then(function(){return!o.$invalid&&(e.order.date=n.getStringFromDate(e.order.date),void r.create(e.order).then(function(e){t.close()})["catch"](function(e){}))})};var c=function(t){var a=i.defer(),c=n.getStringFromDate(e.order.date);return r.count("date",c).then(function(n){if(n>0){var r=[{field:"date",msg:"Exista deja o comanda pentru aceasta data."}];o.updateValidity(e,t,r)}a.resolve()})["catch"](function(e){alert(JSON.stringify(e,null,4)),a.reject()}),a.promise};e.cancel=function(){t.dismiss("cancel")},e.dateOptions={startingDay:1},e.isOpen=!1,e.open=function(){e.isOpen=!0}}]),function(){function e(e,t,n,r,o,i){function a(){n.getById(u.orderId).then(function(e){u.order=e,u.dateAsShortString=c(u.order.date).dateAsShortString})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function c(e){return i.getObjFromString(e)}var u=this;u.$onInit=function(){},u.$routerOnActivate=function(e,t){u.orderId=e.params.id,a()},u.goBack=function(){t.history.back()}}var t=angular.module("celebrate-taste");t.component("order",{templateUrl:"app/order/order.html",controllerAs:"vm",controller:["$route","$window","orderService","helperValidator","toastr","helperService",e]})}(),function(){function e(e,t,n,r,o,i,a){function c(){n.getAll().then(function(e){u.orders=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}var u=this;u.$onInit=function(){u.pageTitle="Comenzi",u.orders=[],u.errors={},c()},u.openCreateOrder=function(){var e=a.open({animation:!1,templateUrl:"app/order/createOrderTpl.html",controller:"createOrderTplController"});e.result.then(function(){u.refresh()},function(){})},u["delete"]=function(e){var t={bodyDetails:e.name};r.confirm(t).then(function(t){n["delete"](e._id).then(function(){_.remove(u.orders,{_id:e._id})})["catch"](function(e){u.errors=JSON.stringify(e.data,null,4),alert(u.errors)})},function(){})},u.refresh=function(){c()},u.goBack=function(){t.history.back()},u.dt=function(e){return i.getObjFromString(e)},u.closeOrder=function(e){var t={actionButtonText:"Finalizeaza",headerText:"Finalizare/Arhivare comanda",bodyTitle:"Esti sigur ca vrei sa finalizezi aceasta comanda?",bodyDetails:"Odata finalizata, comanda nu mai poate fi redeschisa!"};r.confirm(t).then(function(t){n.closeOrder(e).then(function(t){var n=_.find(u.orders,{_id:e});n.summary=t,n.status="completed"})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})},function(){})},u.showEmployees=function(e,t){var n={animation:!1,templateUrl:"app/common/templates/showEmployees.html"},o={closeButtonText:"Renunta",headerText:t,employees:e};r.show(n,o).then(function(){},function(){})}}var t=angular.module("celebrate-taste");t.component("orderList",{templateUrl:"app/order/orderList.html",controllerAs:"vm",controller:["$location","$window","orderService","modalService","toastr","helperService","$uibModal",e]})}(),app.factory("orderService",["$http",function(e){var t={},n="/api/orders/";return t.count=function(t,r){return e.get(n+"$count?$filter="+t+" eq '"+r+"'").then(function(e){return e.data})},t.getAllOpen=function(){var t="?$filter=status eq 'open'";return e.get(n+t).then(function(e){return e.data})},t.create=function(t){return e.post(n,t)},t.getAll=function(){return e.get(n).then(function(e){return e.data})},t.getById=function(t){return e.get(n+t).then(function(e){return e.data})},t.update=function(t){return e.put(n,t)},t["delete"]=function(t){return e["delete"](n+t)},t.getEatSeriesList=function(t){return e.get(n+t+"/rpc/getEatSeriesList").then(function(e){return e.data})},t.getDeliverySummary=function(t,r){return e.get(n+t+"/rpc/getDeliverySummary/"+encodeURIComponent(r)).then(function(e){return e.data})},t.closeOrder=function(t){return e.post(n+t+"/rpc/closeOrder").then(function(e){return e.data})},t}]),function(){function e(e,t,n,r,o,i,a){function c(){n.getAll().then(function(e){u.partnerOrders=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}var u=this;u.$onInit=function(){u.pageTitle="Comenzi",u.partnerOrders=[],u.errors={},c()},u.showEmployees=function(e,t){var n={animation:!1,templateUrl:"app/common/templates/showEmployees.html"},o={closeButtonText:"Renunta",headerText:t,employees:e};r.show(n,o)},u.refresh=function(){c()},u.goBack=function(){t.history.back()},u.dt=function(e){return i.getObjFromString(e)}}var t=angular.module("celebrate-taste");t.component("partnerOrderList",{templateUrl:"app/partnerOrder/partnerOrderList.html",controllerAs:"vm",controller:["$location","$window","partnerOrderService","modalService","toastr","helperService","$uibModal",e]})}(),app.factory("partnerOrderService",["$http",function(e){var t={},n="/api/partnerOrders/";return t.count=function(t,r){return e.get(n+"$count?$filter="+t+" eq '"+r+"'").then(function(e){return e.data})},t.getAllOpen=function(){var t="?$filter=status eq 'open'";return e.get(n+t).then(function(e){return e.data})},t.create=function(t){return e.post(n,t)},t.getAll=function(){return e.get(n).then(function(e){return e.data})},t.getById=function(t){return e.get(n+t).then(function(e){return e.data})},t.update=function(t){return e.put(n,t)},t["delete"]=function(t){return e["delete"](n+t)},t.getEatSeriesList=function(t){return e.get(n+t+"/rpc/getEatSeriesList").then(function(e){return e.data})},t.getDeliverySummary=function(t,r){return e.get(n+t+"/rpc/getDeliverySummary/"+encodeURIComponent(r)).then(function(e){return e.data})},t.closepartnerOrder=function(t){return e.post(n+t+"/rpc/closepartnerOrder").then(function(e){return e.data})},t}]),app.controller("partnerOrdersController",["$scope","$location","partnerOrderService","modalService","helperService","$uibModal",function(e,t,n,r,o,i){function a(){n.getAll().then(function(t){e.partnerOrders=t})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}e.partnerOrders=[],e.errors={},a(),e["delete"]=function(t){var o={bodyDetails:t.name};r.confirm(o).then(function(r){var o=0;for(o in e.partnerOrders)if(e.partnerOrders[o]._id===t._id)break;n["delete"](t._id).then(function(){e.partnerOrders.splice(o,1)})["catch"](function(t){e.errors=JSON.stringify(t.data,null,4),alert(e.errors)})})},e.openCreatepartnerOrder=function(){var t=i.open({animation:!1,templateUrl:"app/partnerOrder/createpartnerOrderTpl.html",controller:"createpartnerOrderTplController"});t.result.then(function(){e.refresh()},function(){})},e.refresh=function(){a()},e.dt=function(e){return o.getObjFromString(e)},e.closepartnerOrder=function(t){var o={actionButtonText:"Finalizeaza",headerText:"Finalizare/Arhivare comanda",bodyTitle:"Esti sigur ca vrei sa finalizezi aceasta comanda?",bodyDetails:"Odata finalizata, comanda nu mai poate fi redeschisa!"};r.confirm(o).then(function(r){n.closepartnerOrder(t).then(function(n){var r=_.find(e.partnerOrders,{_id:t});r.summary=n,r.status="completed"})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})})},e.showEmployees=function(e,t){var n={animation:!1,templateUrl:"app/common/templates/showEmployees.html"},o={closeButtonText:"Renunta",headerText:t,employees:e};r.show(n,o)}}]),function(){function e(e,n,r,o,i,a,c,u,s){function l(e){r.getNextByEmployee(e).then(function(e){m.nextEmployeePreferences=e,m.preferences=[];var t=!0;m.menus.forEach(function(n,r){var o=_.find(e,{date:n.menuDate}),i=!!o,a=_.chain(n.dishes).filter({category:"1"}).map("option").uniq().sortBy().value(),c=_.chain(n.dishes).filter({category:"2"}).map("option").uniq().sortBy().value(),u=!1,s=!1;!i&&t&&(a.length>0?(u=!0,t=!1):c.length>0&&(s=!0,t=!1));var l={alreadyAdded:i,date:n.menuDate,option1:o?o.option1:"",option2:o?o.option2:"",availableForOption1:a,availableForOption2:c,isFocusOnOption1:u,isFocusOnOption2:s,rowIndex:r};m.preferences.push(l)})})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function d(){i.getAll().then(function(e){m.customerEmployees=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function f(){u.getActiveMenus().then(function(e){m.menus=e,m.menuIsReady=!0})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function p(e,t){o.setAllFildsAsValid(t),e.preferencesHaveErrors=!1;var n=!1;return e.preferences.some(function(r){if(!r.alreadyAdded){var o=r.option1.toUpperCase();if(1===o.length&&(n=!0,r.availableForOption1.indexOf(o)===-1)){var i=2*r.rowIndex,a="input"+i.toString();return t[a].$setValidity("myValidation",!1),e.errors.preferences="Ai introdus un cod invalid.",e.preferencesHaveErrors=!0,!0}var c=r.option2.toUpperCase();if(1===c.length&&(n=!0,r.availableForOption2.indexOf(c)===-1)){var u=2*r.rowIndex+1,s="input"+u.toString();return t[s].$setValidity("myValidation",!1),e.errors.preferences="Ai introdus un cod invalid.",e.preferencesHaveErrors=!0,!0}}}),e.preferencesHaveErrors}var m=this;m.$onInit=function(){m.preference={},m.errors={},m.pageTitle="Adauga preferinte",m.person={},m.customerEmployees=[],m.menus=[],m.nextEmployeePreferences=[],m.preferences=[]},m.$routerOnActivate=function(e,n){t=e.params.id,f(),d()},m.create=function(e){if(p(m,e),e.$invalid)return!1;var t=[];m.preferences.forEach(function(e){if(!e.alreadyAdded&&(""!==e.option1||""!==e.option2)){var n={employeeName:m.person.selected.name,date:e.date};""!==e.option1&&(n.option1=e.option1.toUpperCase()),""!==e.option2&&(n.option2=e.option2.toUpperCase()),t.push(n)}}),t.length>0?r.createMany(t).then(function(e){m.person.selected=void 0,s.$broadcast("SetFocus"),c.success("Inregistrarea a fost adaugata!")})["catch"](function(t){t.data.errors?o.updateValidity(m,e,t.data.errors):alert(JSON.stringify(t.data,null,4))}):alert("Nu ai adaugat nicio preferinta!")},m.selectEmployee=function(e,t){m.preferencesHaveErrors=!1,l(e.name)},m.dt=function(e){return a.getObjFromString(e)},m.goBack=function(){n.history.back()}}var t,n=angular.module("celebrate-taste");n.component("addPreferences",{templateUrl:"app/preference/addPreferences.html",controllerAs:"vm",controller:["$route","$window","preferenceService","helperValidator","customerEmployeeService","helperService","toastr","menuService","$scope",e]}),n.directive("moveNextOnMaxlength",function(){return{restrict:"A",link:function(e,t){t.on("input",function(e){if(t.val().length==t.attr("maxlength")){for(var n=t[0].id,r=parseInt(n)+1,o=angular.element(document.getElementById(r.toString()));o.length&&o[0].disabled;)n=o[0].id,r=parseInt(n)+1,o=angular.element(document.getElementById(r.toString()));o.length&&o[0].focus()}})}}})}(),function(){function e(e,n,r,o,i){function a(){r.getById(t).then(function(e){c.preference=e})["catch"](function(e){alert(JSON.stringify(e,null,4))})}var c=this;c.$onInit=function(){c.preference={},c.errors={},c.pageTitle="Editeaza preferinte"},c.$routerOnActivate=function(e,n){t=e.params.id,a()},c.update=function(e){r.update(c.preference).then(function(e){c.goBack()})["catch"](function(t){t.data.errors?o.updateValidity(c,e,t.data.errors):alert(JSON.stringify(t.data,null,4))})},c.goBack=function(){n.history.back()}}var t,n=angular.module("celebrate-taste");n.component("preference",{templateUrl:"app/preference/preference.html",controllerAs:"vm",controller:["$route","$window","preferenceService","helperValidator","toastr",e]})}(),app.controller("preferenceController",["$scope","$route","preferenceService","$location","helperValidator","menuService","customerEmployeeService","helperService","toastr",function(e,t,n,r,o,i,a,c,u){function s(){l()}function l(){n.getById(t.current.params.id).then(function(t){e.preference=t})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function d(t){n.getNextByEmployee(t).then(function(t){e.nextEmployeePreferences=t,e.preferences=[];var n=!0;e.menus.forEach(function(r,o){var i=_.find(t,{date:r.menuDate}),a=!!i,c=_.chain(r.dishes).filter({category:"1"}).map("option").uniq().sortBy().value(),u=_.chain(r.dishes).filter({category:"2"}).map("option").uniq().sortBy().value(),s=!1,l=!1;!a&&n&&(c.length>0?(s=!0,n=!1):u.length>0&&(l=!0,n=!1));var d={alreadyAdded:a,date:r.menuDate,option1:i?i.option1:"",option2:i?i.option2:"",availableForOption1:c,availableForOption2:u,isFocusOnOption1:s,isFocusOnOption2:l,rowIndex:o};e.preferences.push(d)})})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function f(){a.getAll().then(function(t){e.customerEmployees=t})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function p(){i.getActiveMenus().then(function(t){e.menus=t,e.menuIsReady=!0})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function m(e,t){o.setAllFildsAsValid(t),e.preferencesHaveErrors=!1;var n=!1;return e.preferences.some(function(r){if(!r.alreadyAdded){var o=r.option1.toUpperCase();if(1===o.length&&(n=!0,r.availableForOption1.indexOf(o)===-1)){var i=2*r.rowIndex,a="input"+i.toString();return t[a].$setValidity("myValidation",!1),e.errors.preferences="Ai introdus un cod invalid.",e.preferencesHaveErrors=!0,!0}var c=r.option2.toUpperCase();if(1===c.length&&(n=!0,r.availableForOption2.indexOf(c)===-1)){var u=2*r.rowIndex+1,s="input"+u.toString();return t[s].$setValidity("myValidation",!1),e.errors.preferences="Ai introdus un cod invalid.",e.preferencesHaveErrors=!0,!0}}}),n||(e.form.$invalid=!0,e.errors.preferences="Nu ai adaugat optiuni noi.",e.preferencesHaveErrors=!0),e.preferencesHaveErrors}e.isEditMode=t.current.isEditMode,e.isFocusOnName=!e.isEditMode,e.errors={},e.preference={},e.person={},e.customerEmployees=[],e.menus=[],e.nextEmployeePreferences=[],e.selectEmployee=function(t,n){e.preferencesHaveErrors=!1,d(t.name)},e.isEditMode?s():(p(),f()),e.preferences=[],e.create=function(t){if(m(e,t),t.$invalid)return!1;var r=[];e.preferences.forEach(function(t){if(!t.alreadyAdded&&(""!==t.option1||""!==t.option2)){var n={employeeName:e.person.selected.name,date:t.date};""!==t.option1&&(n.option1=t.option1.toUpperCase()),""!==t.option2&&(n.option2=t.option2.toUpperCase()),r.push(n)}}),n.createMany(r).then(function(t){u.success("Inregistrarea a fost adaugata!"),e.person.selected=void 0,e.$broadcast("SetFocus")})["catch"](function(n){n.data.errors?o.updateValidity(e,t,n.data.errors):alert(JSON.stringify(n.data,null,4))})},e.update=function(t){n.update(e.preference).then(function(e){r.path("/admin/preferences")})["catch"](function(n){n.data.errors?o.updateValidity(e,t,n.data.errors):alert(JSON.stringify(n.data,null,4))})},e.dt=function(e){return c.getObjFromString(e)}}]),app.directive("moveNextOnMaxlength",function(){return{restrict:"A",link:function(e,t){t.on("input",function(e){if(t.val().length==t.attr("maxlength")){for(var n=t[0].id,r=parseInt(n)+1,o=angular.element(document.getElementById(r.toString()));o.length&&o[0].disabled;)n=o[0].id,r=parseInt(n)+1,o=angular.element(document.getElementById(r.toString()));o.length&&o[0].focus()}})}}}),function(){function e(e,t,n,r,o,i){function a(){n.getNextDates().then(function(t){l.nextDates=t;var n=e.search();n.date?l.selectedDate=n.date:0===l.nextDates.length?l.nextDates.push("Nu exista date"):l.selectedDate=l.nextDates[0],l.selectedDate&&c(l.selectedDate),n.onlyFromOnline?l.obj.onlyFromOnline=!0:l.obj.onlyFromOnline=!1})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function c(e){n.getByDate(e).then(function(e){l.preferences=e,u(l.preferences),s(l.preferences)})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function u(e){e.forEach(function(e){e.option1||(e.option1="-");var t=_.find(l.option1Summary,{key:e.option1});t?t.total+=1:l.option1Summary.push({key:e.option1,total:1})})}function s(e){e.forEach(function(e){e.option2||(e.option2="-");var t=_.find(l.option2Summary,{key:e.option2});t?t.total+=1:l.option2Summary.push({key:e.option2,total:1})})}var l=this;l.$onInit=function(){l.pageTitle="Preferinte",l.preferences=[],l.errors={},l.nextDates=[],l.obj={},l.obj.onlyFromOnline=!1,l.option1Summary=[],l.option2Summary=[],a()},l["delete"]=function(e){var t={bodyDetails:e.name};r.confirm(t).then(function(t){n["delete"](e._id).then(function(){_.remove(l.preferences,{_id:e._id})})["catch"](function(e){l.errors=JSON.stringify(e.data,null,4),alert(l.errors)})},function(){})},l.filterByOnline=function(e){return!l.obj.onlyFromOnline||e.fromOnline},l.refresh=function(){a()},l.goBack=function(){t.history.back()},l.dt=function(e){return i.getObjFromString(e)},l.selectOnlyFromOnline=function(){l.obj.onlyFromOnline===!1?e.search("onlyFromOnline",null):e.search("onlyFromOnline",!0)},l.selectDate=function(t){"Nu exista date"!==t&&(l.selectedDate=t,e.search("date",t),c(l.selectedDate))}}var t=angular.module("celebrate-taste");t.component("preferenceList",{templateUrl:"app/preference/preferenceList.html",controllerAs:"vm",controller:["$location","$window","preferenceService","modalService","toastr","helperService",e]})}(),app.factory("preferenceService",["$http","helperService",function(e,t){var n={},r="/api/preferences/";return n.create=function(t){return e.post(r,t)},n.createMany=function(t){return e.post(r+"rpc/createMany",t)},n.getByDate=function(t){return e.get(r+"?$filter=date eq '"+t+"'").then(function(e){return e.data})},n.getById=function(t){return e.get(r+encodeURIComponent(t)).then(function(e){return e.data})},n.getNextDates=function(){var n=t.getStringFromDate(new Date);return e.get(r+"rpc/getNextDates?today="+n).then(function(e){return e.data})},n.getNextByEmployee=function(n){var o=new Date,i=new Date(o.setDate(o.getDate()-1)),a=t.getStringFromDate(i),c="?$filter=employeeName eq '"+n+"' and date gt '"+a+"'";return e.get(r+c).then(function(e){return e.data})},n.getByEmployeeAndDate=function(t,n){var o="?$filter=employeeName eq '"+t+"' and date eq '"+n+"'";return e.get(r+o).then(function(e){return e.data})},n.update=function(t){return e.put(r,t)},n["delete"]=function(t){return e["delete"](r+encodeURIComponent(t))},n}]),function(){function e(e,t,n,r){function o(){n.getAll().then(function(e){i.reviews=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}var i=this;i.$onInit=function(){i.pageTitle="Feedback clienti",i.reviews=[],i.errors={},o()},i.create=function(){e.path("/admin/reviews/create")},i["delete"]=function(e){var t={bodyDetails:e.name};r.confirm(t).then(function(t){n["delete"](e._id).then(function(){_.remove(i.reviews,{_id:e._id})})["catch"](function(e){i.errors=JSON.stringify(e.data,null,4),alert(i.errors)})})},i.filterBySearch=function(e){var t=!1;return i.search?(new RegExp(i.search,"i").test(e.dishName)||new RegExp(i.search,"i").test(e.createdBy))&&(t=!0):t=!0,t},i.refresh=function(){o()},i.goBack=function(){t.history.back()}}var t=angular.module("celebrate-taste");t.component("reviewList",{templateUrl:"app/review/reviewList.html",controllerAs:"vm",controller:["$location","$window","reviewService","modalService",e]})}(),app.factory("reviewService",["$http",function(e){var t={},n="/api/reviews/";return t.getByBadge=function(t){var r="?$filter=badgeCode eq '"+t+"' and isActive eq true";return e.get(n+r).then(function(e){return e.data})},t.create=function(t){return e.post(n,t)},t.getAll=function(){return e.get(n).then(function(e){return e.data})},t.getById=function(t){return e.get(n+encodeURIComponent(t)).then(function(e){return e.data})},t.update=function(t){return e.put(n,t)},t["delete"]=function(t){return e["delete"](n+encodeURIComponent(t))},t}]),app.controller("todayMenuController",["$scope","menuService","helperService",function(e,t,n){e.todaysMenu={},e.today=n.getFriendlyDate(new Date);var r=function(){var n=e.today.ymd;t.getMenu(n).then(function(t){e.todaysMenu=t})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})},o=function(){r()};o()}]),function(){function e(e,n,r,o,i){function a(e,t){var n="user";o.setAllFildsAsValid(t),o.required50(e,t,n,"name"),o.requiredEmail(e,t,n,"email")}function c(){r.getById(t).then(function(e){u.user=e})["catch"](function(e){alert(JSON.stringify(e,null,4))})}var u=this;u.$onInit=function(){u.user={},u.errors={},u.isFocusOnName=!u.isEditMode,u.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},u.$routerOnActivate=function(e,n){t=e.params.id,u.isEditMode="edit"===e.routeData.data.action,u.isEditMode?(u.pageTitle="Editeaza utilizator",c()):u.pageTitle="Adauga utilizator"},u.create=function(e){return a(u,e),!e.$invalid&&void r.create(u.user).then(function(e){u.goBack()})["catch"](function(t){t.data.errors?o.updateValidity(u,e,t.data.errors):alert(JSON.stringify(t.data,null,4))})},u.update=function(e){return a(u,e),!e.$invalid&&void r.update(u.user).then(function(e){u.goBack()})["catch"](function(t){t.data.errors?o.updateValidity(u,e,t.data.errors):alert(JSON.stringify(t.data,null,4))})},u.goBack=function(){n.history.back()}}var t,n=angular.module("celebrate-taste");n.component("user",{templateUrl:"app/user/user.html",controllerAs:"vm",controller:["$route","$window","userService","helperValidator","toastr",e]})}(),function(){function e(e,t,n,r,o){function i(){n.getAll().then(function(e){e.forEach(function(e){e.activationToken?e.status="asteapta activare":e.status="activ"}),a.users=e})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}var a=this;a.$onInit=function(){a.pageTitle="Utilizatori",a.users=[],a.errors={},i()},a.create=function(){e.path("/admin/users/create")},a["delete"]=function(e){var t={bodyDetails:e.name};r.confirm(t).then(function(t){n["delete"](e._id).then(function(){_.remove(a.users,{_id:e._id}),n.getCurrentUser().name===e.name&&n.logout()})["catch"](function(e){a.errors=JSON.stringify(e.data,null,4),alert(a.errors)})},function(){})},a.filterBySearch=function(e){var t=!1;return a.search?(new RegExp(a.search,"i").test(e.name)||new RegExp(a.search,"i").test(e.email))&&(t=!0):t=!0,t},a.refresh=function(){i()},a.goBack=function(){t.history.back()}}var t=angular.module("celebrate-taste");t.component("userList",{templateUrl:"app/user/userList.html",controllerAs:"vm",controller:["$location","$window","userService","modalService","toastr",e]})}(),app.factory("userService",["$http","$cookies","$q","$window",function(e,t,n,r){var o={},i="/api/users/";o.create=function(t){return e.post(i,t)},o.getAll=function(){return e.get(i).then(function(e){return e.data})},o.getById=function(t){return e.get(i+encodeURIComponent(t)).then(function(e){return e.data})},o.update=function(t){return e.put(i,t)},o["delete"]=function(t){return e["delete"](i+encodeURIComponent(t))};var a={};return t.get("user")&&(a=angular.fromJson(t.get("user"))),o.changePassword=function(t,n){return e.put(i+"me/changepassword",{oldPassword:t,newPassword:n})},o.login=function(t,r){var o=r||angular.noop,i=n.defer();return e.post("/login",{email:t.email,password:t.password}).success(function(e){return a=e,i.resolve(e),o()}).error(function(e){return this.logout(),i.reject(e),o(e)}.bind(this)),i.promise},o.logout=function(){r.location.href="/logout"},o.getCurrentUser=function(){return a},o.isLoggedIn=function(){return a.hasOwnProperty("role")},o.isAdmin=function(){return"admin"===a.role},o.isPartnerOrAdmin=function(){return"partner"===a.role||"admin"===a.role},o}]),app.directive("lmCollapse",[function(){return{link:function(e,t,n){function r(){t.removeClass("collapsing").addClass("collapse in").css({height:"auto"})}function o(){t.css({height:"0"}),t.removeClass("collapsing").addClass("collapse")}e.$watch(n.lmCollapse,function(e){e?o():r()})}}}]),app.directive("lmFocus",["$timeout",function(e){return{restrict:"A",link:function(t,n,r){"true"===r.lmFocus||""===r.lmFocus?e(function(){n[0].focus()},0):(t.$watch(r.lmFocus,function(t,r){e(function(){t&&n[0].focus()},0)}),n.bind("blur",function(n){e(function(){t.$apply(r.lmFocus+"=false")},0)}),n.bind("focus",function(n){e(function(){t.$apply(r.lmFocus+"=true")},0)}))}}}]),app.directive("myMatch",function(){return{require:"ngModel",restrict:"A",scope:{match:"="},link:function(e,t,n,r){e.$watch(function(){return r.$pristine&&angular.isUndefined(r.$modelValue)||e.match===r.$modelValue},function(e){r.$setValidity("match",e)})}}}),app.directive("stopEmailValidation",function(){var e=/./;return{require:"ngModel",restrict:"",priority:2,link:function(t,n,r,o){o&&o.$validators.email&&(o.$validators.email=function(t){return o.$isEmpty(t)||e.test(t)})}}}),angular.module("ngLocale",[],["$provide",function(e){function t(e){e+="";var t=e.indexOf(".");return t==-1?0:e.length-t-1}function n(e,n){var r=n;void 0===r&&(r=Math.min(t(e),3));var o=Math.pow(10,r),i=(e*o|0)%o;return{v:r,f:i}}var r={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};e.value("$locale",{DATETIME_FORMATS:{AMPMS:["a.m.","p.m."],DAY:["duminică","luni","marți","miercuri","joi","vineri","sâmbătă"],ERANAMES:["înainte de Hristos","după Hristos"],ERAS:["î.Hr.","d.Hr."],FIRSTDAYOFWEEK:0,MONTH:["ianuarie","februarie","martie","aprilie","mai","iunie","iulie","august","septembrie","octombrie","noiembrie","decembrie"],SHORTDAY:["Du","Lu","Ma","Mi","Jo","Vi","Sâ"],SHORTMONTH:["ian.","feb.","mar.","apr.","mai","iun.","iul.","aug.","sept.","oct.","nov.","dec."],STANDALONEMONTH:["ianuarie","februarie","martie","aprilie","mai","iunie","iulie","august","septembrie","octombrie","noiembrie","decembrie"],WEEKENDRANGE:[5,6],fullDate:"EEEE, d MMMM y",longDate:"d MMMM y",medium:"d MMM y HH:mm:ss",mediumDate:"d MMM y",mediumTime:"HH:mm:ss","short":"dd.MM.y HH:mm",shortDate:"dd.MM.y",shortTime:"HH:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"RON",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:" ¤",posPre:"",posSuf:" ¤"}]},id:"ro-ro",localeID:"ro_RO",pluralCat:function(e,t){var o=0|e,i=n(e,t);return 1==o&&0==i.v?r.ONE:0!=i.v||0==e||1!=e&&e%100>=1&&e%100<=19?r.FEW:r.OTHER}})}]),app.factory("authInterceptor",["$rootScope","$q","$cookies","$location","$window",function(e,t,n,r,o){return{responseError:function(e){return 401===e.status?(r.path("/admin/login"),t.reject(e)):t.reject(e)}}}]),app.factory("helperService",[function(){var e={};return e.getRoDay=function(e){return 0===e?"Duminica":1===e?"Luni":2===e?"Marti":3===e?"Miercuri":4===e?"Joi":5===e?"Vineri":6===e?"Sambata":void 0},e.getRoShortDay=function(e){return 0===e?"Du":1===e?"Lu":2===e?"Ma":3===e?"Mi":4===e?"Jo":5===e?"Vi":6===e?"Sa":void 0},e.getRoMonth=function(e){return 0===e?"Ianuarie":1===e?"Februari":2===e?"Martie":3===e?"Aprilie":4===e?"Mai":5===e?"Iunie":6===e?"Iulie":7===e?"August":8===e?"Septembrie":9===e?"Octombrie":10===e?"Noiembrie":11===e?"Decembrie":void 0},e.getRoShortMonth=function(e){return 0===e?"Ian.":1===e?"Feb.":2===e?"Mar.":3===e?"Apr.":4===e?"Mai":5===e?"Iun.":6===e?"Iul.":7===e?"Aug.":8===e?"Sep.":9===e?"Oct.":10===e?"Nov.":11===e?"Dec.":void 0},e.getFriendlyDate=function(e){var t=e.getDate(),n=e.getMonth()+1,r=e.getFullYear(),o=t;o<10&&(o="0"+t);var i=n;return i<10&&(i="0"+n),{dayAsString:this.getRoDay(e.getDay()),dayAsShortString:this.getRoShortDay(e.getDay()),dayOfMonth:o,monthAsString:this.getRoMonth(n-1),monthAsShortString:this.getRoShortMonth(n-1),year:r,ymd:r+"-"+i+"-"+o,dmy:o+"."+i+"."+r}},e.getDateFromString=function(e){var t=e.split("-"),n=t[1];return"0"===n[0]&&(n=n.charAt(1)),n-=1,new Date(t[0],n,t[2])},e.getStringFromString=function(e){var t=this.getDateFromString(e),n=this.getFriendlyDate(t),r=n.dayAsString+", "+n.dayOfMonth+" "+n.monthAsString+" "+n.year;return r},e.getObjFromString=function(e){var t=this.getDateFromString(e),n=this.getFriendlyDate(t);return{dayAsString:n.dayAsString,dayAsShortString:n.dayAsShortString,dayOfMonth:n.dayOfMonth,monthAsString:n.monthAsString,monthAsShortString:n.monthAsShortString,year:n.year,dateAsShortString:n.dayOfMonth+" "+n.monthAsShortString+" "+n.year}},e.getStringFromDate=function(e){return this.getFriendlyDate(e).ymd},e.makeId=function(e){for(var t="",n="abcdef0123456789",r=0;r<e;r+=1)t+=n.charAt(Math.floor(Math.random()*n.length));return t},e}]),app.service("helperValidator",[function(){function e(e,t,n,r){t[n].$setValidity("myValidation",!1),e.errors[n]=r}function t(e){var t=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}function n(e){return void 0===e||""===e||null===e}this.required=function(t,r,o,i){t[o][i]=t[o][i]||"";var a=t[o][i];n(a)&&e(t,r,i,"Acest camp este obligatoriu.")},this.required50=function(t,r,o,i){t[o][i]=t[o][i]||"";var a=t[o][i];n(a)?e(t,r,i,"Acest camp este obligatoriu."):a.length>50&&e(t,r,i,"Maxim 50 caractere.")},this.requiredEmail=function(r,o,i,a){var c=r[i][a];n(c)?e(r,o,a,"Acest camp este obligatoriu."):t(c)?c.length>50&&e(r,o,a,"Maxim 50 caractere."):e(r,o,a,"Adresa de email invalida.")},this.optionalEmail=function(n,r,o,i){var a=n[o][i];a&&a.length>0&&!t(a)?e(n,r,i,"Adresa de email invalida."):a&&a.length>50&&e(n,r,i,"Maxim 50 caractere.")},this.optional50=function(t,n,r,o){var i=t[r][o];i&&i.length>50&&e(t,n,o,"Maxim 50 caractere.")},this.requiredDate=function(t,r,o,i){var a=t[o][i];n(a)?e(t,r,i,"Acest camp este obligatoriu."):a instanceof Date==!1?e(t,r,i,"Data invalida."):a.length>50&&e(t,r,i,"Maxim 50 caractere.")},this.updateValidity=function(t,n,r){angular.forEach(r,function(r,o){e(t,n,r.field,r.msg)})},this.setAllFildsAsValid=function(e){angular.forEach(e,function(e,t){0!==t.indexOf("$")&&angular.forEach(e.$error,function(t,n){e.$setValidity(n,null)})})}}]),app.service("modalService",["$uibModal",function(e){this.show=function(t,n){var r={},o={};return angular.extend(r,t),angular.extend(o,n),r.controller||(r.controller=["$scope","$uibModalInstance",function(e,t){e.modalOptions=o,e.modalOptions.ok=function(e){t.close(e)},e.modalOptions.close=function(e){t.dismiss("cancel")}}]),e.open(r).result},this.confirm=function(e){var t={animation:!1,templateUrl:"app/common/templates/confirm.html"},n={closeButtonText:"Renunta",actionButtonText:"Sterge",headerText:"Sterge",bodyTitle:"Esti sigur ca vrei sa stergi aceasta inregistrare?",bodyDetails:""};return angular.extend(n,e),this.show(t,n)},this.showImage=function(e){var t={animation:!1,size:"lg",templateUrl:"app/common/templates/showImage.html"};return this.show(t,e)}}]),function(){function e(e,t,n,r,o,i,a,c,u,s){function l(){h=r.getById(v.orderLineId).then(function(e){v.orderLine=e,e.orderDate&&(v.orderDateAsString=p(e.orderDate).dateAsShortString),c.getByEmployeeAndDate(e.employeeName,e.orderDate).then(function(e){1===e.length&&(v.orderLine.option1=e[0].option1,v.orderLine.option2=e[0].option2,y=e[0])})})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function d(){g=u.getAll().then(function(e){v.customerEmployees=e})["catch"](function(e){alert(JSON.stringify(e,null,4))})}function f(e,t){var n="orderLine";o.setAllFildsAsValid(t),o.required50(e,t,n,"employeeName"),o.required50(e,t,n,"eatSeries")}function p(e){return s.getObjFromString(e)}function m(e,t){v.orderLine.option1&&(v.orderLine.option1=v.orderLine.option1.toUpperCase()),v.orderLine.option2&&(v.orderLine.option2=v.orderLine.option2.toUpperCase())}var g,h,v=this,y={},S=n.search();v.$onInit=function(){v.orderLine={},v.errors={},v.isFocusOnName=!v.isEditMode,v.obj={},v.customerEmployees=[],v.eatSeriesList=[{name:"Seria 1"},{name:"Seria 2"},{name:"Seria 3"}],d()},v.$routerOnActivate=function(e,t){v.orderId=e.params.id,v.orderLineId=e.params.id2,v.isEditMode="edit"===e.routeData.data.action,v.isEditMode?(v.pageTitle="Editeaza linia din comanda",l(),a.all([g,h]).then(function(e){v.obj.selectedEmployee=_.find(v.customerEmployees,{name:v.orderLine.employeeName})},function(e){alert("Failed: "+e)})):(v.pageTitle="Adauga o line la comanda",S.orderDate&&(v.orderLine.orderDate=S.orderDate,v.orderLine.orderId=v.orderId,v.orderDateAsString=p(S.orderDate).dateAsShortString))},v.create=function(e){return f(v,e),!e.$invalid&&(m(v.orderLine.option1,v.orderLine.option2),y&&y.option1&&v.orderLine.option1&&v.orderLine.option1.toLowerCase()===y.option1.toLowerCase()&&(v.orderLine.fromOwnerOpt1=!0),y&&y.option2&&v.orderLine.option2&&v.orderLine.option2.toLowerCase()===y.option2.toLowerCase()&&(v.orderLine.fromOwnerOpt2=!0),
void r.create(v.orderLine).then(function(e){n.path("/admin/orders/"+v.orderId)})["catch"](function(t){t.data.errors?o.updateValidity(v,e,t.data.errors):alert(JSON.stringify(t.data,null,4))}))},v.update=function(e){return f(v,e),!e.$invalid&&(m(v.orderLine.option1,v.orderLine.option2),y&&y.option1&&v.orderLine.option1&&v.orderLine.option1.toLowerCase()===y.option1.toLowerCase()?v.orderLine.fromOwnerOpt1=!0:delete v.orderLine.fromOwnerOpt1,y&&y.option2&&v.orderLine.option2&&v.orderLine.option2.toLowerCase()===y.option2.toLowerCase()?v.orderLine.fromOwnerOpt2=!0:delete v.orderLine.fromOwnerOpt2,void r.update(v.orderLine).then(function(e){n.path("/admin/orders/"+v.orderId)})["catch"](function(t){t.data.errors?o.updateValidity(v,e,t.data.errors):alert(JSON.stringify(t.data,null,4))}))},v.selectEmployee=function(e,t){v.orderLine.employeeName=v.obj.selectedEmployee.name,c.getByEmployeeAndDate(v.orderLine.employeeName,v.orderLine.orderDate).then(function(e){1===e.length?(v.orderLine.option1=e[0].option1,v.orderLine.option2=e[0].option2,y=e[0]):(v.orderLine.option1=void 0,v.orderLine.option2=void 0)})["catch"](function(e){alert(JSON.stringify(e,null,4))})},v.goBack=function(){t.history.back()}}var t=angular.module("celebrate-taste");t.component("orderLine",{templateUrl:"app/order/orderLine/orderLine.html",controllerAs:"vm",controller:["$route","$window","$location","orderLineService","helperValidator","toastr","$q","preferenceService","customerEmployeeService","helperService",e]})}(),function(){function e(e,t,n,r,o,i,a){function c(e,t){var n="importData";o.setAllFildsAsValid(t),o.required(e,t,n,"employeesName"),o.required50(e,t,n,"eatSeries")}function u(e){return a.getObjFromString(e)}var s=this,l=n.search();s.$onInit=function(){s.user={},s.errors={},s.importData={},s.eatSeriesList=[{name:"Seria 1"},{name:"Seria 2"},{name:"Seria 3"}],s.pageTitle="Importa comanda"},s.$routerOnActivate=function(e,t){s.orderId=e.params.id,l.orderDate&&(s.importData.orderDate=l.orderDate,s.importData.orderId=s.orderId,s.orderDateAsString=u(l.orderDate).dateAsShortString)},s.create=function(e){return c(s,e),!e.$invalid&&void r["import"](s.importData).then(function(e){n.path("/admin/orders/"+s.orderId)})["catch"](function(t){t.data.errors?o.updateValidity(s,e,t.data.errors):alert(JSON.stringify(t.data,null,4))})},s.goBack=function(){t.history.back()}}var t=angular.module("celebrate-taste");t.component("orderLineImport",{templateUrl:"app/order/orderLine/orderLineImport.html",controllerAs:"vm",controller:["$route","$window","$location","orderLineService","helperValidator","toastr","helperService",e]})}(),function(){function e(e,t,n,r,o){function i(){n.getAllWithBadgeInfo(a.orderId).then(function(t){a.orderLines=t,a.eatSeriesList=_.chain(a.orderLines).map("eatSeries").uniq().sortBy().value();var n=e.search();n.eatSeries?a.selectedEatSeries=n.eatSeries:a.selectedEatSeries="Toate seriile",n.preference?a.selectedPreference=n.preference:a.selectedPreference="Toate pref.",n.onlyNoBadges?a.obj.onlyNoBadges=!0:a.obj.onlyNoBadges=!1})["catch"](function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}var a=this;a.$onInit=function(){a.pageTitle="Utilizatori",a.orderLines=[],a.errors={},a.preferences=["A","B","C","D"],a.obj={},a.obj.onlyNoBadges=!1,i()},a.create=function(){e.path("/admin/orders/"+a.orderId+"/orderLines/create"),e.search("orderDate",a.orderDate)},a["import"]=function(){e.path("/admin/orders/"+a.orderId+"/orderLines/import"),e.search("orderDate",a.orderDate)},a["delete"]=function(e){var t={bodyDetails:"Comanda pentru "+e.employeeName};r.confirm(t).then(function(t){n["delete"](e._id).then(function(){_.remove(a.orderLines,{_id:e._id})})["catch"](function(e){a.errors=JSON.stringify(e.data,null,4),alert(a.errors)})},function(){})},a.filterBySearch=function(e){var t=!1;return a.search?(new RegExp(a.search,"i").test(e.name)||new RegExp(a.search,"i").test(e.email))&&(t=!0):t=!0,t},a.refresh=function(){i()},a.goBack=function(){t.history.back()},a.preferencesFilter=function(e){return"Toate pref."===a.selectedPreference||("A"===a.selectedPreference||"B"===a.selectedPreference?e.option1===a.selectedPreference:"C"===a.selectedPreference||"D"===a.selectedPreference?e.option2===a.selectedPreference:"Fara pref."===a.selectedPreference?!(e.option1&&e.option2):void 0)},a.eatSeriesFilter=function(e){return"Toate seriile"===a.selectedEatSeries||e.eatSeries===a.selectedEatSeries},a.badgesFilter=function(e){return!a.obj.onlyNoBadges||!e.badgeCode},a.selectOnlyNoBadges=function(){a.obj.onlyNoBadges===!1?(a.obj.onlyNoBadges=!0,e.search("onlyNoBadges",null)):(a.obj.onlyNoBadges=!1,e.search("onlyNoBadges",!0))},a.selectEatSeries=function(t){"Toate seriile"===t?(a.selectedEatSeries="Toate seriile",e.search("eatSeries",null)):(a.selectedEatSeries=t,e.search("eatSeries",t))},a.selectPreference=function(t){"Toate pref."===t?(a.selectedPreference="Toate pref.",e.search("preference",null)):(a.selectedPreference=t,e.search("preference",t))}}var t=angular.module("celebrate-taste");t.component("orderLineList",{bindings:{orderId:"<",orderDate:"<"},templateUrl:"app/order/orderLine/orderLineList.html",controllerAs:"vm",controller:["$location","$window","orderLineService","modalService","toastr",e]})}(),app.factory("orderLineService",["$http",function(e){var t={},n="/api/orderLines/";return t.getAll=function(t){var r="?$filter=orderId eq '"+t+"'";return e.get(n+"/getAllWithBadgeInfo"+r).then(function(e){return e.data})},t.getAllWithBadgeInfo=function(t){var r="?$filter=orderId eq '"+t+"'";return e.get(n+"/getAllWithBadgeInfo"+r).then(function(e){return e.data})},t.getEatSeriesDetails=function(t,r){var o="?$filter=orderId eq '"+t+"' and eatSeries eq '"+r+"'";return e.get(n+o).then(function(e){return e.data})},t.getOrderLinesByBadge=function(t,r){var o="?$filter=orderId eq '"+t+"' and badgeCode eq '"+encodeURIComponent(r)+"'";return e.get(n+o).then(function(e){return e.data})},t.getOrderLinesByEmployeeName=function(t,r){var o="?$filter=orderId eq '"+t+"' and employeeName eq '"+encodeURIComponent(r)+"'";return e.get(n+o).then(function(e){return e.data})},t.getOrderLinesBySeriesAndStatus=function(t,r,o){var i="?$filter=orderId eq '"+t+"' and eatSeries eq '"+r+"' and status eq '"+o+"'";return e.get(n+"/getAllWithBadgeInfo"+i).then(function(e){return e.data})},t.create=function(t){return e.post(n,t)},t.getById=function(t){return e.get(n+t).then(function(e){return e.data})},t.update=function(t){return e.put(n,t)},t["delete"]=function(t){return e["delete"](n+t)},t["import"]=function(t){return e.post(n+"rpc/import",t)},t}]);