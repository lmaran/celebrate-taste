"use strict";var app=angular.module("celebrate-taste",["ngCookies","ngSanitize","ngComponentRouter","ui.bootstrap","ui.select","ngAnimate","toastr","ngFileUpload"]);app.value("$routerRootComponent","mainApp"),app.config(["$locationProvider","$httpProvider",function(e,t){e.html5Mode(!0),t.interceptors.push("authInterceptor")}]),app.config(["toastrConfig",function(e){angular.extend(e,{positionClass:"toast-top-center"})}]),app.run(["$rootScope","$location","userService","$window",function(r,o,i,a){r.$on("$routeChangeStart",function(e,t,n){t.authenticate&&!i.isLoggedIn&&(e.preventDefault(),o.path("/login"))}),r.$on("$routeChangeSuccess",function(e,t,n){t.hasOwnProperty("$$route")&&(r.pageTitle=t.$$route.title),a.ga&&a.ga("send","pageview",{page:o.path(),title:r.pageTitle})}),r.goBack=function(){a.history.back()}}]),angular.module("celebrate-taste").component("mainApp",{template:"\n            <lm-navbar></lm-navbar>\n            <ng-outlet></ng-outlet>\n        ",$routeConfig:[{path:"/admin",component:"home",name:"Home"},{path:"/admin/customerEmployees",component:"customerEmployeeList",name:"CustomerEmployeeList"},{path:"/admin/customerEmployees/create",component:"customerEmployee",name:"CustomerEmployeeCreate"},{path:"/admin/customerEmployees/:id",component:"customerEmployee",name:"CustomerEmployeeEdit",data:{action:"edit"}},{path:"/admin/users",component:"userList",name:"UserList"},{path:"/admin/users/create",component:"user",name:"UserCreate"},{path:"/admin/users/:id",component:"user",name:"UserEdit",data:{action:"edit"}},{path:"/admin/dishes",component:"dishList",name:"DishList"},{path:"/admin/dishes/create",component:"dish",name:"DishCreate"},{path:"/admin/dishes/:id",component:"dish",name:"DishEdit",data:{action:"edit"}},{path:"/admin/menus",component:"menuList",name:"MenuList"},{path:"/admin/menus/:menuId/dishes/:dishId",component:"editDishForMenu",name:"EditDishForMenu"},{path:"/admin/menus/:id/add",component:"addDishToMenu",name:"AddDishToMenu"},{path:"/admin/preferences",component:"preferenceList",name:"PreferenceList"},{path:"/admin/preferences/create",component:"addPreferences",name:"PreferenceCreate"},{path:"/admin/preferences/:id",component:"preference",name:"PreferenceEdit"},{path:"/admin/orders",component:"orderList",name:"OrderList"},{path:"/admin/orders/:id",component:"order",name:"OrderEdit"},{path:"/admin/orders/:id/orderLines/create",component:"orderLine",name:"OrderLineCreate"},{path:"/admin/orders/:id/orderLines/:id2",component:"orderLine",name:"OrderLineEdit",data:{action:"edit"}},{path:"/admin/orders/:id/orderLines/import",component:"orderLineImport",name:"OrderLineImport"},{path:"/admin/deliveries",component:"deliveryList",name:"PreferenceList"},{path:"/admin/deliveries/:id",component:"delivery",name:"DeliveryEdit"},{path:"/admin/deliveryLogs",component:"deliveryLogList",name:"DeliveryLogList"},{path:"/admin/partnerOrders",component:"partnerOrderList",name:"PartnerOrderList"},{path:"/admin/reviews",component:"reviewList",name:"ReviewList"},{path:"/admin/assignedNames",component:"assignedNameList",name:"AssignedNameList"},{path:"/admin/assignedNames/create",component:"assignedName",name:"AssignedNameCreate"},{path:"/admin/assignedNames/:id",component:"assignedName",name:"AssignedNameEdit",data:{action:"edit"}},{path:"/admin/badges",component:"badgeList",name:"BadgeList"}]}),function(){var a;angular.module("celebrate-taste").component("assignedName",{templateUrl:"app/assignedName/assignedName.html",controllerAs:"vm",controller:["$route","$window","assignedNameService","helperValidator",function(e,t,n,r){var o=this;function i(e,t){var n="assignedName";r.setAllFildsAsValid(t),r.required50(e,t,n,"badgeOwnerCode"),r.required50(e,t,n,"employeeId")}o.$onInit=function(){o.assignedName={},o.errors={},o.isFocusOnName=!o.isEditMode,o.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}],o.badges=[{code:"0009877",ownerCode:"AMolnar AAaaa"},{code:"000987",ownerCode:"Molnar Aaaa"}],o.employees=[{_id:"112233445",name:"BMolnar Aaaa123"},{_id:"11223344",name:"Molnar Aaaa123"}]},o.$routerOnActivate=function(e,t){a=e.params.id,o.isEditMode="edit"===e.routeData.data.action,o.isEditMode?(o.pageTitle="Editeaza asociere",n.getById(a).then(function(e){o.assignedName=e}).catch(function(e){alert(JSON.stringify(e,null,4))})):o.pageTitle="Adauga asociere"},o.create=function(t){if(i(o,t),t.$invalid)return!1;var e=_.find(o.employees,{_id:o.assignedName.employeeId});o.assignedName.employeeName=e.name,n.create(o.assignedName).then(function(e){o.goBack()}).catch(function(e){e.data.errors?r.updateValidity(o,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},o.update=function(t){if(o.assignedName.askForNotification&&!o.assignedName.email)return alert("Ai ales sa notifici clientul dar lipseste adresa de email!"),!1;if(i(o,t),t.$invalid)return!1;var e=_.find(o.employees,{_id:o.assignedName.employeeId});o.assignedName.employeeName=e.name,n.update(o.assignedName).then(function(e){o.goBack()}).catch(function(e){e.data.errors?r.updateValidity(o,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},o.goBack=function(){t.history.back()}}]})}(),angular.module("celebrate-taste").component("badgeList",{templateUrl:"app/badge/badgeList.html",controllerAs:"vm",controller:["$location","$window","badgeService","Upload","modalService","toastr",function(e,t,n,r,o,i){var a=this;function c(){n.getAll().then(function(e){a.badges=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}a.$onInit=function(){a.pageTitle="Carduri",a.badges=[],a.errors={},c()},a.screenSize=window.getComputedStyle(document.body,":after").getPropertyValue("content").replace(/"/g,""),a.upload=function(e){if(e){if(a.errors.fileErrorMsg=(t=5,e.size>1024*t*1024?"Sunt acceptate doar fisiere cu dimensiunea de maximum "+t+" MB.":""),a.errors.fileErrorMsg)return!1;a.inProgress=!0,r.upload({url:"api/badges/upload",data:{file:e}}).then(function(e){a.errors.fileErrorMsg="",a.inProgress=!1,a.refresh(),i.success(e.data.importedBadges+" carduri au fost importate cu succes.")},function(e){a.errors.fileErrorMsg=e.data.msg,a.inProgress=!1},function(e){a.progressPercentage=Math.min(100,parseInt(100*e.loaded/e.total))})}var t},a.filterBySearch=function(e){var t=!1;return a.search&&!new RegExp(a.search,"i").test(e.code)&&!new RegExp(a.search,"i").test(e.ownerCode)||(t=!0),t},a.refresh=function(){c()},a.goBack=function(){t.history.back()}}]}),app.factory("badgeService",["$http",function(t){var e={},n="/api/badges/";return e.create=function(e){return t.post(n,e)},e.getAll=function(){return t.get(n).then(function(e){return e.data})},e.getById=function(e){return t.get(n+encodeURIComponent(e)).then(function(e){return e.data})},e.update=function(e){return t.put(n,e)},e.delete=function(e){return t.delete(n+encodeURIComponent(e))},e.getByCode=function(e){e="?$filter=code eq '"+encodeURIComponent(e)+"'";return t.get(n+e).then(function(e){return e.data})},e}]),function(){var a;angular.module("celebrate-taste").component("customerEmployee",{templateUrl:"app/customerEmployee/customerEmployee.html",controllerAs:"vm",controller:["$route","$window","customerEmployeeService","helperValidator",function(e,t,n,r){var o=this;function i(e,t){var n="customerEmployee";r.setAllFildsAsValid(t),r.required50(e,t,n,"name"),r.optionalEmail(e,t,n,"email")}o.$onInit=function(){o.customerEmployee={},o.errors={},o.isFocusOnName=!o.isEditMode,o.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},o.$routerOnActivate=function(e,t){a=e.params.id,o.isEditMode="edit"===e.routeData.data.action,o.isEditMode?(o.pageTitle="Editeaza angajat",n.getById(a).then(function(e){o.customerEmployee=e}).catch(function(e){alert(JSON.stringify(e,null,4))})):o.pageTitle="Adauga angajat"},o.create=function(t){if(i(o,t),t.$invalid)return!1;n.create(o.customerEmployee).then(function(e){o.goBack()}).catch(function(e){e.data.errors?r.updateValidity(o,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},o.update=function(t){return o.customerEmployee.askForNotification&&!o.customerEmployee.email?(alert("Ai ales sa notifici clientul dar lipseste adresa de email!"),!1):(i(o,t),!t.$invalid&&void n.update(o.customerEmployee).then(function(e){o.goBack()}).catch(function(e){e.data.errors?r.updateValidity(o,t,e.data.errors):alert(JSON.stringify(e.data,null,4))}))},o.goBack=function(){t.history.back()}}]})}(),angular.module("celebrate-taste").component("customerEmployeeList",{templateUrl:"app/customerEmployee/customerEmployeeList.html",controllerAs:"vm",controller:["$location","$window","customerEmployeeService","modalService",function(e,t,n,r){var o=this;function i(){n.getAllWithBadgeInfo().then(function(e){o.customerEmployees=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}o.$onInit=function(){o.pageTitle="Angajati client",o.customerEmployees=[],o.errors={},i()},o.create=function(){e.path("/admin/customerEmployees/create")},o.delete=function(t){var e={bodyDetails:t.name};r.confirm(e).then(function(e){n.delete(t._id).then(function(){_.remove(o.customerEmployees,{_id:t._id})}).catch(function(e){o.errors=JSON.stringify(e.data,null,4),alert(o.errors)})},function(){})},o.filterBySearch=function(e){var t=!1;return(!o.search||new RegExp(o.search,"i").test(e.name)||new RegExp(o.search,"i").test(e.badgeCode)||new RegExp(o.search,"i").test(e.adjustedName))&&(t=!0),t},o.refresh=function(){i()},o.goBack=function(){t.history.back()}}]}),app.factory("customerEmployeeService",["$http",function(t){var e={},n="/api/customerEmployees/";return e.getByBadge=function(e){e="?$filter=badgeCode eq '"+e+"' and isActive eq true";return t.get(n+e).then(function(e){return e.data})},e.create=function(e){return t.post(n,e)},e.getAll=function(){return t.get(n).then(function(e){return e.data})},e.getAllWithBadgeInfo=function(){return t.get(n+"/getAllWithBadgeInfo").then(function(e){return e.data})},e.getById=function(e){return t.get(n+encodeURIComponent(e)).then(function(e){return e.data})},e.update=function(e){return t.put(n,e)},e.delete=function(e){return t.delete(n+encodeURIComponent(e))},e}]),app.controller("createDeliveryTplController",["$scope","$uibModalInstance","helperService","deliveryService","helperValidator","$q","orderService","orderLineService","dataToModal",function(n,t,e,r,o,i,a,c,u){function s(){n.existNewSeries=!1,a.getEatSeriesList(n.selectedOrder._id).then(function(e){0===e.length?n.noSeries=!0:n.noSeries=!1,n.eatSeriesList=_.map(e,function(e){var t=!!_.some(u,{orderId:n.selectedOrder._id,eatSeries:e});return t||(n.existNewSeries=!0),{name:e,selected:!t,disabled:t}})})}n.errors={},n.noOrders=!1,n.noSeries=!1,n.eatSeriesList=[],n.delivery={},a.getAllOpen().then(function(e){n.orders=e,0<n.orders.length?(n.selectedOrder=e[0],s()):n.noOrders=!0}).catch(function(e){alert(JSON.stringify(e,null,4))}),n.selectOrder=function(){s()},n.create=function(e){n.selectedOrder&&(n.delivery.orderId=n.selectedOrder._id,n.delivery.orderDate=n.selectedOrder.date),n.delivery.eatSeriesList=_.chain(n.eatSeriesList).filter({selected:!0}).map("name").sortBy().value(),r.createMany(n.delivery).then(function(e){t.close()}).catch(function(e){})},n.cancel=function(){t.dismiss("cancel")}}]),function(){var b;angular.module("celebrate-taste").component("delivery",{templateUrl:"app/delivery/delivery.html",controllerAs:"vm",controller:["$route","$window","deliveryService","helperValidator","helperService","orderLineService","$uibModal","menuService","toastr","customerEmployeeService","orderService","deliveryLogService","badgeService","$timeout",function(e,t,n,r,o,i,a,c,u,s,l,d,f,p){var m=this;function g(){n.getById(b).then(function(e){var t;m.delivery=e,m.dateAsShortString=(t=m.delivery.orderDate,o.getObjFromString(t).dateAsShortString),t=m.delivery.orderDate,c.getMenu(t).then(function(e){m.menu=e[0]}).catch(function(e){alert(JSON.stringify(e,null,4))}),h(e.orderId,e.eatSeries)}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function h(e,t){l.getDeliverySummary(e,t).then(function(e){m.deliverySummary=e}).catch(function(e){alert(JSON.stringify(e,null,4))})}function y(){i.getOrderLinesBySeriesAndStatus(m.delivery.orderId,m.delivery.eatSeries,"open").then(function(e){m.orderLinesOpen=e}).catch(function(e){alert(JSON.stringify(e,null,4))})}function v(){i.getOrderLinesBySeriesAndStatus(m.delivery.orderId,m.delivery.eatSeries,"completed").then(function(e){m.orderLinesCompleted=_.orderBy(e,"deliveryDate","desc")}).catch(function(e){alert(JSON.stringify(e,null,4))})}function S(e){m.menu&&(m.option1=_.find(m.menu.dishes,{option:e.option1}),m.option2=_.find(m.menu.dishes,{option:e.option2}))}function O(e,t){return Array(Math.max(t-String(e).length+1,0)).join("0")+e}function A(e){if(e)return e.toLowerCase().replace(/ {2,}/g," ")}function $(e){m.errorValidation=!0,m.errorMessage=e;e={orderDate:m.delivery.orderDate,series:m.delivery.eatSeries,msg:e};d.create(e).then(function(){u.success("Datele despre acest card au fost memorate pt. investigatii ulterioare.")}).catch(function(e){alert(JSON.stringify(e.data,null,4))})}m.$onInit=function(){m.delivery={},m.errors={},m.selectedPreference="Toate pref.",m.deliverySummary={},m.obj={},m.obj.isFocusOnBadge=!0,m.preferences=["A","B","C","D"],f.getAll().then(function(e){m.badges=e}).catch(function(e){alert(JSON.stringify(e,null,4))}),s.getAll().then(function(e){m.customerEmployees=e}).catch(function(e){alert(JSON.stringify(e,null,4))})},m.$routerOnActivate=function(e,t){b=e.params.id,m.isEditMode="edit"===e.routeData.data.action,g()},m.openDeliveryLine=function(e,t){var n="app/delivery/openToCompleteTpl.html";"completed"===e.status&&(n="app/delivery/openToRevokeTpl.html"),S(e),a.open({animation:!1,templateUrl:n,controller:"openDeliveryLineTplController",resolve:{dataToModal:function(){return{orderLine:e,option1:m.option1,option2:m.option2}}}}).result.then(function(){"open"===t?m.refreshOpen():m.refreshCompleted()},function(){})},m.goBack=function(){t.history.back()},m.refreshOpen=function(){y()},m.selectTabOpen=function(){y()},m.refreshCompleted=function(){v()},m.selectTabCompleted=function(e){v()},m.selectTab1=function(){m.obj.isFocusOnBadge=!0,m.errorValidation=!1,m.orderLine=void 0,h(m.delivery.orderId,m.delivery.eatSeries)},m.deliverByBadge=function(e){if(m.errorValidation=!1,m.orderLine=void 0,m.obj.badgeCode=m.obj.badgeCode.trim(),10!==m.obj.badgeCode.length||isNaN(m.obj.badgeCode))return $("'"+m.obj.badgeCode+"' este un cod invalid! (nu are 10 cifre)"),m.obj.badgeCode="",void(m.obj.isFocusOnBadge=!0);var t,n,r,t=(t=m.obj.badgeCode,t=(r=parseInt(t,10).toString(16)).substr(0,r.length-4),r=r.substr(r.length-4),2<t.length&&(t=t.substr(t.length-2)),t=parseInt(t,16),r=parseInt(r,16),O(t,5)+O(r,5)),o=_.find(m.badges,{code:t});o?(n=o.ownerCode,(r=_.find(m.customerEmployees,function(e){return A(e.adjustedName)===A(o.ownerCode)}))&&(n=r.name),i.getOrderLinesByEmployeeName(m.delivery.orderId,n).then(function(e){0===e.length?$("Lipsa comanda pt. '"+n+"'."):1<e.length?$("Exista mai multe comenzi pentru aceeasi persoana: '"+n+"'."):e[0].eatSeries!==m.delivery.eatSeries?"completed"===e[0].status?$("'"+n+"' a mancat in "+e[0].eatSeries+"."):$("'"+n+"' a fost programat in "+e[0].eatSeries+"."):(m.orderLine=e[0],"completed"!==m.orderLine.status&&(e={},angular.copy(m.orderLine,e),e.status="completed",e.deliveryDate=new Date,e.deliveryMode="card",i.update(e).then(function(e){m.deliverySummary=e.data,u.success("Livrarea a fost inregistrata!")}).catch(function(e){alert(JSON.stringify(e.data,null,4))})),S(m.orderLine)),m.obj.badgeCode="",m.obj.isFocusOnBadge=!0}).catch(function(e){alert(JSON.stringify(e,null,4))})):($("Card negasit: "+t),m.obj.badgeCode="",m.obj.isFocusOnBadge=!0)},m.revoke=function(e){e.status="open",delete e.deliveryDate,i.update(e).then(function(e){u.success("Livrarea a fost anulata!"),m.orderLine=void 0,m.obj.isFocusOnBadge=!0,m.deliverySummary=e.data}).catch(function(e){alert(JSON.stringify(e.data,null,4))})},m.badgesFilter=function(e){return!m.obj.onlyNoBadges||!e.badgeCode},m.selectPreference=function(e){m.selectedPreference="Toate pref."===e?"Toate pref.":e},m.preferencesFilter=function(e){return"Toate pref."===m.selectedPreference||("A"===m.selectedPreference||"B"===m.selectedPreference?e.option1===m.selectedPreference:"C"===m.selectedPreference||"D"===m.selectedPreference?e.option2===m.selectedPreference:"Fara pref."===m.selectedPreference?!(e.option1&&e.option2):void 0)}}]})}(),angular.module("celebrate-taste").component("deliveryList",{templateUrl:"app/delivery/deliveryList.html",controllerAs:"vm",controller:["$location","$window","deliveryService","modalService","toastr","helperService","$uibModal",function(e,t,n,r,o,i,a){var c=this;function u(){n.getAll().then(function(e){c.deliveries=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}c.$onInit=function(){c.pageTitle="Livrari",c.deliveries=[],c.errors={},u()},c.openCreateDelivery=function(){a.open({animation:!1,templateUrl:"app/delivery/createDeliveryTpl.html",controller:"createDeliveryTplController",resolve:{dataToModal:function(){return c.deliveries}}}).result.then(function(){c.refresh()},function(){})},c.refresh=function(){u()},c.goBack=function(){t.history.back()},c.dt=function(e){return i.getObjFromString(e)}}]}),app.factory("deliveryService",["$http",function(n){var e={},r="/api/deliveries/";return e.create=function(e){return n.post(r,e)},e.createMany=function(e){return n.post(r+"rpc/createMany",e)},e.getAll=function(){return n.get(r).then(function(e){return e.data})},e.getById=function(e){return n.get(r+encodeURIComponent(e)).then(function(e){return e.data})},e.update=function(e){return n.put(r,e)},e.delete=function(e){return n.delete(r+encodeURIComponent(e))},e.count=function(e,t){return n.get(r+"$count?$filter="+e+" eq '"+t+"'").then(function(e){return e.data})},e}]),app.controller("openDeliveryLineTplController",["$scope","$uibModalInstance","helperService","deliveryService","helperValidator","$q","orderService","orderLineService","dataToModal",function(t,n,e,r,o,i,a,c,u){t.errors={},t.orderLine=u.orderLine,t.option1=u.option1,t.option2=u.option2,t.cancel=function(){n.dismiss("cancel")},t.update=function(e){t.orderLine.status="completed",t.orderLine.deliveryMode="manual",t.orderLine.deliveryDate=new Date,c.update(t.orderLine).then(function(e){n.close()}).catch(function(e){alert(JSON.stringify(e.data,null,4))})},t.revoke=function(){t.orderLine.status="open",delete t.orderLine.deliveryDate,c.update(t.orderLine).then(function(e){n.close()}).catch(function(e){alert(JSON.stringify(e.data,null,4))})}}]),angular.module("celebrate-taste").component("deliveryLogList",{templateUrl:"app/deliveryLog/deliveryLogList.html",controllerAs:"vm",controller:["$location","$window","deliveryLogService","modalService","toastr","helperService",function(e,t,n,r,o,i){var a=this;function c(){n.getAll().then(function(e){a.deliveryLogs=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}a.$onInit=function(){a.pageTitle="Notificari",a.deliveryLogs=[],a.errors={},c()},a.refresh=function(){c()},a.goBack=function(){t.history.back()},a.dt=function(e){return i.getObjFromString(e)}}]}),app.factory("deliveryLogService",["$http",function(t){var e={},n="/api/deliveryLogs/";return e.getAll=function(){return t.get(n).then(function(e){return e.data})},e.create=function(e){return t.post(n,e)},e}]),function(){var s;angular.module("celebrate-taste").component("dish",{templateUrl:"app/dish/dish.html",controllerAs:"vm",controller:["$route","$window","dishService","helperValidator","toastr","Upload","modalService",function(e,t,n,r,o,i,a){var c=this;function u(e,t){r.setAllFildsAsValid(t),r.required50(e,t,"dish","name"),r.required50(e,t,"dish","category")}c.$onInit=function(){c.dish={},c.errors={},c.isFocusOnName=!c.isEditMode,c.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},c.$routerOnActivate=function(e,t){s=e.params.id,c.isEditMode="edit"===e.routeData.data.action,c.isEditMode?(c.pageTitle="Editeaza felul de mancare",n.getById(s).then(function(e){c.dish=e}).catch(function(e){alert(JSON.stringify(e,null,4))})):c.pageTitle="Adauga un fel de mancare"},c.create=function(t){if(u(c,t),t.$invalid)return!1;n.create(c.dish).then(function(e){c.goBack()}).catch(function(e){e.data.errors?r.updateValidity(c,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},c.update=function(t){if(u(c,t),t.$invalid)return!1;n.update(c.dish).then(function(e){c.goBack()}).catch(function(e){e.data.errors?r.updateValidity(c,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},c.goBack=function(){t.history.back()},c.screenSize=window.getComputedStyle(document.body,":after").getPropertyValue("content").replace(/"/g,""),c.upload=function(e){if(e){if(c.errors.fileErrorMsg=function(e,t,n,r){if(e.size>1024*t*1024)return"Sunt acceptate doar poze cu dimensiunea de maximum "+t+" MB.";if("image/jpeg"!==e.type)return"Sunt acceptate doar poze in format '.jpg'.";if(e.$ngfWidth<e.$ngfHeight)return"Sunt acceptate doar poze in format 'landscape' (latime > inaltime).";if(e.$ngfWidth<n)return"Sunt acceptate doar poze cu latimea de minimum "+n+" px.";if(e.$ngfHeight<r)return"Sunt acceptate doar poze cu inaltimea de minimum "+r+" px.";return""}(e,10,960,640),c.errors.fileErrorMsg)return!1;c.inProgress=!0,i.upload({url:"api/dishes/upload",data:{file:e}}).then(function(e){c.dish.image=e.data,c.errors.fileErrorMsg="",c.inProgress=!1},function(e){c.errors.fileErrorMsg=e.data.msg,c.inProgress=!1},function(e){c.progressPercentage=Math.min(100,parseInt(100*e.loaded/e.total))})}},c.removeImage=function(){delete c.dish.image,c.errors.fileErrorMsg=""},c.showModal=function(e){e={imageUrl:e.image.large};a.showImage(e).then(function(e){})}}]})}(),angular.module("celebrate-taste").component("dishList",{templateUrl:"app/dish/dishList.html",controllerAs:"vm",controller:["$location","$window","dishService","modalService","toastr",function(e,t,n,r,o){var i=this;function a(){n.getAll().then(function(e){i.dishes=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}i.$onInit=function(){i.pageTitle="Feluri de mancare",i.dishes=[],i.errors={},a()},i.create=function(){e.path("/admin/dishes/create")},i.delete=function(t){var e={bodyDetails:t.name};r.confirm(e).then(function(e){n.delete(t._id).then(function(){_.remove(i.dishes,{_id:t._id})}).catch(function(e){i.errors=JSON.stringify(e.data,null,4),alert(i.errors)})},function(){})},i.refresh=function(){a()},i.goBack=function(){t.history.back()},i.showModal=function(e){e={imageUrl:e.image.large};r.showImage(e).then(function(e){})}}]}),app.factory("dishService",["$http",function(t){var e={},n="/api/dishes/";return e.create=function(e){return t.post(n,e)},e.getAll=function(){return t.get(n).then(function(e){return e.data})},e.getById=function(e){return t.get(n+encodeURIComponent(e)).then(function(e){return e.data})},e.update=function(e){return t.put(n,e)},e.delete=function(e){return t.delete(n+encodeURIComponent(e))},e}]),angular.module("celebrate-taste").component("home",{template:'\n            <div class="container">    \n                </br>\n                </br>\n                <p ng-if-start="vm.isAdmin()"><a ng-href="/admin/users">Utilizatori</a></p>\n                <p><a ng-href="/admin/customerEmployees">Angajati client</a></p>\n                <p><a ng-href="/admin/badges">Carduri</a></p>                \n                <p><a ng-href="/admin/dishes">Feluri de mancare</a></p>\n                <p><a ng-href="/admin/menus">Meniuri</a></p>\n                <p><a ng-href="/admin/preferences">Preferinte</a></p>\n                <p><a ng-href="/admin/orders">Comenzi</a></p>\n                <p><a ng-href="/admin/deliveries">Livrari</a></p>                                            \n                <p ng-if-end><a ng-href="/admin/reviews">Feedback clienti</a></p>\n                \n                <p><a ng-href="/admin/deliveryLogs">Notificari</a></p>\n                <p><a ng-href="/admin/partnerOrders">Raport comenzi</a></p>\n            </div>        \n        ',controllerAs:"vm",controller:["userService",function(e){var t=this;t.$onInit=function(){t.isAdmin=e.isAdmin}}]}),function(){var l;angular.module("celebrate-taste").component("addDishToMenu",{templateUrl:"app/menu/addDishToMenu.html",controllerAs:"vm",controller:["$window","menuService","dishService","helperValidator","helperService","toastr","modalService",function(e,r,t,n,o,i,a){var c=this;function u(){r.getById(l).then(function(e){c.menu=e,c.roMenuDate=o.getStringFromString(e.menuDate)}).catch(function(e){alert(JSON.stringify(e,null,4))})}function s(){t.getAll().then(function(e){c.dishes=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}c.$onInit=function(){c.pageTitle="Editeaza produsul din meniu",c.menu={},c.categories=[{value:0,name:"Toate felurile"},{value:1,name:"Supa"},{value:2,name:"Felul 2"},{value:3,name:"Salata"},{value:4,name:"Desert"}],c.selectedCategory=c.categories[0],c.isFastingSelected=!1,c.selectCategory=function(e){c.selectedCategory=e},c.dishes=[],c.status={isopen:!1}},c.$routerOnActivate=function(e,t){l=e.params.id,s(),u()},c.addToMenu=function(t){var e,n={};angular.copy(t,n),"1"!==t.category&&"2"!==t.category||(n.option=void 0===(e=c.menu.dishes)||0===e.length?"A":(e=e[e.length-1],String.fromCharCode(e.option.charCodeAt(0)+1))),void 0===c.menu.dishes&&(c.menu.dishes=[]),c.menu.dishes.push(n),r.update(c.menu).then(function(e){t.isAddedTmp=!0,u()}).catch(function(e){alert(JSON.stringify(e.data,null,4))})},c.removeFromMenu=function(t){_.remove(c.menu.dishes,function(e){return e._id===t._id}),r.update(c.menu).then(function(e){delete t.isAddedTmp}).catch(function(e){alert(JSON.stringify(e.data,null,4))})},c.goBack=function(){e.history.back()},c.refresh=function(){s(),u()},c.showModal=function(e){e={imageUrl:e.image.large};a.showImage(e).then(function(e){})}}]})}(),app.controller("createMenuTplController",["$scope","$uibModalInstance","dataToModal","helperService",function(e,t,n,r){e.menuDate=r.getDateFromString(n),e.menuDate.setDate(e.menuDate.getDate()+1),e.ok=function(){t.close(e.menuDate)},e.cancel=function(){t.dismiss("cancel")},e.dateOptions={startingDay:1},e.isOpen=!1,e.open=function(){e.isOpen=!0}}]),function(){var u,s;angular.module("celebrate-taste").component("editDishForMenu",{templateUrl:"app/menu/editDishForMenu.html",controllerAs:"vm",controller:["$route","$window","menuService","helperValidator","helperService","toastr",function(e,t,r,o,n,i){var a=this;function c(){r.getById(u).then(function(e){var t;a.menu=e,a.menuDateAsString=(t=a.menu.menuDate,n.getObjFromString(t).dateAsShortString),a.dish=_.find(e.dishes,{_id:s})}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}a.$onInit=function(){a.pageTitle="Editeaza produsul din meniu",a.menu={},a.dish={},a.errors={},a.isFocusOnName=!a.isEditMode,a.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},a.$routerOnActivate=function(e,t){u=e.params.menuId,s=e.params.dishId,c()},a.update=function(t){var e,n;if(e=a,n=t,o.setAllFildsAsValid(n),o.required50(e,n,"dish","name"),o.required50(e,n,"dish","category"),t.$invalid)return!1;r.update(a.menu).then(function(e){a.goBack()}).catch(function(e){e.data.errors?o.updateValidity(a,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},a.goBack=function(){t.history.back()}}]})}(),angular.module("celebrate-taste").component("menuList",{templateUrl:"app/menu/menuList.html",controllerAs:"vm",controller:["$location","$window","menuService","modalService","helperService","toastr","$uibModal",function(e,t,r,o,n,i,a){var c=this;function u(){r.getActiveMenus().then(function(e){c.menus=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}c.$onInit=function(){c.pageTitle="Meniuri",c.menus=[],c.errors={},u()},c.create=function(e){e={menuDate:e};r.create(e).then(function(e){c.refresh()}).catch(function(e){alert(JSON.stringify(e.data,null,4))})},c.delete=function(t){var e={bodyDetails:"Meniul de "+c.friendlyDate(t.menuDate)};o.confirm(e).then(function(e){r.delete(t._id).then(function(){_.remove(c.menus,{_id:t._id})}).catch(function(e){c.errors=JSON.stringify(e.data,null,4),alert(c.errors)})},function(){})},c.filterBySearch=function(e){var t=!1;return c.search&&!new RegExp(c.search,"i").test(e.name)&&!new RegExp(c.search,"i").test(e.email)||(t=!0),t},c.refresh=function(){u()},c.goBack=function(){t.history.back()},c.friendlyDate=function(e){return n.getStringFromString(e)},c.deleteDishFromMenu=function(t,n){var e={bodyDetails:t.name};o.confirm(e).then(function(e){_.remove(n.dishes,{_id:t._id}),r.update(n).then(function(e){c.refresh()}).catch(function(e){alert(JSON.stringify(e.data,null,4))})})},c.openCreateMenu=function(){var e=_.chain(c.menus).sortBy("menuDate").last().value(),t=e&&e.menuDate||n.getStringFromDate(new Date);a.open({animation:!1,templateUrl:"app/menu/createMenuTpl.html",controller:"createMenuTplController",resolve:{dataToModal:function(){return t}}}).result.then(function(e){e=n.getStringFromDate(e);c.create(e)},function(){})},c.showModal=function(e){e={imageUrl:e.image.large};o.showImage(e).then(function(e){})}}]}),app.factory("menuService",["$http","helperService",function(t,n){var e={},r="/api/menus/";return e.create=function(e){return t.post(r,e)},e.getAll=function(){return t.get(r).then(function(e){return e.data})},e.getNextMenus=function(){return t.get(r+"nextMenus/").then(function(e){return e.data})},e.getActiveMenus=function(){var e=n.getStringFromDate(new Date);return t.get(r+"rpc/getActiveMenus?today="+e).then(function(e){return e.data})},e.getById=function(e){return t.get(r+encodeURIComponent(e)).then(function(e){return e.data})},e.getMenu=function(e){e="?$filter=menuDate eq '"+e+"'";return t.get(r+e).then(function(e){return e.data})},e.update=function(e){return t.put(r,e)},e.delete=function(e){return t.delete(r+encodeURIComponent(e))},e}]),angular.module("celebrate-taste").component("lmNavbar",{templateUrl:"app/navbar/navbar.html",controllerAs:"vm",controller:["$http","userService","$location",function(e,t,n){var r=this;r.$onInit=function(){r.isCollapsed=!0,r.isLoggedIn=t.isLoggedIn,r.isAdmin=t.isAdmin,r.isPartnerOrAdmin=t.isPartnerOrAdmin,r.getCurrentUser=t.getCurrentUser},r.isActive=function(e){return e===n.path()}}]}),app.controller("nextMenusController",["$scope","$location","menuService","helperService",function(t,e,n,r){t.menus=[],t.errors={},t.friendlyDate=function(e){return r.getStringFromString(e)},n.getNextMenus().then(function(e){t.menus=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}]),app.controller("nextMenusItemController",["$scope","$route","menuService",function(t,n,e){t.menu={},t.dish={},e.getById(n.current.params.menuId).then(function(e){t.menu=e,t.dish=_.find(e.dishes,"_id",n.current.params.dishId)}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}]),app.controller("createOrderTplController",["$scope","$uibModalInstance","helperService","orderService","helperValidator","$q",function(r,t,o,i,a,c){r.errors={},r.order={date:new Date},r.minDate=new Date,r.create=function(e){(function(e,t){var n=c.defer();if(a.setAllFildsAsValid(t),a.requiredDate(e,t,"order","date"),t.$invalid)return n.resolve(),n.promise;return u(t).then(function(){n.resolve()}),n.promise})(r,e).then(function(){return!e.$invalid&&(r.order.date=o.getStringFromDate(r.order.date),void i.create(r.order).then(function(e){t.close()}).catch(function(e){}))})};var u=function(t){var n=c.defer(),e=o.getStringFromDate(r.order.date);return i.count("date",e).then(function(e){0<e&&a.updateValidity(r,t,[{field:"date",msg:"Exista deja o comanda pentru aceasta data."}]),n.resolve()}).catch(function(e){alert(JSON.stringify(e,null,4)),n.reject()}),n.promise};r.cancel=function(){t.dismiss("cancel")},r.dateOptions={startingDay:1},r.isOpen=!1,r.open=function(){r.isOpen=!0}}]),angular.module("celebrate-taste").component("order",{templateUrl:"app/order/order.html",controllerAs:"vm",controller:["$route","$window","orderService","helperValidator","toastr","helperService",function(e,t,n,r,o,i){var a=this;function c(){n.getById(a.orderId).then(function(e){a.order=e,a.dateAsShortString=(e=a.order.date,i.getObjFromString(e).dateAsShortString)}).catch(function(e){alert(JSON.stringify(e,null,4))})}a.$onInit=function(){},a.$routerOnActivate=function(e,t){a.orderId=e.params.id,c()},a.goBack=function(){t.history.back()}}]}),angular.module("celebrate-taste").component("orderList",{templateUrl:"app/order/orderList.html",controllerAs:"vm",controller:["$location","$window","orderService","modalService","toastr","helperService","$uibModal",function(e,t,r,o,n,i,a){var c=this;function u(){r.getAll().then(function(e){c.orders=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}c.$onInit=function(){c.pageTitle="Comenzi",c.orders=[],c.errors={},u()},c.openCreateOrder=function(){a.open({animation:!1,templateUrl:"app/order/createOrderTpl.html",controller:"createOrderTplController"}).result.then(function(){c.refresh()},function(){})},c.delete=function(t){var e={bodyDetails:t.name};o.confirm(e).then(function(e){r.delete(t._id).then(function(){_.remove(c.orders,{_id:t._id})}).catch(function(e){c.errors=JSON.stringify(e.data,null,4),alert(c.errors)})},function(){})},c.refresh=function(){u()},c.goBack=function(){t.history.back()},c.dt=function(e){return i.getObjFromString(e)},c.closeOrder=function(n){o.confirm({actionButtonText:"Finalizeaza",headerText:"Finalizare/Arhivare comanda",bodyTitle:"Esti sigur ca vrei sa finalizezi aceasta comanda?",bodyDetails:"Odata finalizata, comanda nu mai poate fi redeschisa!"}).then(function(e){r.closeOrder(n).then(function(e){var t=_.find(c.orders,{_id:n});t.summary=e,t.status="completed"}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})},function(){})},c.showEmployees=function(e,t){e={closeButtonText:"Renunta",headerText:t,employees:e};o.show({animation:!1,templateUrl:"app/common/templates/showEmployees.html"},e).then(function(){},function(){})}}]}),app.factory("orderService",["$http",function(n){var e={},r="/api/orders/";return e.count=function(e,t){return n.get(r+"$count?$filter="+e+" eq '"+t+"'").then(function(e){return e.data})},e.getAllOpen=function(){return n.get(r+"?$filter=status eq 'open'").then(function(e){return e.data})},e.create=function(e){return n.post(r,e)},e.getAll=function(){return n.get(r).then(function(e){return e.data})},e.getById=function(e){return n.get(r+e).then(function(e){return e.data})},e.update=function(e){return n.put(r,e)},e.delete=function(e){return n.delete(r+e)},e.getEatSeriesList=function(e){return n.get(r+e+"/rpc/getEatSeriesList").then(function(e){return e.data})},e.getDeliverySummary=function(e,t){return n.get(r+e+"/rpc/getDeliverySummary/"+encodeURIComponent(t)).then(function(e){return e.data})},e.closeOrder=function(e){return n.post(r+e+"/rpc/closeOrder").then(function(e){return e.data})},e}]),angular.module("celebrate-taste").component("partnerOrderList",{templateUrl:"app/partnerOrder/partnerOrderList.html",controllerAs:"vm",controller:["$location","$window","partnerOrderService","modalService","toastr","helperService","$uibModal",function(e,t,n,r,o,i,a){var c=this;function u(){n.getAll().then(function(e){c.partnerOrders=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}c.$onInit=function(){c.pageTitle="Comenzi",c.partnerOrders=[],c.errors={},u()},c.showEmployees=function(e,t){e={closeButtonText:"Renunta",headerText:t,employees:e};r.show({animation:!1,templateUrl:"app/common/templates/showEmployees.html"},e)},c.refresh=function(){u()},c.goBack=function(){t.history.back()},c.dt=function(e){return i.getObjFromString(e)}}]}),app.factory("partnerOrderService",["$http",function(n){var e={},r="/api/partnerOrders/";return e.count=function(e,t){return n.get(r+"$count?$filter="+e+" eq '"+t+"'").then(function(e){return e.data})},e.getAllOpen=function(){return n.get(r+"?$filter=status eq 'open'").then(function(e){return e.data})},e.create=function(e){return n.post(r,e)},e.getAll=function(){return n.get(r).then(function(e){return e.data})},e.getById=function(e){return n.get(r+e).then(function(e){return e.data})},e.update=function(e){return n.put(r,e)},e.delete=function(e){return n.delete(r+e)},e.getEatSeriesList=function(e){return n.get(r+e+"/rpc/getEatSeriesList").then(function(e){return e.data})},e.getDeliverySummary=function(e,t){return n.get(r+e+"/rpc/getDeliverySummary/"+encodeURIComponent(t)).then(function(e){return e.data})},e.closepartnerOrder=function(e){return n.post(r+e+"/rpc/closepartnerOrder").then(function(e){return e.data})},e}]),app.controller("partnerOrdersController",["$scope","$location","partnerOrderService","modalService","helperService","$uibModal",function(r,e,o,i,t,n){function a(){o.getAll().then(function(e){r.partnerOrders=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}r.partnerOrders=[],r.errors={},a(),r.delete=function(n){var e={bodyDetails:n.name};i.confirm(e).then(function(e){var t=0;for(t in r.partnerOrders)if(r.partnerOrders[t]._id===n._id)break;o.delete(n._id).then(function(){r.partnerOrders.splice(t,1)}).catch(function(e){r.errors=JSON.stringify(e.data,null,4),alert(r.errors)})})},r.openCreatepartnerOrder=function(){n.open({animation:!1,templateUrl:"app/partnerOrder/createpartnerOrderTpl.html",controller:"createpartnerOrderTplController"}).result.then(function(){r.refresh()},function(){})},r.refresh=function(){a()},r.dt=function(e){return t.getObjFromString(e)},r.closepartnerOrder=function(n){i.confirm({actionButtonText:"Finalizeaza",headerText:"Finalizare/Arhivare comanda",bodyTitle:"Esti sigur ca vrei sa finalizezi aceasta comanda?",bodyDetails:"Odata finalizata, comanda nu mai poate fi redeschisa!"}).then(function(e){o.closepartnerOrder(n).then(function(e){var t=_.find(r.partnerOrders,{_id:n});t.summary=e,t.status="completed"}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})})},r.showEmployees=function(e,t){e={closeButtonText:"Renunta",headerText:t,employees:e};i.show({animation:!1,templateUrl:"app/common/templates/showEmployees.html"},e)}}]),function(){var e=angular.module("celebrate-taste");e.component("addPreferences",{templateUrl:"app/preference/addPreferences.html",controllerAs:"vm",controller:["$route","$window","preferenceService","helperValidator","customerEmployeeService","helperService","toastr","menuService","$scope",function(e,t,i,a,n,r,c,o,u){var l=this;l.$onInit=function(){l.preference={},l.errors={},l.pageTitle="Adauga preferinte",l.person={},l.customerEmployees=[],l.menus=[],l.nextEmployeePreferences=[],l.preferences=[]},l.$routerOnActivate=function(e,t){e.params.id,o.getActiveMenus().then(function(e){l.menus=e,l.menuIsReady=!0}).catch(function(e){alert(JSON.stringify(e,null,4))}),n.getAll().then(function(e){l.customerEmployees=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})},l.create=function(t){var r,o;if(r=l,o=t,a.setAllFildsAsValid(o),r.preferencesHaveErrors=!1,r.preferences.some(function(e){if(!e.alreadyAdded){var t=e.option1.toUpperCase();if(1===t.length&&-1===e.availableForOption1.indexOf(t)){var n="input"+(2*e.rowIndex).toString();return o[n].$setValidity("myValidation",!1),r.errors.preferences="Ai introdus un cod invalid.",r.preferencesHaveErrors=!0}n=e.option2.toUpperCase();if(1===n.length&&-1===e.availableForOption2.indexOf(n)){e="input"+(2*e.rowIndex+1).toString();return o[e].$setValidity("myValidation",!1),r.errors.preferences="Ai introdus un cod invalid.",r.preferencesHaveErrors=!0}}}),r.preferencesHaveErrors,t.$invalid)return!1;var n=[];l.preferences.forEach(function(e){var t;e.alreadyAdded||""===e.option1&&""===e.option2||(t={employeeName:l.person.selected.name,date:e.date},""!==e.option1&&(t.option1=e.option1.toUpperCase()),""!==e.option2&&(t.option2=e.option2.toUpperCase()),n.push(t))}),0<n.length?i.createMany(n).then(function(e){l.person.selected=void 0,u.$broadcast("SetFocus"),c.success("Inregistrarea a fost adaugata!")}).catch(function(e){e.data.errors?a.updateValidity(l,t,e.data.errors):alert(JSON.stringify(e.data,null,4))}):alert("Nu ai adaugat nicio preferinta!")},l.selectEmployee=function(e,t){l.preferencesHaveErrors=!1,e=e.name,i.getNextByEmployee(e).then(function(u){l.nextEmployeePreferences=u,l.preferences=[];var s=!0;l.menus.forEach(function(e,t){var n=_.find(u,{date:e.menuDate}),r=!!n,o=_.chain(e.dishes).filter({category:"1"}).map("option").uniq().sortBy().value(),i=_.chain(e.dishes).filter({category:"2"}).map("option").uniq().sortBy().value(),a=!1,c=!1;!r&&s&&(0<o.length?s=!(a=!0):0<i.length&&(s=!(c=!0)));t={alreadyAdded:r,date:e.menuDate,option1:n?n.option1:"",option2:n?n.option2:"",availableForOption1:o,availableForOption2:i,isFocusOnOption1:a,isFocusOnOption2:c,rowIndex:t};l.preferences.push(t)})}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})},l.dt=function(e){return r.getObjFromString(e)},l.goBack=function(){t.history.back()}}]}),e.directive("moveNextOnMaxlength",function(){return{restrict:"A",link:function(e,o){o.on("input",function(e){if(o.val().length==o.attr("maxlength")){for(var t=o[0].id,n=parseInt(t)+1,r=angular.element(document.getElementById(n.toString()));r.length&&r[0].disabled;)t=r[0].id,n=parseInt(t)+1,r=angular.element(document.getElementById(n.toString()));r.length&&r[0].focus()}})}}})}(),function(){var a;angular.module("celebrate-taste").component("preference",{templateUrl:"app/preference/preference.html",controllerAs:"vm",controller:["$route","$window","preferenceService","helperValidator","toastr",function(e,t,n,r,o){var i=this;i.$onInit=function(){i.preference={},i.errors={},i.pageTitle="Editeaza preferinte"},i.$routerOnActivate=function(e,t){a=e.params.id,n.getById(a).then(function(e){i.preference=e}).catch(function(e){alert(JSON.stringify(e,null,4))})},i.update=function(t){n.update(i.preference).then(function(e){i.goBack()}).catch(function(e){e.data.errors?r.updateValidity(i,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},i.goBack=function(){t.history.back()}}]})}(),app.controller("preferenceController",["$scope","$route","preferenceService","$location","helperValidator","menuService","customerEmployeeService","helperService","toastr",function(l,e,r,n,a,t,o,i,c){l.isEditMode=e.current.isEditMode,l.isFocusOnName=!l.isEditMode,l.errors={},l.preference={},l.person={},l.customerEmployees=[],l.menus=[],l.nextEmployeePreferences=[],l.selectEmployee=function(e,t){l.preferencesHaveErrors=!1,e=e.name,r.getNextByEmployee(e).then(function(u){l.nextEmployeePreferences=u,l.preferences=[];var s=!0;l.menus.forEach(function(e,t){var n=_.find(u,{date:e.menuDate}),r=!!n,o=_.chain(e.dishes).filter({category:"1"}).map("option").uniq().sortBy().value(),i=_.chain(e.dishes).filter({category:"2"}).map("option").uniq().sortBy().value(),a=!1,c=!1;!r&&s&&(0<o.length?s=!(a=!0):0<i.length&&(s=!(c=!0)));t={alreadyAdded:r,date:e.menuDate,option1:n?n.option1:"",option2:n?n.option2:"",availableForOption1:o,availableForOption2:i,isFocusOnOption1:a,isFocusOnOption2:c,rowIndex:t};l.preferences.push(t)})}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})},l.isEditMode?r.getById(e.current.params.id).then(function(e){l.preference=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))}):(t.getActiveMenus().then(function(e){l.menus=e,l.menuIsReady=!0}).catch(function(e){alert(JSON.stringify(e,null,4))}),o.getAll().then(function(e){l.customerEmployees=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})),l.preferences=[],l.create=function(t){if(!function(r,o){a.setAllFildsAsValid(o);var i=r.preferencesHaveErrors=!1;r.preferences.some(function(e){if(!e.alreadyAdded){var t=e.option1.toUpperCase();if(1===t.length&&(i=!0,-1===e.availableForOption1.indexOf(t))){var n="input"+(2*e.rowIndex).toString();return o[n].$setValidity("myValidation",!1),r.errors.preferences="Ai introdus un cod invalid.",r.preferencesHaveErrors=!0}n=e.option2.toUpperCase();if(1===n.length&&(i=!0,-1===e.availableForOption2.indexOf(n))){e="input"+(2*e.rowIndex+1).toString();return o[e].$setValidity("myValidation",!1),r.errors.preferences="Ai introdus un cod invalid.",r.preferencesHaveErrors=!0}}}),i||(r.form.$invalid=!0,r.errors.preferences="Nu ai adaugat optiuni noi.",r.preferencesHaveErrors=!0);r.preferencesHaveErrors}(l,t),t.$invalid)return!1;var n=[];l.preferences.forEach(function(e){var t;e.alreadyAdded||""===e.option1&&""===e.option2||(t={employeeName:l.person.selected.name,date:e.date},""!==e.option1&&(t.option1=e.option1.toUpperCase()),""!==e.option2&&(t.option2=e.option2.toUpperCase()),n.push(t))}),r.createMany(n).then(function(e){c.success("Inregistrarea a fost adaugata!"),l.person.selected=void 0,l.$broadcast("SetFocus")}).catch(function(e){e.data.errors?a.updateValidity(l,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},l.update=function(t){r.update(l.preference).then(function(e){n.path("/admin/preferences")}).catch(function(e){e.data.errors?a.updateValidity(l,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},l.dt=function(e){return i.getObjFromString(e)}}]),app.directive("moveNextOnMaxlength",function(){return{restrict:"A",link:function(e,o){o.on("input",function(e){if(o.val().length==o.attr("maxlength")){for(var t=o[0].id,n=parseInt(t)+1,r=angular.element(document.getElementById(n.toString()));r.length&&r[0].disabled;)t=r[0].id,n=parseInt(t)+1,r=angular.element(document.getElementById(n.toString()));r.length&&r[0].focus()}})}}}),angular.module("celebrate-taste").component("preferenceList",{templateUrl:"app/preference/preferenceList.html",controllerAs:"vm",controller:["$location","$window","preferenceService","modalService","toastr","helperService",function(t,e,n,r,o,i){var a=this;function c(){n.getNextDates().then(function(e){a.nextDates=e;e=t.search();e.date?a.selectedDate=e.date:0===a.nextDates.length?a.nextDates.push("Nu exista date"):a.selectedDate=a.nextDates[0],a.selectedDate&&u(a.selectedDate),e.onlyFromOnline?a.obj.onlyFromOnline=!0:a.obj.onlyFromOnline=!1}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function u(e){n.getByDate(e).then(function(e){a.preferences=e,a.preferences.forEach(function(e){e.option1||(e.option1="-");var t=_.find(a.option1Summary,{key:e.option1});t?t.total+=1:a.option1Summary.push({key:e.option1,total:1})}),a.preferences.forEach(function(e){e.option2||(e.option2="-");var t=_.find(a.option2Summary,{key:e.option2});t?t.total+=1:a.option2Summary.push({key:e.option2,total:1})})}).catch(function(e){alert(JSON.stringify(e,null,4))})}a.$onInit=function(){a.pageTitle="Preferinte",a.preferences=[],a.errors={},a.nextDates=[],a.obj={},a.obj.onlyFromOnline=!1,a.option1Summary=[],a.option2Summary=[],c()},a.delete=function(t){var e={bodyDetails:t.name};r.confirm(e).then(function(e){n.delete(t._id).then(function(){_.remove(a.preferences,{_id:t._id})}).catch(function(e){a.errors=JSON.stringify(e.data,null,4),alert(a.errors)})},function(){})},a.filterByOnline=function(e){return!a.obj.onlyFromOnline||e.fromOnline},a.refresh=function(){c()},a.goBack=function(){e.history.back()},a.dt=function(e){return i.getObjFromString(e)},a.selectOnlyFromOnline=function(){!1===a.obj.onlyFromOnline?t.search("onlyFromOnline",null):t.search("onlyFromOnline",!0)},a.selectDate=function(e){"Nu exista date"!==e&&(a.selectedDate=e,t.search("date",e),u(a.selectedDate))}}]}),app.factory("preferenceService",["$http","helperService",function(n,r){var e={},o="/api/preferences/";return e.create=function(e){return n.post(o,e)},e.createMany=function(e){return n.post(o+"rpc/createMany",e)},e.getByDate=function(e){return n.get(o+"?$filter=date eq '"+e+"'").then(function(e){return e.data})},e.getById=function(e){return n.get(o+encodeURIComponent(e)).then(function(e){return e.data})},e.getNextDates=function(){var e=r.getStringFromDate(new Date);return n.get(o+"rpc/getNextDates?today="+e).then(function(e){return e.data})},e.getNextByEmployee=function(e){var t=new Date,t=new Date(t.setDate(t.getDate()-1)),t="?$filter=employeeName eq '"+e+"' and date gt '"+r.getStringFromDate(t)+"'";return n.get(o+t).then(function(e){return e.data})},e.getByEmployeeAndDate=function(e,t){t="?$filter=employeeName eq '"+e+"' and date eq '"+t+"'";return n.get(o+t).then(function(e){return e.data})},e.update=function(e){return n.put(o,e)},e.delete=function(e){return n.delete(o+encodeURIComponent(e))},e}]),angular.module("celebrate-taste").component("reviewList",{templateUrl:"app/review/reviewList.html",controllerAs:"vm",controller:["$location","$window","reviewService","modalService",function(e,t,n,r){var o=this;function i(){n.getAll().then(function(e){o.reviews=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}o.$onInit=function(){o.pageTitle="Feedback clienti",o.reviews=[],o.errors={},i()},o.create=function(){e.path("/admin/reviews/create")},o.delete=function(t){var e={bodyDetails:t.name};r.confirm(e).then(function(e){n.delete(t._id).then(function(){_.remove(o.reviews,{_id:t._id})}).catch(function(e){o.errors=JSON.stringify(e.data,null,4),alert(o.errors)})})},o.filterBySearch=function(e){var t=!1;return o.search&&!new RegExp(o.search,"i").test(e.dishName)&&!new RegExp(o.search,"i").test(e.createdBy)||(t=!0),t},o.refresh=function(){i()},o.goBack=function(){t.history.back()}}]}),app.factory("reviewService",["$http",function(t){var e={},n="/api/reviews/";return e.getByBadge=function(e){e="?$filter=badgeCode eq '"+e+"' and isActive eq true";return t.get(n+e).then(function(e){return e.data})},e.create=function(e){return t.post(n,e)},e.getAll=function(){return t.get(n).then(function(e){return e.data})},e.getById=function(e){return t.get(n+encodeURIComponent(e)).then(function(e){return e.data})},e.update=function(e){return t.put(n,e)},e.delete=function(e){return t.delete(n+encodeURIComponent(e))},e}]),app.controller("todayMenuController",["$scope","menuService","helperService",function(t,e,n){t.todaysMenu={},t.today=n.getFriendlyDate(new Date);var r;r=t.today.ymd,e.getMenu(r).then(function(e){t.todaysMenu=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}]),function(){var c;angular.module("celebrate-taste").component("user",{templateUrl:"app/user/user.html",controllerAs:"vm",controller:["$route","$window","userService","helperValidator","toastr",function(e,t,n,r,o){var i=this;function a(e,t){r.setAllFildsAsValid(t),r.required50(e,t,"user","name"),r.requiredEmail(e,t,"user","email")}i.$onInit=function(){i.user={},i.errors={},i.isFocusOnName=!i.isEditMode,i.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},i.$routerOnActivate=function(e,t){c=e.params.id,i.isEditMode="edit"===e.routeData.data.action,i.isEditMode?(i.pageTitle="Editeaza utilizator",n.getById(c).then(function(e){i.user=e}).catch(function(e){alert(JSON.stringify(e,null,4))})):i.pageTitle="Adauga utilizator"},i.create=function(t){if(a(i,t),t.$invalid)return!1;n.create(i.user).then(function(e){i.goBack()}).catch(function(e){e.data.errors?r.updateValidity(i,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},i.update=function(t){if(a(i,t),t.$invalid)return!1;n.update(i.user).then(function(e){i.goBack()}).catch(function(e){e.data.errors?r.updateValidity(i,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},i.goBack=function(){t.history.back()}}]})}(),angular.module("celebrate-taste").component("userList",{templateUrl:"app/user/userList.html",controllerAs:"vm",controller:["$location","$window","userService","modalService","toastr",function(e,t,n,r,o){var i=this;function a(){n.getAll().then(function(e){e.forEach(function(e){e.activationToken?e.status="asteapta activare":e.status="activ"}),i.users=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}i.$onInit=function(){i.pageTitle="Utilizatori",i.users=[],i.errors={},a()},i.create=function(){e.path("/admin/users/create")},i.delete=function(t){var e={bodyDetails:t.name};r.confirm(e).then(function(e){n.delete(t._id).then(function(){_.remove(i.users,{_id:t._id}),n.getCurrentUser().name===t.name&&n.logout()}).catch(function(e){i.errors=JSON.stringify(e.data,null,4),alert(i.errors)})},function(){})},i.filterBySearch=function(e){var t=!1;return i.search&&!new RegExp(i.search,"i").test(e.name)&&!new RegExp(i.search,"i").test(e.email)||(t=!0),t},i.refresh=function(){a()},i.goBack=function(){t.history.back()}}]}),app.factory("userService",["$http","$cookies","$q","$window",function(o,e,i,t){var n={},r="/api/users/";n.create=function(e){return o.post(r,e)},n.getAll=function(){return o.get(r).then(function(e){return e.data})},n.getById=function(e){return o.get(r+encodeURIComponent(e)).then(function(e){return e.data})},n.update=function(e){return o.put(r,e)},n.delete=function(e){return o.delete(r+encodeURIComponent(e))};var a={};return e.get("user")&&(a=angular.fromJson(e.get("user"))),n.changePassword=function(e,t){return o.put(r+"me/changepassword",{oldPassword:e,newPassword:t})},n.login=function(e,t){var n=t||angular.noop,r=i.defer();return o.post("/login",{email:e.email,password:e.password}).success(function(e){return a=e,r.resolve(e),n()}).error(function(e){return this.logout(),r.reject(e),n(e)}.bind(this)),r.promise},n.logout=function(){t.location.href="/logout"},n.getCurrentUser=function(){return a},n.isLoggedIn=function(){return a.hasOwnProperty("role")},n.isAdmin=function(){return"admin"===a.role},n.isPartnerOrAdmin=function(){return"partner"===a.role||"admin"===a.role},n}]),app.directive("lmCollapse",[function(){return{link:function(e,t,n){e.$watch(n.lmCollapse,function(e){e?(t.css({height:"0"}),t.removeClass("collapsing").addClass("collapse")):t.removeClass("collapsing").addClass("collapse in").css({height:"auto"})})}}}]),app.directive("lmFocus",["$timeout",function(o){return{restrict:"A",link:function(t,n,r){"true"===r.lmFocus||""===r.lmFocus?o(function(){n[0].focus()},0):(t.$watch(r.lmFocus,function(e,t){o(function(){e&&n[0].focus()},0)}),n.bind("blur",function(e){o(function(){t.$apply(r.lmFocus+"=false")},0)}),n.bind("focus",function(e){o(function(){t.$apply(r.lmFocus+"=true")},0)}))}}}]),app.directive("myMatch",function(){return{require:"ngModel",restrict:"A",scope:{match:"="},link:function(e,t,n,r){e.$watch(function(){return r.$pristine&&angular.isUndefined(r.$modelValue)||e.match===r.$modelValue},function(e){r.$setValidity("match",e)})}}}),app.directive("stopEmailValidation",function(){var o=/./;return{require:"ngModel",restrict:"",priority:2,link:function(e,t,n,r){r&&r.$validators.email&&(r.$validators.email=function(e){return r.$isEmpty(e)||o.test(e)})}}}),angular.module("ngLocale",[],["$provide",function(e){var r="one",o="few",i="other";e.value("$locale",{DATETIME_FORMATS:{AMPMS:["a.m.","p.m."],DAY:["duminic","luni","mari","miercuri","joi","vineri","smbt"],ERANAMES:["nainte de Hristos","dup Hristos"],ERAS:[".Hr.","d.Hr."],FIRSTDAYOFWEEK:0,MONTH:["ianuarie","februarie","martie","aprilie","mai","iunie","iulie","august","septembrie","octombrie","noiembrie","decembrie"],SHORTDAY:["Du","Lu","Ma","Mi","Jo","Vi","S"],SHORTMONTH:["ian.","feb.","mar.","apr.","mai","iun.","iul.","aug.","sept.","oct.","nov.","dec."],STANDALONEMONTH:["ianuarie","februarie","martie","aprilie","mai","iunie","iulie","august","septembrie","octombrie","noiembrie","decembrie"],WEEKENDRANGE:[5,6],fullDate:"EEEE, d MMMM y",longDate:"d MMMM y",medium:"d MMM y HH:mm:ss",mediumDate:"d MMM y",mediumTime:"HH:mm:ss",short:"dd.MM.y HH:mm",shortDate:"dd.MM.y",shortTime:"HH:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"RON",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}]},id:"ro-ro",localeID:"ro_RO",pluralCat:function(e,t){var n=0|e,t=function(e,t){var n=t;void 0===n&&(n=Math.min((t=e,-1==(r=(t+="").indexOf("."))?0:t.length-r-1),3));var r=Math.pow(10,n);return{v:n,f:(e*r|0)%r}}(e,t);return 1==n&&0==t.v?r:0!=t.v||0==e||1!=e&&1<=e%100&&e%100<=19?o:i}})}]),app.factory("authInterceptor",["$rootScope","$q","$cookies","$location","$window",function(e,t,n,r,o){return{responseError:function(e){return 401===e.status&&r.path("/admin/login"),t.reject(e)}}}]),app.factory("helperService",[function(){var e={getRoDay:function(e){return 0===e?"Duminica":1===e?"Luni":2===e?"Marti":3===e?"Miercuri":4===e?"Joi":5===e?"Vineri":6===e?"Sambata":void 0},getRoShortDay:function(e){return 0===e?"Du":1===e?"Lu":2===e?"Ma":3===e?"Mi":4===e?"Jo":5===e?"Vi":6===e?"Sa":void 0},getRoMonth:function(e){return 0===e?"Ianuarie":1===e?"Februari":2===e?"Martie":3===e?"Aprilie":4===e?"Mai":5===e?"Iunie":6===e?"Iulie":7===e?"August":8===e?"Septembrie":9===e?"Octombrie":10===e?"Noiembrie":11===e?"Decembrie":void 0},getRoShortMonth:function(e){return 0===e?"Ian.":1===e?"Feb.":2===e?"Mar.":3===e?"Apr.":4===e?"Mai":5===e?"Iun.":6===e?"Iul.":7===e?"Aug.":8===e?"Sep.":9===e?"Oct.":10===e?"Nov.":11===e?"Dec.":void 0},getFriendlyDate:function(e){var t=e.getDate(),n=e.getMonth()+1,r=e.getFullYear(),o=t;o<10&&(o="0"+t);t=n;return t<10&&(t="0"+n),{dayAsString:this.getRoDay(e.getDay()),dayAsShortString:this.getRoShortDay(e.getDay()),dayOfMonth:o,monthAsString:this.getRoMonth(n-1),monthAsShortString:this.getRoShortMonth(n-1),year:r,ymd:r+"-"+t+"-"+o,dmy:o+"."+t+"."+r}},getDateFromString:function(e){var t=e.split("-"),e=t[1];return"0"===e[0]&&(e=e.charAt(1)),--e,new Date(t[0],e,t[2])},getStringFromString:function(e){e=this.getDateFromString(e),e=this.getFriendlyDate(e);return e.dayAsString+", "+e.dayOfMonth+" "+e.monthAsString+" "+e.year},getObjFromString:function(e){e=this.getDateFromString(e),e=this.getFriendlyDate(e);return{dayAsString:e.dayAsString,dayAsShortString:e.dayAsShortString,dayOfMonth:e.dayOfMonth,monthAsString:e.monthAsString,monthAsShortString:e.monthAsShortString,year:e.year,dateAsShortString:e.dayOfMonth+" "+e.monthAsShortString+" "+e.year}},getStringFromDate:function(e){return this.getFriendlyDate(e).ymd},makeId:function(e){for(var t="",n="abcdef0123456789",r=0;r<e;r+=1)t+=n.charAt(Math.floor(Math.random()*n.length));return t}};return e}]),app.service("helperValidator",[function(){function o(e,t,n,r){t[n].$setValidity("myValidation",!1),e.errors[n]=r}function i(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function a(e){return void 0===e||""===e||null===e}this.required=function(e,t,n,r){e[n][r]=e[n][r]||"",a(e[n][r])&&o(e,t,r,"Acest camp este obligatoriu.")},this.required50=function(e,t,n,r){e[n][r]=e[n][r]||"";n=e[n][r];a(n)?o(e,t,r,"Acest camp este obligatoriu."):50<n.length&&o(e,t,r,"Maxim 50 caractere.")},this.requiredEmail=function(e,t,n,r){n=e[n][r];a(n)?o(e,t,r,"Acest camp este obligatoriu."):i(n)?50<n.length&&o(e,t,r,"Maxim 50 caractere."):o(e,t,r,"Adresa de email invalida.")},this.optionalEmail=function(e,t,n,r){n=e[n][r];n&&0<n.length&&!i(n)?o(e,t,r,"Adresa de email invalida."):n&&50<n.length&&o(e,t,r,"Maxim 50 caractere.")},this.optional50=function(e,t,n,r){n=e[n][r];n&&50<n.length&&o(e,t,r,"Maxim 50 caractere.")},this.requiredDate=function(e,t,n,r){n=e[n][r];a(n)?o(e,t,r,"Acest camp este obligatoriu."):n instanceof Date==!1?o(e,t,r,"Data invalida."):50<n.length&&o(e,t,r,"Maxim 50 caractere.")},this.updateValidity=function(n,r,e){angular.forEach(e,function(e,t){o(n,r,e.field,e.msg)})},this.setAllFildsAsValid=function(e){angular.forEach(e,function(n,e){0!==e.indexOf("$")&&angular.forEach(n.$error,function(e,t){n.$setValidity(t,null)})})}}]),app.service("modalService",["$uibModal",function(o){this.show=function(e,t){var n={},r={};return angular.extend(n,e),angular.extend(r,t),n.controller||(n.controller=["$scope","$uibModalInstance",function(e,t){e.modalOptions=r,e.modalOptions.ok=function(e){t.close(e)},e.modalOptions.close=function(e){t.dismiss("cancel")}}]),o.open(n).result},this.confirm=function(e){var t={closeButtonText:"Renunta",actionButtonText:"Sterge",headerText:"Sterge",bodyTitle:"Esti sigur ca vrei sa stergi aceasta inregistrare?",bodyDetails:""};return angular.extend(t,e),this.show({animation:!1,templateUrl:"app/common/templates/confirm.html"},t)},this.showImage=function(e){return this.show({animation:!1,size:"lg",templateUrl:"app/common/templates/showImage.html"},e)}}]),angular.module("celebrate-taste").component("orderLine",{templateUrl:"app/order/orderLine/orderLine.html",controllerAs:"vm",controller:["$route","$window","$location","orderLineService","helperValidator","toastr","$q","preferenceService","customerEmployeeService","helperService",function(e,t,n,r,o,i,a,c,u,s){var l,d,f=this,p={},m=n.search();function g(e,t){var n="orderLine";o.setAllFildsAsValid(t),o.required50(e,t,n,"employeeName"),o.required50(e,t,n,"eatSeries")}function h(e){return s.getObjFromString(e)}function y(){f.orderLine.option1&&(f.orderLine.option1=f.orderLine.option1.toUpperCase()),f.orderLine.option2&&(f.orderLine.option2=f.orderLine.option2.toUpperCase())}f.$onInit=function(){f.orderLine={},f.errors={},f.isFocusOnName=!f.isEditMode,f.obj={},f.customerEmployees=[],f.eatSeriesList=[{name:"Seria 1"},{name:"Seria 2"},{name:"Seria 3"}],l=u.getAll().then(function(e){f.customerEmployees=e}).catch(function(e){alert(JSON.stringify(e,null,4))})},f.$routerOnActivate=function(e,t){f.orderId=e.params.id,f.orderLineId=e.params.id2,f.isEditMode="edit"===e.routeData.data.action,f.isEditMode?(f.pageTitle="Editeaza linia din comanda",d=r.getById(f.orderLineId).then(function(e){(f.orderLine=e).orderDate&&(f.orderDateAsString=h(e.orderDate).dateAsShortString),c.getByEmployeeAndDate(e.employeeName,e.orderDate).then(function(e){1===e.length&&(f.orderLine.option1=e[0].option1,f.orderLine.option2=e[0].option2,p=e[0])})}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))}),a.all([l,d]).then(function(e){f.obj.selectedEmployee=_.find(f.customerEmployees,{name:f.orderLine.employeeName})},function(e){alert("Failed: "+e)})):(f.pageTitle="Adauga o line la comanda",m.orderDate&&(f.orderLine.orderDate=m.orderDate,f.orderLine.orderId=f.orderId,f.orderDateAsString=h(m.orderDate).dateAsShortString))},f.create=function(t){if(g(f,t),t.$invalid)return!1;y(f.orderLine.option1,f.orderLine.option2),p&&p.option1&&f.orderLine.option1&&f.orderLine.option1.toLowerCase()===p.option1.toLowerCase()&&(f.orderLine.fromOwnerOpt1=!0),p&&p.option2&&f.orderLine.option2&&f.orderLine.option2.toLowerCase()===p.option2.toLowerCase()&&(f.orderLine.fromOwnerOpt2=!0),r.create(f.orderLine).then(function(e){n.path("/admin/orders/"+f.orderId)}).catch(function(e){e.data.errors?o.updateValidity(f,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},f.update=function(t){if(g(f,t),t.$invalid)return!1;y(f.orderLine.option1,f.orderLine.option2),p&&p.option1&&f.orderLine.option1&&f.orderLine.option1.toLowerCase()===p.option1.toLowerCase()?f.orderLine.fromOwnerOpt1=!0:delete f.orderLine.fromOwnerOpt1,p&&p.option2&&f.orderLine.option2&&f.orderLine.option2.toLowerCase()===p.option2.toLowerCase()?f.orderLine.fromOwnerOpt2=!0:delete f.orderLine.fromOwnerOpt2,r.update(f.orderLine).then(function(e){n.path("/admin/orders/"+f.orderId)}).catch(function(e){e.data.errors?o.updateValidity(f,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},f.selectEmployee=function(e,t){f.orderLine.employeeName=f.obj.selectedEmployee.name,c.getByEmployeeAndDate(f.orderLine.employeeName,f.orderLine.orderDate).then(function(e){1===e.length?(f.orderLine.option1=e[0].option1,f.orderLine.option2=e[0].option2,p=e[0]):(f.orderLine.option1=void 0,f.orderLine.option2=void 0)}).catch(function(e){alert(JSON.stringify(e,null,4))})},f.goBack=function(){t.history.back()}}]}),angular.module("celebrate-taste").component("orderLineImport",{templateUrl:"app/order/orderLine/orderLineImport.html",controllerAs:"vm",controller:["$route","$window","$location","orderLineService","helperValidator","toastr","helperService",function(e,t,o,i,a,n,r){var c=this,u=o.search();c.$onInit=function(){c.user={},c.errors={},c.importData={},c.eatSeriesList=[{name:"Seria 1"},{name:"Seria 2"},{name:"Seria 3"}],c.pageTitle="Importa comanda"},c.$routerOnActivate=function(e,t){c.orderId=e.params.id,u.orderDate&&(c.importData.orderDate=u.orderDate,c.importData.orderId=c.orderId,c.orderDateAsString=(e=u.orderDate,r.getObjFromString(e).dateAsShortString))},c.create=function(t){var e,n,r;if(e=c,n=t,r="importData",a.setAllFildsAsValid(n),a.required(e,n,r,"employeesName"),a.required50(e,n,r,"eatSeries"),t.$invalid)return!1;i.import(c.importData).then(function(e){o.path("/admin/orders/"+c.orderId)}).catch(function(e){e.data.errors?a.updateValidity(c,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},c.goBack=function(){t.history.back()}}]}),angular.module("celebrate-taste").component("orderLineList",{bindings:{orderId:"<",orderDate:"<"},templateUrl:"app/order/orderLine/orderLineList.html",controllerAs:"vm",controller:["$location","$window","orderLineService","modalService","toastr",function(t,e,n,r,o){var i=this;function a(){n.getAllWithBadgeInfo(i.orderId).then(function(e){i.orderLines=e,i.eatSeriesList=_.chain(i.orderLines).map("eatSeries").uniq().sortBy().value();e=t.search();e.eatSeries?i.selectedEatSeries=e.eatSeries:i.selectedEatSeries="Toate seriile",e.preference?i.selectedPreference=e.preference:i.selectedPreference="Toate pref.",e.onlyNoBadges?i.obj.onlyNoBadges=!0:i.obj.onlyNoBadges=!1}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}i.$onInit=function(){i.pageTitle="Utilizatori",i.orderLines=[],i.errors={},i.preferences=["A","B","C","D"],i.obj={},i.obj.onlyNoBadges=!1,a()},i.create=function(){t.path("/admin/orders/"+i.orderId+"/orderLines/create"),t.search("orderDate",i.orderDate)},i.import=function(){t.path("/admin/orders/"+i.orderId+"/orderLines/import"),t.search("orderDate",i.orderDate)},i.delete=function(t){var e={bodyDetails:"Comanda pentru "+t.employeeName};r.confirm(e).then(function(e){n.delete(t._id).then(function(){_.remove(i.orderLines,{_id:t._id})}).catch(function(e){i.errors=JSON.stringify(e.data,null,4),alert(i.errors)})},function(){})},i.filterBySearch=function(e){var t=!1;return i.search&&!new RegExp(i.search,"i").test(e.name)&&!new RegExp(i.search,"i").test(e.email)||(t=!0),t},i.refresh=function(){a()},i.goBack=function(){e.history.back()},i.preferencesFilter=function(e){return"Toate pref."===i.selectedPreference||("A"===i.selectedPreference||"B"===i.selectedPreference?e.option1===i.selectedPreference:"C"===i.selectedPreference||"D"===i.selectedPreference?e.option2===i.selectedPreference:"Fara pref."===i.selectedPreference?!(e.option1&&e.option2):void 0)},i.eatSeriesFilter=function(e){return"Toate seriile"===i.selectedEatSeries||e.eatSeries===i.selectedEatSeries},i.badgesFilter=function(e){return!i.obj.onlyNoBadges||!e.badgeCode},i.selectOnlyNoBadges=function(){!1===i.obj.onlyNoBadges?(i.obj.onlyNoBadges=!0,t.search("onlyNoBadges",null)):(i.obj.onlyNoBadges=!1,t.search("onlyNoBadges",!0))},i.selectEatSeries=function(e){"Toate seriile"===e?(i.selectedEatSeries="Toate seriile",t.search("eatSeries",null)):(i.selectedEatSeries=e,t.search("eatSeries",e))},i.selectPreference=function(e){"Toate pref."===e?(i.selectedPreference="Toate pref.",t.search("preference",null)):(i.selectedPreference=e,t.search("preference",e))}}]}),app.factory("orderLineService",["$http",function(r){var e={},o="/api/orderLines/";return e.getAll=function(e){e="?$filter=orderId eq '"+e+"'";return r.get(o+"/getAllWithBadgeInfo"+e).then(function(e){return e.data})},e.getAllWithBadgeInfo=function(e){e="?$filter=orderId eq '"+e+"'";return r.get(o+"/getAllWithBadgeInfo"+e).then(function(e){return e.data})},e.getEatSeriesDetails=function(e,t){t="?$filter=orderId eq '"+e+"' and eatSeries eq '"+t+"'";return r.get(o+t).then(function(e){return e.data})},e.getOrderLinesByBadge=function(e,t){t="?$filter=orderId eq '"+e+"' and badgeCode eq '"+encodeURIComponent(t)+"'";return r.get(o+t).then(function(e){return e.data})},e.getOrderLinesByEmployeeName=function(e,t){t="?$filter=orderId eq '"+e+"' and employeeName eq '"+encodeURIComponent(t)+"'";return r.get(o+t).then(function(e){return e.data})},e.getOrderLinesBySeriesAndStatus=function(e,t,n){n="?$filter=orderId eq '"+e+"' and eatSeries eq '"+t+"' and status eq '"+n+"'";return r.get(o+"/getAllWithBadgeInfo"+n).then(function(e){return e.data})},e.create=function(e){return r.post(o,e)},e.getById=function(e){return r.get(o+e).then(function(e){return e.data})},e.update=function(e){return r.put(o,e)},e.delete=function(e){return r.delete(o+e)},e.import=function(e){return r.post(o+"rpc/import",e)},e}]);