"use strict";var app=angular.module("celebrate-taste",["ngCookies","ngSanitize","ngComponentRouter","ui.bootstrap","ui.select","ngAnimate","toastr","ngFileUpload"]);app.value("$routerRootComponent","mainApp"),app.config(["$locationProvider","$httpProvider",function(e,t){e.html5Mode(!0),t.interceptors.push("authInterceptor")}]),app.config(["toastrConfig",function(e){angular.extend(e,{positionClass:"toast-top-center"})}]),app.run(["$rootScope","$location","userService","$window",function(r,i,o,a){r.$on("$routeChangeStart",function(e,t,n){t.authenticate&&!o.isLoggedIn&&(e.preventDefault(),i.path("/login"))}),r.$on("$routeChangeSuccess",function(e,t,n){t.hasOwnProperty("$$route")&&(r.pageTitle=t.$$route.title),a.ga&&a.ga("send","pageview",{page:i.path(),title:r.pageTitle})}),r.goBack=function(){a.history.back()}}]),angular.module("celebrate-taste").component("mainApp",{template:"\n            <lm-navbar></lm-navbar>\n            <ng-outlet></ng-outlet>\n        ",$routeConfig:[{path:"/admin",component:"home",name:"Home"},{path:"/admin/customerEmployees",component:"customerEmployeeList",name:"CustomerEmployeeList"},{path:"/admin/customerEmployees/create",component:"customerEmployee",name:"CustomerEmployeeCreate"},{path:"/admin/customerEmployees/:id",component:"customerEmployee",name:"CustomerEmployeeEdit",data:{action:"edit"}},{path:"/admin/users",component:"userList",name:"UserList"},{path:"/admin/users/create",component:"user",name:"UserCreate"},{path:"/admin/users/:id",component:"user",name:"UserEdit",data:{action:"edit"}},{path:"/admin/dishes",component:"dishList",name:"DishList"},{path:"/admin/dishes/create",component:"dish",name:"DishCreate"},{path:"/admin/dishes/:id",component:"dish",name:"DishEdit",data:{action:"edit"}},{path:"/admin/menus",component:"menuList",name:"MenuList"},{path:"/admin/menus/:menuId/dishes/:dishId",component:"editDishForMenu",name:"EditDishForMenu"},{path:"/admin/menus/:id/add",component:"addDishToMenu",name:"AddDishToMenu"},{path:"/admin/preferences",component:"preferenceList",name:"PreferenceList"},{path:"/admin/preferences/create",component:"addPreferences",name:"PreferenceCreate"},{path:"/admin/preferences/:id",component:"preference",name:"PreferenceEdit"},{path:"/admin/orders",component:"orderList",name:"OrderList"},{path:"/admin/orders/:id",component:"order",name:"OrderEdit"},{path:"/admin/orders/:id/orderLines/create",component:"orderLine",name:"OrderLineCreate"},{path:"/admin/orders/:id/orderLines/:id2",component:"orderLine",name:"OrderLineEdit",data:{action:"edit"}},{path:"/admin/orders/:id/orderLines/import",component:"orderLineImport",name:"OrderLineImport"},{path:"/admin/deliveries",component:"deliveryList",name:"PreferenceList"},{path:"/admin/deliveries/:id",component:"delivery",name:"DeliveryEdit"},{path:"/admin/deliveryLogs",component:"deliveryLogList",name:"DeliveryLogList"},{path:"/admin/partnerOrders",component:"partnerOrderList",name:"PartnerOrderList"},{path:"/admin/reviews",component:"reviewList",name:"ReviewList"},{path:"/admin/assignedNames",component:"assignedNameList",name:"AssignedNameList"},{path:"/admin/assignedNames/create",component:"assignedName",name:"AssignedNameCreate"},{path:"/admin/assignedNames/:id",component:"assignedName",name:"AssignedNameEdit",data:{action:"edit"}},{path:"/admin/badges",component:"badgeList",name:"BadgeList"}]}),function(){var a;angular.module("celebrate-taste").component("assignedName",{templateUrl:"app/assignedName/assignedName.html",controllerAs:"vm",controller:["$route","$window","assignedNameService","helperValidator",function(e,t,n,r){var i=this;function o(e,t){var n="assignedName";r.setAllFildsAsValid(t),r.required50(e,t,n,"badgeOwnerCode"),r.required50(e,t,n,"employeeId")}i.$onInit=function(){i.assignedName={},i.errors={},i.isFocusOnName=!i.isEditMode,i.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}],i.badges=[{code:"0009877",ownerCode:"AMolnar AAaaa"},{code:"000987",ownerCode:"Molnar Aaaa"}],i.employees=[{_id:"112233445",name:"BMolnar Aaaa123"},{_id:"11223344",name:"Molnar Aaaa123"}]},i.$routerOnActivate=function(e,t){a=e.params.id,i.isEditMode="edit"===e.routeData.data.action,i.isEditMode?(i.pageTitle="Editeaza asociere",n.getById(a).then(function(e){i.assignedName=e}).catch(function(e){alert(JSON.stringify(e,null,4))})):i.pageTitle="Adauga asociere"},i.create=function(t){if(o(i,t),t.$invalid)return!1;var e=_.find(i.employees,{_id:i.assignedName.employeeId});i.assignedName.employeeName=e.name,n.create(i.assignedName).then(function(e){i.goBack()}).catch(function(e){e.data.errors?r.updateValidity(i,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},i.update=function(t){if(i.assignedName.askForNotification&&!i.assignedName.email)return alert("Ai ales sa notifici clientul dar lipseste adresa de email!"),!1;if(o(i,t),t.$invalid)return!1;var e=_.find(i.employees,{_id:i.assignedName.employeeId});i.assignedName.employeeName=e.name,n.update(i.assignedName).then(function(e){i.goBack()}).catch(function(e){e.data.errors?r.updateValidity(i,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},i.goBack=function(){t.history.back()}}]})}(),angular.module("celebrate-taste").component("badgeList",{templateUrl:"app/badge/badgeList.html",controllerAs:"vm",controller:["$location","$window","badgeService","Upload","modalService","toastr",function(e,t,n,r,i,o){var a=this;function c(){n.getAll().then(function(e){a.badges=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}a.$onInit=function(){a.pageTitle="Carduri",a.badges=[],a.errors={},c()},a.screenSize=window.getComputedStyle(document.body,":after").getPropertyValue("content").replace(/"/g,""),a.upload=function(e){if(e){if(a.errors.fileErrorMsg=(t=5,e.size>1024*t*1024?"Sunt acceptate doar fisiere cu dimensiunea de maximum "+t+" MB.":""),a.errors.fileErrorMsg)return!1;a.inProgress=!0,r.upload({url:"api/badges/upload",data:{file:e}}).then(function(e){a.errors.fileErrorMsg="",a.inProgress=!1,a.refresh(),o.success(e.data.importedBadges+" carduri au fost importate cu succes.")},function(e){a.errors.fileErrorMsg=e.data.msg,a.inProgress=!1},function(e){a.progressPercentage=Math.min(100,parseInt(100*e.loaded/e.total))})}var t},a.filterBySearch=function(e){var t=!1;return a.search?(new RegExp(a.search,"i").test(e.code)||new RegExp(a.search,"i").test(e.ownerCode))&&(t=!0):t=!0,t},a.refresh=function(){c()},a.goBack=function(){t.history.back()}}]}),app.factory("badgeService",["$http",function(n){var e={},r="/api/badges/";return e.create=function(e){return n.post(r,e)},e.getAll=function(){return n.get(r).then(function(e){return e.data})},e.getById=function(e){return n.get(r+encodeURIComponent(e)).then(function(e){return e.data})},e.update=function(e){return n.put(r,e)},e.delete=function(e){return n.delete(r+encodeURIComponent(e))},e.getByCode=function(e){var t="?$filter=code eq '"+encodeURIComponent(e)+"'";return n.get(r+t).then(function(e){return e.data})},e}]),function(){var a;angular.module("celebrate-taste").component("customerEmployee",{templateUrl:"app/customerEmployee/customerEmployee.html",controllerAs:"vm",controller:["$route","$window","customerEmployeeService","helperValidator",function(e,t,n,r){var i=this;function o(e,t){var n="customerEmployee";r.setAllFildsAsValid(t),r.required50(e,t,n,"name"),r.optionalEmail(e,t,n,"email")}i.$onInit=function(){i.customerEmployee={},i.errors={},i.isFocusOnName=!i.isEditMode,i.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},i.$routerOnActivate=function(e,t){a=e.params.id,i.isEditMode="edit"===e.routeData.data.action,i.isEditMode?(i.pageTitle="Editeaza angajat",n.getById(a).then(function(e){i.customerEmployee=e}).catch(function(e){alert(JSON.stringify(e,null,4))})):i.pageTitle="Adauga angajat"},i.create=function(t){if(o(i,t),t.$invalid)return!1;n.create(i.customerEmployee).then(function(e){i.goBack()}).catch(function(e){e.data.errors?r.updateValidity(i,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},i.update=function(t){return i.customerEmployee.askForNotification&&!i.customerEmployee.email?(alert("Ai ales sa notifici clientul dar lipseste adresa de email!"),!1):(o(i,t),!t.$invalid&&void n.update(i.customerEmployee).then(function(e){i.goBack()}).catch(function(e){e.data.errors?r.updateValidity(i,t,e.data.errors):alert(JSON.stringify(e.data,null,4))}))},i.goBack=function(){t.history.back()}}]})}(),angular.module("celebrate-taste").component("customerEmployeeList",{templateUrl:"app/customerEmployee/customerEmployeeList.html",controllerAs:"vm",controller:["$location","$window","customerEmployeeService","modalService",function(e,t,n,r){var i=this;function o(){n.getAllWithBadgeInfo().then(function(e){i.customerEmployees=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}i.$onInit=function(){i.pageTitle="Angajati client",i.customerEmployees=[],i.errors={},o()},i.create=function(){e.path("/admin/customerEmployees/create")},i.delete=function(t){var e={bodyDetails:t.name};r.confirm(e).then(function(e){n.delete(t._id).then(function(){_.remove(i.customerEmployees,{_id:t._id})}).catch(function(e){i.errors=JSON.stringify(e.data,null,4),alert(i.errors)})},function(){})},i.filterBySearch=function(e){var t=!1;return i.search?(new RegExp(i.search,"i").test(e.name)||new RegExp(i.search,"i").test(e.badgeCode)||new RegExp(i.search,"i").test(e.adjustedName))&&(t=!0):t=!0,t},i.refresh=function(){o()},i.goBack=function(){t.history.back()}}]}),app.factory("customerEmployeeService",["$http",function(n){var e={},r="/api/customerEmployees/";return e.getByBadge=function(e){var t="?$filter=badgeCode eq '"+e+"' and isActive eq true";return n.get(r+t).then(function(e){return e.data})},e.create=function(e){return n.post(r,e)},e.getAll=function(){return n.get(r).then(function(e){return e.data})},e.getAllWithBadgeInfo=function(){return n.get(r+"/getAllWithBadgeInfo").then(function(e){return e.data})},e.getById=function(e){return n.get(r+encodeURIComponent(e)).then(function(e){return e.data})},e.update=function(e){return n.put(r,e)},e.delete=function(e){return n.delete(r+encodeURIComponent(e))},e}]),app.controller("createDeliveryTplController",["$scope","$uibModalInstance","helperService","deliveryService","helperValidator","$q","orderService","orderLineService","dataToModal",function(n,t,e,r,i,o,a,c,u){function s(){n.existNewSeries=!1,a.getEatSeriesList(n.selectedOrder._id).then(function(e){0===e.length?n.noSeries=!0:n.noSeries=!1,n.eatSeriesList=_.map(e,function(e){var t=!!_.some(u,{orderId:n.selectedOrder._id,eatSeries:e});return t||(n.existNewSeries=!0),{name:e,selected:!t,disabled:t}})})}n.errors={},n.noOrders=!1,n.noSeries=!1,n.eatSeriesList=[],n.delivery={},a.getAllOpen().then(function(e){n.orders=e,0<n.orders.length?(n.selectedOrder=e[0],s()):n.noOrders=!0}).catch(function(e){alert(JSON.stringify(e,null,4))}),n.selectOrder=function(){s()},n.create=function(e){n.selectedOrder&&(n.delivery.orderId=n.selectedOrder._id,n.delivery.orderDate=n.selectedOrder.date),n.delivery.eatSeriesList=_.chain(n.eatSeriesList).filter({selected:!0}).map("name").sortBy().value(),r.createMany(n.delivery).then(function(e){t.close()}).catch(function(e){})},n.cancel=function(){t.dismiss("cancel")}}]),function(){var b;angular.module("celebrate-taste").component("delivery",{templateUrl:"app/delivery/delivery.html",controllerAs:"vm",controller:["$route","$window","deliveryService","helperValidator","helperService","orderLineService","$uibModal","menuService","toastr","customerEmployeeService","orderService","deliveryLogService","badgeService","$timeout",function(e,t,n,r,i,o,a,c,u,s,l,d,f,p){var m=this;function g(){n.getById(b).then(function(e){var t,n;m.delivery=e,m.dateAsShortString=(t=m.delivery.orderDate,i.getObjFromString(t)).dateAsShortString,n=m.delivery.orderDate,c.getMenu(n).then(function(e){m.menu=e[0]}).catch(function(e){alert(JSON.stringify(e,null,4))}),h(e.orderId,e.eatSeries)}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function h(e,t){l.getDeliverySummary(e,t).then(function(e){m.deliverySummary=e}).catch(function(e){alert(JSON.stringify(e,null,4))})}function v(){o.getOrderLinesBySeriesAndStatus(m.delivery.orderId,m.delivery.eatSeries,"open").then(function(e){m.orderLinesOpen=e}).catch(function(e){alert(JSON.stringify(e,null,4))})}function y(){o.getOrderLinesBySeriesAndStatus(m.delivery.orderId,m.delivery.eatSeries,"completed").then(function(e){m.orderLinesCompleted=_.orderBy(e,"deliveryDate","desc")}).catch(function(e){alert(JSON.stringify(e,null,4))})}function S(e){m.menu&&(m.option1=_.find(m.menu.dishes,{option:e.option1}),m.option2=_.find(m.menu.dishes,{option:e.option2}))}function O(e,t){return Array(Math.max(t-String(e).length+1,0)).join("0")+e}function A(e){if(e)return e.toLowerCase().replace(/-/g," ").replace(/ {2,}/g," ")}function $(e){m.errorValidation=!0,m.errorMessage=e;var t={orderDate:m.delivery.orderDate,series:m.delivery.eatSeries,msg:e};d.create(t).then(function(){u.success("Datele despre acest card au fost memorate pt. investigatii ulterioare.")}).catch(function(e){alert(JSON.stringify(e.data,null,4))})}m.$onInit=function(){m.delivery={},m.errors={},m.selectedPreference="Toate pref.",m.deliverySummary={},m.obj={},m.obj.isFocusOnBadge=!0,m.preferences=["A","B","C","D"],f.getAll().then(function(e){m.badges=e}).catch(function(e){alert(JSON.stringify(e,null,4))}),s.getAll().then(function(e){m.customerEmployees=e}).catch(function(e){alert(JSON.stringify(e,null,4))})},m.$routerOnActivate=function(e,t){b=e.params.id,m.isEditMode="edit"===e.routeData.data.action,g()},m.openDeliveryLine=function(e,t){var n="app/delivery/openToCompleteTpl.html";"completed"===e.status&&(n="app/delivery/openToRevokeTpl.html"),S(e);var r=a.open({animation:!1,templateUrl:n,controller:"openDeliveryLineTplController",resolve:{dataToModal:function(){return{orderLine:e,option1:m.option1,option2:m.option2}}}});r.result.then(function(){"open"===t?m.refreshOpen():m.refreshCompleted()},function(){})},m.goBack=function(){t.history.back()},m.refreshOpen=function(){v()},m.selectTabOpen=function(){v()},m.refreshCompleted=function(){y()},m.selectTabCompleted=function(e){y()},m.selectTab1=function(){m.obj.isFocusOnBadge=!0,m.errorValidation=!1,m.orderLine=void 0,h(m.delivery.orderId,m.delivery.eatSeries)},m.deliverByBadge=function(e){if(m.errorValidation=!1,m.orderLine=void 0,m.obj.badgeCode=m.obj.badgeCode.trim(),10!==m.obj.badgeCode.length||isNaN(m.obj.badgeCode))return $("'"+m.obj.badgeCode+"' este un cod invalid! (nu are 10 cifre)"),m.obj.badgeCode="",void(m.obj.isFocusOnBadge=!0);var t=function(e){var t=parseInt(e,10).toString(16),n=t.substr(0,t.length-4),r=t.substr(t.length-4);2<n.length&&(n=n.substr(n.length-2));var i=parseInt(n,16),o=parseInt(r,16),a=O(i,5),c=O(o,5);return a+c}(m.obj.badgeCode),n=_.find(m.badges,{code:t});if(n){var r=n.ownerCode,i=_.find(m.customerEmployees,function(e){return A(e.adjustedName)===A(n.ownerCode)});i&&(r=i.name),o.getOrderLinesByEmployeeName(m.delivery.orderId,r).then(function(e){if(0===e.length)$("Lipsa comanda pt. '"+r+"'.");else if(1<e.length)$("Exista mai multe comenzi pentru aceeasi persoana: '"+r+"'.");else if(e[0].eatSeries!==m.delivery.eatSeries)"completed"===e[0].status?$("'"+r+"' a mancat in "+e[0].eatSeries+"."):$("'"+r+"' a fost programat in "+e[0].eatSeries+".");else{if(m.orderLine=e[0],"completed"!==m.orderLine.status){var t={};angular.copy(m.orderLine,t),t.status="completed",t.deliveryDate=new Date,t.deliveryMode="card",o.update(t).then(function(e){m.deliverySummary=e.data,u.success("Livrarea a fost inregistrata!")}).catch(function(e){alert(JSON.stringify(e.data,null,4))})}S(m.orderLine)}m.obj.badgeCode="",m.obj.isFocusOnBadge=!0}).catch(function(e){alert(JSON.stringify(e,null,4))})}else $("Card negasit: "+t),m.obj.badgeCode="",m.obj.isFocusOnBadge=!0},m.revoke=function(e){e.status="open",delete e.deliveryDate,o.update(e).then(function(e){u.success("Livrarea a fost anulata!"),m.orderLine=void 0,m.obj.isFocusOnBadge=!0,m.deliverySummary=e.data}).catch(function(e){alert(JSON.stringify(e.data,null,4))})},m.badgesFilter=function(e){return!m.obj.onlyNoBadges||!e.badgeCode},m.selectPreference=function(e){m.selectedPreference="Toate pref."===e?"Toate pref.":e},m.preferencesFilter=function(e){return"Toate pref."===m.selectedPreference||("A"===m.selectedPreference||"B"===m.selectedPreference?e.option1===m.selectedPreference:"C"===m.selectedPreference||"D"===m.selectedPreference?e.option2===m.selectedPreference:"Fara pref."===m.selectedPreference?!(e.option1&&e.option2):void 0)}}]})}(),angular.module("celebrate-taste").component("deliveryList",{templateUrl:"app/delivery/deliveryList.html",controllerAs:"vm",controller:["$location","$window","deliveryService","modalService","toastr","helperService","$uibModal",function(e,t,n,r,i,o,a){var c=this;function u(){n.getAll().then(function(e){c.deliveries=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}c.$onInit=function(){c.pageTitle="Livrari",c.deliveries=[],c.errors={},u()},c.openCreateDelivery=function(){var e=a.open({animation:!1,templateUrl:"app/delivery/createDeliveryTpl.html",controller:"createDeliveryTplController",resolve:{dataToModal:function(){return c.deliveries}}});e.result.then(function(){c.refresh()},function(){})},c.refresh=function(){u()},c.goBack=function(){t.history.back()},c.dt=function(e){return o.getObjFromString(e)}}]}),app.factory("deliveryService",["$http",function(n){var e={},r="/api/deliveries/";return e.create=function(e){return n.post(r,e)},e.createMany=function(e){return n.post(r+"rpc/createMany",e)},e.getAll=function(){return n.get(r).then(function(e){return e.data})},e.getById=function(e){return n.get(r+encodeURIComponent(e)).then(function(e){return e.data})},e.update=function(e){return n.put(r,e)},e.delete=function(e){return n.delete(r+encodeURIComponent(e))},e.count=function(e,t){return n.get(r+"$count?$filter="+e+" eq '"+t+"'").then(function(e){return e.data})},e}]),app.controller("openDeliveryLineTplController",["$scope","$uibModalInstance","helperService","deliveryService","helperValidator","$q","orderService","orderLineService","dataToModal",function(t,n,e,r,i,o,a,c,u){t.errors={},t.orderLine=u.orderLine,t.option1=u.option1,t.option2=u.option2,t.cancel=function(){n.dismiss("cancel")},t.update=function(e){t.orderLine.status="completed",t.orderLine.deliveryMode="manual",t.orderLine.deliveryDate=new Date,c.update(t.orderLine).then(function(e){n.close()}).catch(function(e){alert(JSON.stringify(e.data,null,4))})},t.revoke=function(){t.orderLine.status="open",delete t.orderLine.deliveryDate,c.update(t.orderLine).then(function(e){n.close()}).catch(function(e){alert(JSON.stringify(e.data,null,4))})}}]),function(){var s;angular.module("celebrate-taste").component("dish",{templateUrl:"app/dish/dish.html",controllerAs:"vm",controller:["$route","$window","dishService","helperValidator","toastr","Upload","modalService",function(e,t,n,r,i,o,a){var c=this;function u(e,t){r.setAllFildsAsValid(t),r.required50(e,t,"dish","name"),r.required50(e,t,"dish","category")}c.$onInit=function(){c.dish={},c.errors={},c.isFocusOnName=!c.isEditMode,c.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},c.$routerOnActivate=function(e,t){s=e.params.id,c.isEditMode="edit"===e.routeData.data.action,c.isEditMode?(c.pageTitle="Editeaza felul de mancare",n.getById(s).then(function(e){c.dish=e}).catch(function(e){alert(JSON.stringify(e,null,4))})):c.pageTitle="Adauga un fel de mancare"},c.create=function(t){if(u(c,t),t.$invalid)return!1;n.create(c.dish).then(function(e){c.goBack()}).catch(function(e){e.data.errors?r.updateValidity(c,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},c.update=function(t){if(u(c,t),t.$invalid)return!1;n.update(c.dish).then(function(e){c.goBack()}).catch(function(e){e.data.errors?r.updateValidity(c,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},c.goBack=function(){t.history.back()},c.screenSize=window.getComputedStyle(document.body,":after").getPropertyValue("content").replace(/"/g,""),c.upload=function(e){if(e){if(c.errors.fileErrorMsg=function(e,t,n,r){if(e.size>1024*t*1024)return"Sunt acceptate doar poze cu dimensiunea de maximum "+t+" MB.";if("image/jpeg"!==e.type)return"Sunt acceptate doar poze in format '.jpg'.";if(e.$ngfWidth<e.$ngfHeight)return"Sunt acceptate doar poze in format 'landscape' (latime > inaltime).";if(e.$ngfWidth<n)return"Sunt acceptate doar poze cu latimea de minimum "+n+" px.";if(e.$ngfHeight<r)return"Sunt acceptate doar poze cu inaltimea de minimum "+r+" px.";return""}(e,10,960,640),c.errors.fileErrorMsg)return!1;c.inProgress=!0,o.upload({url:"api/dishes/upload",data:{file:e}}).then(function(e){c.dish.image=e.data,c.errors.fileErrorMsg="",c.inProgress=!1},function(e){c.errors.fileErrorMsg=e.data.msg,c.inProgress=!1},function(e){c.progressPercentage=Math.min(100,parseInt(100*e.loaded/e.total))})}},c.removeImage=function(){delete c.dish.image,c.errors.fileErrorMsg=""},c.showModal=function(e){var t={imageUrl:e.image.large};a.showImage(t).then(function(e){})}}]})}(),angular.module("celebrate-taste").component("dishList",{templateUrl:"app/dish/dishList.html",controllerAs:"vm",controller:["$location","$window","dishService","modalService","toastr",function(e,t,n,r,i){var o=this;function a(){n.getAll().then(function(e){o.dishes=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}o.$onInit=function(){o.pageTitle="Feluri de mancare",o.dishes=[],o.errors={},a()},o.create=function(){e.path("/admin/dishes/create")},o.delete=function(t){var e={bodyDetails:t.name};r.confirm(e).then(function(e){n.delete(t._id).then(function(){_.remove(o.dishes,{_id:t._id})}).catch(function(e){o.errors=JSON.stringify(e.data,null,4),alert(o.errors)})},function(){})},o.refresh=function(){a()},o.goBack=function(){t.history.back()},o.showModal=function(e){var t={imageUrl:e.image.large};r.showImage(t).then(function(e){})}}]}),app.factory("dishService",["$http",function(t){var e={},n="/api/dishes/";return e.create=function(e){return t.post(n,e)},e.getAll=function(){return t.get(n).then(function(e){return e.data})},e.getById=function(e){return t.get(n+encodeURIComponent(e)).then(function(e){return e.data})},e.update=function(e){return t.put(n,e)},e.delete=function(e){return t.delete(n+encodeURIComponent(e))},e}]),angular.module("celebrate-taste").component("deliveryLogList",{templateUrl:"app/deliveryLog/deliveryLogList.html",controllerAs:"vm",controller:["$location","$window","deliveryLogService","modalService","toastr","helperService",function(e,t,n,r,i,o){var a=this;function c(){n.getAll().then(function(e){a.deliveryLogs=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}a.$onInit=function(){a.pageTitle="Notificari",a.deliveryLogs=[],a.errors={},c()},a.refresh=function(){c()},a.goBack=function(){t.history.back()},a.dt=function(e){return o.getObjFromString(e)}}]}),app.factory("deliveryLogService",["$http",function(t){var e={},n="/api/deliveryLogs/";return e.getAll=function(){return t.get(n).then(function(e){return e.data})},e.create=function(e){return t.post(n,e)},e}]),angular.module("celebrate-taste").component("home",{template:'\n            <div class="container">    \n                </br>\n                </br>\n                <p ng-if-start="vm.isAdmin()"><a ng-href="/admin/users">Utilizatori</a></p>\n                <p><a ng-href="/admin/customerEmployees">Angajati client</a></p>\n                <p><a ng-href="/admin/badges">Carduri</a></p>                \n                <p><a ng-href="/admin/dishes">Feluri de mancare</a></p>\n                <p><a ng-href="/admin/menus">Meniuri</a></p>\n                <p><a ng-href="/admin/preferences">Preferinte</a></p>\n                <p><a ng-href="/admin/orders">Comenzi</a></p>\n                <p><a ng-href="/admin/deliveries">Livrari</a></p>                                            \n                <p ng-if-end><a ng-href="/admin/reviews">Feedback clienti</a></p>\n                \n                <p><a ng-href="/admin/deliveryLogs">Notificari</a></p>\n                <p><a ng-href="/admin/partnerOrders">Raport comenzi</a></p>\n            </div>        \n        ',controllerAs:"vm",controller:["userService",function(e){var t=this;t.$onInit=function(){t.isAdmin=e.isAdmin}}]}),function(){var l;angular.module("celebrate-taste").component("addDishToMenu",{templateUrl:"app/menu/addDishToMenu.html",controllerAs:"vm",controller:["$window","menuService","dishService","helperValidator","helperService","toastr","modalService",function(e,n,t,r,i,o,a){var c=this;function u(){n.getById(l).then(function(e){c.menu=e,c.roMenuDate=i.getStringFromString(e.menuDate)}).catch(function(e){alert(JSON.stringify(e,null,4))})}function s(){t.getAll().then(function(e){c.dishes=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}c.$onInit=function(){c.pageTitle="Editeaza produsul din meniu",c.menu={},c.categories=[{value:0,name:"Toate felurile"},{value:1,name:"Supa"},{value:2,name:"Felul 2"},{value:3,name:"Salata"},{value:4,name:"Desert"}],c.selectedCategory=c.categories[0],c.isFastingSelected=!1,c.selectCategory=function(e){c.selectedCategory=e},c.dishes=[],c.status={isopen:!1}},c.$routerOnActivate=function(e,t){l=e.params.id,s(),u()},c.addToMenu=function(t){var e={};angular.copy(t,e),"1"!==t.category&&"2"!==t.category||(e.option=function(e,t){{if(void 0===e||0===e.length)return"A";var n=e[e.length-1];return String.fromCharCode(n.option.charCodeAt(0)+1)}}(c.menu.dishes)),void 0===c.menu.dishes&&(c.menu.dishes=[]),c.menu.dishes.push(e),n.update(c.menu).then(function(e){t.isAddedTmp=!0,u()}).catch(function(e){alert(JSON.stringify(e.data,null,4))})},c.removeFromMenu=function(t){_.remove(c.menu.dishes,function(e){return e._id===t._id}),n.update(c.menu).then(function(e){delete t.isAddedTmp}).catch(function(e){alert(JSON.stringify(e.data,null,4))})},c.goBack=function(){e.history.back()},c.refresh=function(){s(),u()},c.showModal=function(e){var t={imageUrl:e.image.large};a.showImage(t).then(function(e){})}}]})}(),app.controller("createMenuTplController",["$scope","$uibModalInstance","dataToModal","helperService",function(e,t,n,r){e.menuDate=r.getDateFromString(n),e.menuDate.setDate(e.menuDate.getDate()+1),e.ok=function(){t.close(e.menuDate)},e.cancel=function(){t.dismiss("cancel")},e.dateOptions={startingDay:1},e.isOpen=!1,e.open=function(){e.isOpen=!0}}]),function(){var u,s;angular.module("celebrate-taste").component("editDishForMenu",{templateUrl:"app/menu/editDishForMenu.html",controllerAs:"vm",controller:["$route","$window","menuService","helperValidator","helperService","toastr",function(e,t,r,i,n,o){var a=this;function c(){r.getById(u).then(function(e){var t;a.menu=e,a.menuDateAsString=(t=a.menu.menuDate,n.getObjFromString(t)).dateAsShortString,a.dish=_.find(e.dishes,{_id:s})}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}a.$onInit=function(){a.pageTitle="Editeaza produsul din meniu",a.menu={},a.dish={},a.errors={},a.isFocusOnName=!a.isEditMode,a.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},a.$routerOnActivate=function(e,t){u=e.params.menuId,s=e.params.dishId,c()},a.update=function(t){var e,n;if(e=a,n=t,i.setAllFildsAsValid(n),i.required50(e,n,"dish","name"),i.required50(e,n,"dish","category"),t.$invalid)return!1;r.update(a.menu).then(function(e){a.goBack()}).catch(function(e){e.data.errors?i.updateValidity(a,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},a.goBack=function(){t.history.back()}}]})}(),angular.module("celebrate-taste").component("menuList",{templateUrl:"app/menu/menuList.html",controllerAs:"vm",controller:["$location","$window","menuService","modalService","helperService","toastr","$uibModal",function(e,t,r,i,o,n,a){var c=this;function u(){r.getActiveMenus().then(function(e){c.menus=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}c.$onInit=function(){c.pageTitle="Meniuri",c.menus=[],c.errors={},u()},c.create=function(e){var t={menuDate:e};r.create(t).then(function(e){c.refresh()}).catch(function(e){alert(JSON.stringify(e.data,null,4))})},c.delete=function(t){var e={bodyDetails:"Meniul de "+c.friendlyDate(t.menuDate)};i.confirm(e).then(function(e){r.delete(t._id).then(function(){_.remove(c.menus,{_id:t._id})}).catch(function(e){c.errors=JSON.stringify(e.data,null,4),alert(c.errors)})},function(){})},c.filterBySearch=function(e){var t=!1;return c.search?(new RegExp(c.search,"i").test(e.name)||new RegExp(c.search,"i").test(e.email))&&(t=!0):t=!0,t},c.refresh=function(){u()},c.goBack=function(){t.history.back()},c.friendlyDate=function(e){return o.getStringFromString(e)},c.deleteDishFromMenu=function(t,n){var e={bodyDetails:t.name};i.confirm(e).then(function(e){_.remove(n.dishes,{_id:t._id}),r.update(n).then(function(e){c.refresh()}).catch(function(e){alert(JSON.stringify(e.data,null,4))})})},c.openCreateMenu=function(){var e=_.chain(c.menus).sortBy("menuDate").last().value(),t=e&&e.menuDate||o.getStringFromDate(new Date),n=a.open({animation:!1,templateUrl:"app/menu/createMenuTpl.html",controller:"createMenuTplController",resolve:{dataToModal:function(){return t}}});n.result.then(function(e){var t=o.getStringFromDate(e);c.create(t)},function(){})},c.showModal=function(e){var t={imageUrl:e.image.large};i.showImage(t).then(function(e){})}}]}),app.factory("menuService",["$http","helperService",function(n,t){var e={},r="/api/menus/";return e.create=function(e){return n.post(r,e)},e.getAll=function(){return n.get(r).then(function(e){return e.data})},e.getNextMenus=function(){return n.get(r+"nextMenus/").then(function(e){return e.data})},e.getActiveMenus=function(){var e=t.getStringFromDate(new Date);return n.get(r+"rpc/getActiveMenus?today="+e).then(function(e){return e.data})},e.getById=function(e){return n.get(r+encodeURIComponent(e)).then(function(e){return e.data})},e.getMenu=function(e){var t="?$filter=menuDate eq '"+e+"'";return n.get(r+t).then(function(e){return e.data})},e.update=function(e){return n.put(r,e)},e.delete=function(e){return n.delete(r+encodeURIComponent(e))},e}]),angular.module("celebrate-taste").component("lmNavbar",{templateUrl:"app/navbar/navbar.html",controllerAs:"vm",controller:["$http","userService","$location",function(e,t,n){var r=this;r.$onInit=function(){r.isCollapsed=!0,r.isLoggedIn=t.isLoggedIn,r.isAdmin=t.isAdmin,r.isPartnerOrAdmin=t.isPartnerOrAdmin,r.getCurrentUser=t.getCurrentUser},r.isActive=function(e){return e===n.path()}}]}),app.controller("nextMenusController",["$scope","$location","menuService","helperService",function(t,e,n,r){t.menus=[],t.errors={},t.friendlyDate=function(e){return r.getStringFromString(e)},n.getNextMenus().then(function(e){t.menus=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}]),app.controller("nextMenusItemController",["$scope","$route","menuService",function(t,n,e){t.menu={},t.dish={},e.getById(n.current.params.menuId).then(function(e){t.menu=e,t.dish=_.find(e.dishes,"_id",n.current.params.dishId)}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}]),app.controller("createOrderTplController",["$scope","$uibModalInstance","helperService","orderService","helperValidator","$q",function(r,t,i,o,a,c){r.errors={},r.order={date:new Date},r.minDate=new Date,r.create=function(e){(function(e,t){var n=c.defer();if(a.setAllFildsAsValid(t),a.requiredDate(e,t,"order","date"),t.$invalid)return n.resolve(),n.promise;return u(t).then(function(){n.resolve()}),n.promise})(r,e).then(function(){if(e.$invalid)return!1;r.order.date=i.getStringFromDate(r.order.date),o.create(r.order).then(function(e){t.close()}).catch(function(e){})})};var u=function(t){var n=c.defer(),e=i.getStringFromDate(r.order.date);return o.count("date",e).then(function(e){if(0<e){a.updateValidity(r,t,[{field:"date",msg:"Exista deja o comanda pentru aceasta data."}])}n.resolve()}).catch(function(e){alert(JSON.stringify(e,null,4)),n.reject()}),n.promise};r.cancel=function(){t.dismiss("cancel")},r.dateOptions={startingDay:1},r.isOpen=!1,r.open=function(){r.isOpen=!0}}]),angular.module("celebrate-taste").component("order",{templateUrl:"app/order/order.html",controllerAs:"vm",controller:["$route","$window","orderService","helperValidator","toastr","helperService",function(e,t,n,r,i,o){var a=this;function c(){n.getById(a.orderId).then(function(e){var t;a.order=e,a.dateAsShortString=(t=a.order.date,o.getObjFromString(t)).dateAsShortString}).catch(function(e){alert(JSON.stringify(e,null,4))})}a.$onInit=function(){},a.$routerOnActivate=function(e,t){a.orderId=e.params.id,c()},a.goBack=function(){t.history.back()}}]}),angular.module("celebrate-taste").component("orderList",{templateUrl:"app/order/orderList.html",controllerAs:"vm",controller:["$location","$window","orderService","modalService","toastr","helperService","$uibModal",function(e,t,r,i,n,o,a){var c=this;function u(){r.getAll().then(function(e){c.orders=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}c.$onInit=function(){c.pageTitle="Comenzi",c.orders=[],c.errors={},u()},c.openCreateOrder=function(){var e=a.open({animation:!1,templateUrl:"app/order/createOrderTpl.html",controller:"createOrderTplController"});e.result.then(function(){c.refresh()},function(){})},c.delete=function(t){var e={bodyDetails:t.name};i.confirm(e).then(function(e){r.delete(t._id).then(function(){_.remove(c.orders,{_id:t._id})}).catch(function(e){c.errors=JSON.stringify(e.data,null,4),alert(c.errors)})},function(){})},c.refresh=function(){u()},c.goBack=function(){t.history.back()},c.dt=function(e){return o.getObjFromString(e)},c.closeOrder=function(n){i.confirm({actionButtonText:"Finalizeaza",headerText:"Finalizare/Arhivare comanda",bodyTitle:"Esti sigur ca vrei sa finalizezi aceasta comanda?",bodyDetails:"Odata finalizata, comanda nu mai poate fi redeschisa!"}).then(function(e){r.closeOrder(n).then(function(e){var t=_.find(c.orders,{_id:n});t.summary=e,t.status="completed"}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})},function(){})},c.showEmployees=function(e,t){var n={closeButtonText:"Renunta",headerText:t,employees:e};i.show({animation:!1,templateUrl:"app/common/templates/showEmployees.html"},n).then(function(){},function(){})}}]}),app.factory("orderService",["$http",function(n){var e={},r="/api/orders/";return e.count=function(e,t){return n.get(r+"$count?$filter="+e+" eq '"+t+"'").then(function(e){return e.data})},e.getAllOpen=function(){return n.get(r+"?$filter=status eq 'open'").then(function(e){return e.data})},e.create=function(e){return n.post(r,e)},e.getAll=function(){return n.get(r).then(function(e){return e.data})},e.getById=function(e){return n.get(r+e).then(function(e){return e.data})},e.update=function(e){return n.put(r,e)},e.delete=function(e){return n.delete(r+e)},e.getEatSeriesList=function(e){return n.get(r+e+"/rpc/getEatSeriesList").then(function(e){return e.data})},e.getDeliverySummary=function(e,t){return n.get(r+e+"/rpc/getDeliverySummary/"+encodeURIComponent(t)).then(function(e){return e.data})},e.closeOrder=function(e){return n.post(r+e+"/rpc/closeOrder").then(function(e){return e.data})},e}]),angular.module("celebrate-taste").component("partnerOrderList",{templateUrl:"app/partnerOrder/partnerOrderList.html",controllerAs:"vm",controller:["$location","$window","partnerOrderService","modalService","toastr","helperService","$uibModal",function(e,t,n,r,i,o,a){var c=this;function u(){n.getAll().then(function(e){c.partnerOrders=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}c.$onInit=function(){c.pageTitle="Comenzi",c.partnerOrders=[],c.errors={},u()},c.showEmployees=function(e,t){var n={closeButtonText:"Renunta",headerText:t,employees:e};r.show({animation:!1,templateUrl:"app/common/templates/showEmployees.html"},n)},c.refresh=function(){u()},c.goBack=function(){t.history.back()},c.dt=function(e){return o.getObjFromString(e)}}]}),app.factory("partnerOrderService",["$http",function(n){var e={},r="/api/partnerOrders/";return e.count=function(e,t){return n.get(r+"$count?$filter="+e+" eq '"+t+"'").then(function(e){return e.data})},e.getAllOpen=function(){return n.get(r+"?$filter=status eq 'open'").then(function(e){return e.data})},e.create=function(e){return n.post(r,e)},e.getAll=function(){return n.get(r).then(function(e){return e.data})},e.getById=function(e){return n.get(r+e).then(function(e){return e.data})},e.update=function(e){return n.put(r,e)},e.delete=function(e){return n.delete(r+e)},e.getEatSeriesList=function(e){return n.get(r+e+"/rpc/getEatSeriesList").then(function(e){return e.data})},e.getDeliverySummary=function(e,t){return n.get(r+e+"/rpc/getDeliverySummary/"+encodeURIComponent(t)).then(function(e){return e.data})},e.closepartnerOrder=function(e){return n.post(r+e+"/rpc/closepartnerOrder").then(function(e){return e.data})},e}]),app.controller("partnerOrdersController",["$scope","$location","partnerOrderService","modalService","helperService","$uibModal",function(r,e,i,o,t,n){function a(){i.getAll().then(function(e){r.partnerOrders=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}r.partnerOrders=[],r.errors={},a(),r.delete=function(n){var e={bodyDetails:n.name};o.confirm(e).then(function(e){var t=0;for(t in r.partnerOrders)if(r.partnerOrders[t]._id===n._id)break;i.delete(n._id).then(function(){r.partnerOrders.splice(t,1)}).catch(function(e){r.errors=JSON.stringify(e.data,null,4),alert(r.errors)})})},r.openCreatepartnerOrder=function(){n.open({animation:!1,templateUrl:"app/partnerOrder/createpartnerOrderTpl.html",controller:"createpartnerOrderTplController"}).result.then(function(){r.refresh()},function(){})},r.refresh=function(){a()},r.dt=function(e){return t.getObjFromString(e)},r.closepartnerOrder=function(n){o.confirm({actionButtonText:"Finalizeaza",headerText:"Finalizare/Arhivare comanda",bodyTitle:"Esti sigur ca vrei sa finalizezi aceasta comanda?",bodyDetails:"Odata finalizata, comanda nu mai poate fi redeschisa!"}).then(function(e){i.closepartnerOrder(n).then(function(e){var t=_.find(r.partnerOrders,{_id:n});t.summary=e,t.status="completed"}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})})},r.showEmployees=function(e,t){var n={closeButtonText:"Renunta",headerText:t,employees:e};o.show({animation:!1,templateUrl:"app/common/templates/showEmployees.html"},n)}}]),function(){var e=angular.module("celebrate-taste");e.component("addPreferences",{templateUrl:"app/preference/addPreferences.html",controllerAs:"vm",controller:["$route","$window","preferenceService","helperValidator","customerEmployeeService","helperService","toastr","menuService","$scope",function(e,t,r,i,n,o,a,c,u){var d=this;d.$onInit=function(){d.preference={},d.errors={},d.pageTitle="Adauga preferinte",d.person={},d.customerEmployees=[],d.menus=[],d.nextEmployeePreferences=[],d.preferences=[]},d.$routerOnActivate=function(e,t){e.params.id,c.getActiveMenus().then(function(e){d.menus=e,d.menuIsReady=!0}).catch(function(e){alert(JSON.stringify(e,null,4))}),n.getAll().then(function(e){d.customerEmployees=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})},d.create=function(t){if(function(o,a){i.setAllFildsAsValid(a);o.preferencesHaveErrors=!1;o.preferences.some(function(e){if(!e.alreadyAdded){var t=e.option1.toUpperCase();if(1===t.length&&(!0,-1===e.availableForOption1.indexOf(t))){var n="input"+(2*e.rowIndex).toString();return a[n].$setValidity("myValidation",!1),o.errors.preferences="Ai introdus un cod invalid.",o.preferencesHaveErrors=!0}var r=e.option2.toUpperCase();if(1===r.length&&(!0,-1===e.availableForOption2.indexOf(r))){var i="input"+(2*e.rowIndex+1).toString();return a[i].$setValidity("myValidation",!1),o.errors.preferences="Ai introdus un cod invalid.",o.preferencesHaveErrors=!0}}}),o.preferencesHaveErrors}(d,t),t.$invalid)return!1;var n=[];d.preferences.forEach(function(e){if(!e.alreadyAdded&&(""!==e.option1||""!==e.option2)){var t={employeeName:d.person.selected.name,date:e.date};""!==e.option1&&(t.option1=e.option1.toUpperCase()),""!==e.option2&&(t.option2=e.option2.toUpperCase()),n.push(t)}}),0<n.length?r.createMany(n).then(function(e){d.person.selected=void 0,u.$broadcast("SetFocus"),a.success("Inregistrarea a fost adaugata!")}).catch(function(e){e.data.errors?i.updateValidity(d,t,e.data.errors):alert(JSON.stringify(e.data,null,4))}):alert("Nu ai adaugat nicio preferinta!")},d.selectEmployee=function(e,t){var n;d.preferencesHaveErrors=!1,n=e.name,r.getNextByEmployee(n).then(function(s){d.nextEmployeePreferences=s,d.preferences=[];var l=!0;d.menus.forEach(function(e,t){var n=_.find(s,{date:e.menuDate}),r=!!n,i=_.chain(e.dishes).filter({category:"1"}).map("option").uniq().sortBy().value(),o=_.chain(e.dishes).filter({category:"2"}).map("option").uniq().sortBy().value(),a=!1,c=!1;!r&&l&&(0<i.length?l=!(a=!0):0<o.length&&(l=!(c=!0)));var u={alreadyAdded:r,date:e.menuDate,option1:n?n.option1:"",option2:n?n.option2:"",availableForOption1:i,availableForOption2:o,isFocusOnOption1:a,isFocusOnOption2:c,rowIndex:t};d.preferences.push(u)})}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})},d.dt=function(e){return o.getObjFromString(e)},d.goBack=function(){t.history.back()}}]}),e.directive("moveNextOnMaxlength",function(){return{restrict:"A",link:function(e,i){i.on("input",function(e){if(i.val().length==i.attr("maxlength")){for(var t=i[0].id,n=parseInt(t)+1,r=angular.element(document.getElementById(n.toString()));r.length&&r[0].disabled;)t=r[0].id,n=parseInt(t)+1,r=angular.element(document.getElementById(n.toString()));r.length&&r[0].focus()}})}}})}(),function(){var a;angular.module("celebrate-taste").component("preference",{templateUrl:"app/preference/preference.html",controllerAs:"vm",controller:["$route","$window","preferenceService","helperValidator","toastr",function(e,t,n,r,i){var o=this;o.$onInit=function(){o.preference={},o.errors={},o.pageTitle="Editeaza preferinte"},o.$routerOnActivate=function(e,t){a=e.params.id,n.getById(a).then(function(e){o.preference=e}).catch(function(e){alert(JSON.stringify(e,null,4))})},o.update=function(t){n.update(o.preference).then(function(e){o.goBack()}).catch(function(e){e.data.errors?r.updateValidity(o,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},o.goBack=function(){t.history.back()}}]})}(),app.controller("preferenceController",["$scope","$route","preferenceService","$location","helperValidator","menuService","customerEmployeeService","helperService","toastr",function(d,e,r,n,i,t,o,a,c){d.isEditMode=e.current.isEditMode,d.isFocusOnName=!d.isEditMode,d.errors={},d.preference={},d.person={},d.customerEmployees=[],d.menus=[],d.nextEmployeePreferences=[],d.selectEmployee=function(e,t){var n;d.preferencesHaveErrors=!1,n=e.name,r.getNextByEmployee(n).then(function(s){d.nextEmployeePreferences=s,d.preferences=[];var l=!0;d.menus.forEach(function(e,t){var n=_.find(s,{date:e.menuDate}),r=!!n,i=_.chain(e.dishes).filter({category:"1"}).map("option").uniq().sortBy().value(),o=_.chain(e.dishes).filter({category:"2"}).map("option").uniq().sortBy().value(),a=!1,c=!1;!r&&l&&(0<i.length?l=!(a=!0):0<o.length&&(l=!(c=!0)));var u={alreadyAdded:r,date:e.menuDate,option1:n?n.option1:"",option2:n?n.option2:"",availableForOption1:i,availableForOption2:o,isFocusOnOption1:a,isFocusOnOption2:c,rowIndex:t};d.preferences.push(u)})}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})},d.isEditMode?r.getById(e.current.params.id).then(function(e){d.preference=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))}):(t.getActiveMenus().then(function(e){d.menus=e,d.menuIsReady=!0}).catch(function(e){alert(JSON.stringify(e,null,4))}),o.getAll().then(function(e){d.customerEmployees=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})),d.preferences=[],d.create=function(t){if(function(o,a){i.setAllFildsAsValid(a);var c=o.preferencesHaveErrors=!1;o.preferences.some(function(e){if(!e.alreadyAdded){var t=e.option1.toUpperCase();if(1===t.length&&(c=!0,-1===e.availableForOption1.indexOf(t))){var n="input"+(2*e.rowIndex).toString();return a[n].$setValidity("myValidation",!1),o.errors.preferences="Ai introdus un cod invalid.",o.preferencesHaveErrors=!0}var r=e.option2.toUpperCase();if(1===r.length&&(c=!0,-1===e.availableForOption2.indexOf(r))){var i="input"+(2*e.rowIndex+1).toString();return a[i].$setValidity("myValidation",!1),o.errors.preferences="Ai introdus un cod invalid.",o.preferencesHaveErrors=!0}}}),c||(o.form.$invalid=!0,o.errors.preferences="Nu ai adaugat optiuni noi.",o.preferencesHaveErrors=!0);o.preferencesHaveErrors}(d,t),t.$invalid)return!1;var n=[];d.preferences.forEach(function(e){if(!e.alreadyAdded&&(""!==e.option1||""!==e.option2)){var t={employeeName:d.person.selected.name,date:e.date};""!==e.option1&&(t.option1=e.option1.toUpperCase()),""!==e.option2&&(t.option2=e.option2.toUpperCase()),n.push(t)}}),r.createMany(n).then(function(e){c.success("Inregistrarea a fost adaugata!"),d.person.selected=void 0,d.$broadcast("SetFocus")}).catch(function(e){e.data.errors?i.updateValidity(d,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},d.update=function(t){r.update(d.preference).then(function(e){n.path("/admin/preferences")}).catch(function(e){e.data.errors?i.updateValidity(d,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},d.dt=function(e){return a.getObjFromString(e)}}]),app.directive("moveNextOnMaxlength",function(){return{restrict:"A",link:function(e,i){i.on("input",function(e){if(i.val().length==i.attr("maxlength")){for(var t=i[0].id,n=parseInt(t)+1,r=angular.element(document.getElementById(n.toString()));r.length&&r[0].disabled;)t=r[0].id,n=parseInt(t)+1,r=angular.element(document.getElementById(n.toString()));r.length&&r[0].focus()}})}}}),angular.module("celebrate-taste").component("preferenceList",{templateUrl:"app/preference/preferenceList.html",controllerAs:"vm",controller:["$location","$window","preferenceService","modalService","toastr","helperService",function(n,e,r,i,t,o){var a=this;function c(){r.getNextDates().then(function(e){a.nextDates=e;var t=n.search();t.date?a.selectedDate=t.date:0===a.nextDates.length?a.nextDates.push("Nu exista date"):a.selectedDate=a.nextDates[0],a.selectedDate&&u(a.selectedDate),t.onlyFromOnline?a.obj.onlyFromOnline=!0:a.obj.onlyFromOnline=!1}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}function u(e){r.getByDate(e).then(function(e){a.preferences=e,a.preferences.forEach(function(e){e.option1||(e.option1="-");var t=_.find(a.option1Summary,{key:e.option1});t?t.total+=1:a.option1Summary.push({key:e.option1,total:1})}),a.preferences.forEach(function(e){e.option2||(e.option2="-");var t=_.find(a.option2Summary,{key:e.option2});t?t.total+=1:a.option2Summary.push({key:e.option2,total:1})})}).catch(function(e){alert(JSON.stringify(e,null,4))})}a.$onInit=function(){a.pageTitle="Preferinte",a.preferences=[],a.errors={},a.nextDates=[],a.obj={},a.obj.onlyFromOnline=!1,a.option1Summary=[],a.option2Summary=[],c()},a.delete=function(t){var e={bodyDetails:t.name};i.confirm(e).then(function(e){r.delete(t._id).then(function(){_.remove(a.preferences,{_id:t._id})}).catch(function(e){a.errors=JSON.stringify(e.data,null,4),alert(a.errors)})},function(){})},a.filterByOnline=function(e){return!a.obj.onlyFromOnline||e.fromOnline},a.refresh=function(){c()},a.goBack=function(){e.history.back()},a.dt=function(e){return o.getObjFromString(e)},a.selectOnlyFromOnline=function(){!1===a.obj.onlyFromOnline?n.search("onlyFromOnline",null):n.search("onlyFromOnline",!0)},a.selectDate=function(e){"Nu exista date"!==e&&(a.selectedDate=e,n.search("date",e),u(a.selectedDate))}}]}),app.factory("preferenceService",["$http","helperService",function(i,o){var e={},a="/api/preferences/";return e.create=function(e){return i.post(a,e)},e.createMany=function(e){return i.post(a+"rpc/createMany",e)},e.getByDate=function(e){return i.get(a+"?$filter=date eq '"+e+"'").then(function(e){return e.data})},e.getById=function(e){return i.get(a+encodeURIComponent(e)).then(function(e){return e.data})},e.getNextDates=function(){var e=o.getStringFromDate(new Date);return i.get(a+"rpc/getNextDates?today="+e).then(function(e){return e.data})},e.getNextByEmployee=function(e){var t=new Date,n=new Date(t.setDate(t.getDate()-1)),r="?$filter=employeeName eq '"+e+"' and date gt '"+o.getStringFromDate(n)+"'";return i.get(a+r).then(function(e){return e.data})},e.getByEmployeeAndDate=function(e,t){var n="?$filter=employeeName eq '"+e+"' and date eq '"+t+"'";return i.get(a+n).then(function(e){return e.data})},e.update=function(e){return i.put(a,e)},e.delete=function(e){return i.delete(a+encodeURIComponent(e))},e}]),angular.module("celebrate-taste").component("reviewList",{templateUrl:"app/review/reviewList.html",controllerAs:"vm",controller:["$location","$window","reviewService","modalService",function(e,t,n,r){var i=this;function o(){n.getAll().then(function(e){i.reviews=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}i.$onInit=function(){i.pageTitle="Feedback clienti",i.reviews=[],i.errors={},o()},i.create=function(){e.path("/admin/reviews/create")},i.delete=function(t){var e={bodyDetails:t.name};r.confirm(e).then(function(e){n.delete(t._id).then(function(){_.remove(i.reviews,{_id:t._id})}).catch(function(e){i.errors=JSON.stringify(e.data,null,4),alert(i.errors)})})},i.filterBySearch=function(e){var t=!1;return i.search?(new RegExp(i.search,"i").test(e.dishName)||new RegExp(i.search,"i").test(e.createdBy))&&(t=!0):t=!0,t},i.refresh=function(){o()},i.goBack=function(){t.history.back()}}]}),app.factory("reviewService",["$http",function(n){var e={},r="/api/reviews/";return e.getByBadge=function(e){var t="?$filter=badgeCode eq '"+e+"' and isActive eq true";return n.get(r+t).then(function(e){return e.data})},e.create=function(e){return n.post(r,e)},e.getAll=function(){return n.get(r).then(function(e){return e.data})},e.getById=function(e){return n.get(r+encodeURIComponent(e)).then(function(e){return e.data})},e.update=function(e){return n.put(r,e)},e.delete=function(e){return n.delete(r+encodeURIComponent(e))},e}]),app.controller("todayMenuController",["$scope","menuService","helperService",function(t,e,n){t.todaysMenu={},t.today=n.getFriendlyDate(new Date);var r;r=t.today.ymd,e.getMenu(r).then(function(e){t.todaysMenu=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}]),function(){var c;angular.module("celebrate-taste").component("user",{templateUrl:"app/user/user.html",controllerAs:"vm",controller:["$route","$window","userService","helperValidator","toastr",function(e,t,n,r,i){var o=this;function a(e,t){r.setAllFildsAsValid(t),r.required50(e,t,"user","name"),r.requiredEmail(e,t,"user","email")}o.$onInit=function(){o.user={},o.errors={},o.isFocusOnName=!o.isEditMode,o.isActiveOptions=[{id:!0,name:"Da"},{id:!1,name:"Nu"}]},o.$routerOnActivate=function(e,t){c=e.params.id,o.isEditMode="edit"===e.routeData.data.action,o.isEditMode?(o.pageTitle="Editeaza utilizator",n.getById(c).then(function(e){o.user=e}).catch(function(e){alert(JSON.stringify(e,null,4))})):o.pageTitle="Adauga utilizator"},o.create=function(t){if(a(o,t),t.$invalid)return!1;n.create(o.user).then(function(e){o.goBack()}).catch(function(e){e.data.errors?r.updateValidity(o,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},o.update=function(t){if(a(o,t),t.$invalid)return!1;n.update(o.user).then(function(e){o.goBack()}).catch(function(e){e.data.errors?r.updateValidity(o,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},o.goBack=function(){t.history.back()}}]})}(),angular.module("celebrate-taste").component("userList",{templateUrl:"app/user/userList.html",controllerAs:"vm",controller:["$location","$window","userService","modalService","toastr",function(e,t,n,r,i){var o=this;function a(){n.getAll().then(function(e){e.forEach(function(e){e.activationToken?e.status="asteapta activare":e.status="activ"}),o.users=e}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}o.$onInit=function(){o.pageTitle="Utilizatori",o.users=[],o.errors={},a()},o.create=function(){e.path("/admin/users/create")},o.delete=function(t){var e={bodyDetails:t.name};r.confirm(e).then(function(e){n.delete(t._id).then(function(){_.remove(o.users,{_id:t._id}),n.getCurrentUser().name===t.name&&n.logout()}).catch(function(e){o.errors=JSON.stringify(e.data,null,4),alert(o.errors)})},function(){})},o.filterBySearch=function(e){var t=!1;return o.search?(new RegExp(o.search,"i").test(e.name)||new RegExp(o.search,"i").test(e.email))&&(t=!0):t=!0,t},o.refresh=function(){a()},o.goBack=function(){t.history.back()}}]}),app.factory("userService",["$http","$cookies","$q","$window",function(i,e,o,t){var n={},r="/api/users/";n.create=function(e){return i.post(r,e)},n.getAll=function(){return i.get(r).then(function(e){return e.data})},n.getById=function(e){return i.get(r+encodeURIComponent(e)).then(function(e){return e.data})},n.update=function(e){return i.put(r,e)},n.delete=function(e){return i.delete(r+encodeURIComponent(e))};var a={};return e.get("user")&&(a=angular.fromJson(e.get("user"))),n.changePassword=function(e,t){return i.put(r+"me/changepassword",{oldPassword:e,newPassword:t})},n.login=function(e,t){var n=t||angular.noop,r=o.defer();return i.post("/login",{email:e.email,password:e.password}).success(function(e){return a=e,r.resolve(e),n()}).error(function(e){return this.logout(),r.reject(e),n(e)}.bind(this)),r.promise},n.logout=function(){t.location.href="/logout"},n.getCurrentUser=function(){return a},n.isLoggedIn=function(){return a.hasOwnProperty("role")},n.isAdmin=function(){return"admin"===a.role},n.isPartnerOrAdmin=function(){return"partner"===a.role||"admin"===a.role},n}]),app.directive("lmCollapse",[function(){return{link:function(e,t,n){e.$watch(n.lmCollapse,function(e){e?(t.css({height:"0"}),t.removeClass("collapsing").addClass("collapse")):t.removeClass("collapsing").addClass("collapse in").css({height:"auto"})})}}}]),app.directive("lmFocus",["$timeout",function(i){return{restrict:"A",link:function(t,n,r){"true"===r.lmFocus||""===r.lmFocus?i(function(){n[0].focus()},0):(t.$watch(r.lmFocus,function(e,t){i(function(){e&&n[0].focus()},0)}),n.bind("blur",function(e){i(function(){t.$apply(r.lmFocus+"=false")},0)}),n.bind("focus",function(e){i(function(){t.$apply(r.lmFocus+"=true")},0)}))}}}]),app.directive("myMatch",function(){return{require:"ngModel",restrict:"A",scope:{match:"="},link:function(e,t,n,r){e.$watch(function(){return r.$pristine&&angular.isUndefined(r.$modelValue)||e.match===r.$modelValue},function(e){r.$setValidity("match",e)})}}}),app.directive("stopEmailValidation",function(){var i=/./;return{require:"ngModel",restrict:"",priority:2,link:function(e,t,n,r){r&&r.$validators.email&&(r.$validators.email=function(e){return r.$isEmpty(e)||i.test(e)})}}}),angular.module("ngLocale",[],["$provide",function(e){var i="one",o="few",a="other";e.value("$locale",{DATETIME_FORMATS:{AMPMS:["a.m.","p.m."],DAY:["duminic","luni","mari","miercuri","joi","vineri","smbt"],ERANAMES:["nainte de Hristos","dup Hristos"],ERAS:[".Hr.","d.Hr."],FIRSTDAYOFWEEK:0,MONTH:["ianuarie","februarie","martie","aprilie","mai","iunie","iulie","august","septembrie","octombrie","noiembrie","decembrie"],SHORTDAY:["Du","Lu","Ma","Mi","Jo","Vi","S"],SHORTMONTH:["ian.","feb.","mar.","apr.","mai","iun.","iul.","aug.","sept.","oct.","nov.","dec."],STANDALONEMONTH:["ianuarie","februarie","martie","aprilie","mai","iunie","iulie","august","septembrie","octombrie","noiembrie","decembrie"],WEEKENDRANGE:[5,6],fullDate:"EEEE, d MMMM y",longDate:"d MMMM y",medium:"d MMM y HH:mm:ss",mediumDate:"d MMM y",mediumTime:"HH:mm:ss",short:"dd.MM.y HH:mm",shortDate:"dd.MM.y",shortTime:"HH:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"RON",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""}]},id:"ro-ro",localeID:"ro_RO",pluralCat:function(e,t){var n=0|e,r=function(e,t){var n,r,i=t;void 0===i&&(i=Math.min((n=e,-1==(r=(n+="").indexOf("."))?0:n.length-r-1),3));var o=Math.pow(10,i);return{v:i,f:(e*o|0)%o}}(e,t);return 1==n&&0==r.v?i:0!=r.v||0==e||1!=e&&1<=e%100&&e%100<=19?o:a}})}]),app.factory("authInterceptor",["$rootScope","$q","$cookies","$location","$window",function(e,t,n,r,i){return{responseError:function(e){return 401===e.status&&r.path("/admin/login"),t.reject(e)}}}]),app.factory("helperService",[function(){var e={getRoDay:function(e){return 0===e?"Duminica":1===e?"Luni":2===e?"Marti":3===e?"Miercuri":4===e?"Joi":5===e?"Vineri":6===e?"Sambata":void 0},getRoShortDay:function(e){return 0===e?"Du":1===e?"Lu":2===e?"Ma":3===e?"Mi":4===e?"Jo":5===e?"Vi":6===e?"Sa":void 0},getRoMonth:function(e){return 0===e?"Ianuarie":1===e?"Februari":2===e?"Martie":3===e?"Aprilie":4===e?"Mai":5===e?"Iunie":6===e?"Iulie":7===e?"August":8===e?"Septembrie":9===e?"Octombrie":10===e?"Noiembrie":11===e?"Decembrie":void 0},getRoShortMonth:function(e){return 0===e?"Ian.":1===e?"Feb.":2===e?"Mar.":3===e?"Apr.":4===e?"Mai":5===e?"Iun.":6===e?"Iul.":7===e?"Aug.":8===e?"Sep.":9===e?"Oct.":10===e?"Nov.":11===e?"Dec.":void 0},getFriendlyDate:function(e){var t=e.getDate(),n=e.getMonth()+1,r=e.getFullYear(),i=t;i<10&&(i="0"+t);var o=n;return o<10&&(o="0"+n),{dayAsString:this.getRoDay(e.getDay()),dayAsShortString:this.getRoShortDay(e.getDay()),dayOfMonth:i,monthAsString:this.getRoMonth(n-1),monthAsShortString:this.getRoShortMonth(n-1),year:r,ymd:r+"-"+o+"-"+i,dmy:i+"."+o+"."+r}},getDateFromString:function(e){var t=e.split("-"),n=t[1];return"0"===n[0]&&(n=n.charAt(1)),n-=1,new Date(t[0],n,t[2])},getStringFromString:function(e){var t=this.getDateFromString(e),n=this.getFriendlyDate(t);return n.dayAsString+", "+n.dayOfMonth+" "+n.monthAsString+" "+n.year},getObjFromString:function(e){var t=this.getDateFromString(e),n=this.getFriendlyDate(t);return{dayAsString:n.dayAsString,dayAsShortString:n.dayAsShortString,dayOfMonth:n.dayOfMonth,monthAsString:n.monthAsString,monthAsShortString:n.monthAsShortString,year:n.year,dateAsShortString:n.dayOfMonth+" "+n.monthAsShortString+" "+n.year}},getStringFromDate:function(e){return this.getFriendlyDate(e).ymd},makeId:function(e){for(var t="",n="abcdef0123456789",r=0;r<e;r+=1)t+=n.charAt(Math.floor(Math.random()*n.length));return t}};return e}]),app.service("helperValidator",[function(){function o(e,t,n,r){t[n].$setValidity("myValidation",!1),e.errors[n]=r}function a(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function c(e){return void 0===e||""===e||null===e}this.required=function(e,t,n,r){e[n][r]=e[n][r]||"",c(e[n][r])&&o(e,t,r,"Acest camp este obligatoriu.")},this.required50=function(e,t,n,r){e[n][r]=e[n][r]||"";var i=e[n][r];c(i)?o(e,t,r,"Acest camp este obligatoriu."):50<i.length&&o(e,t,r,"Maxim 50 caractere.")},this.requiredEmail=function(e,t,n,r){var i=e[n][r];c(i)?o(e,t,r,"Acest camp este obligatoriu."):a(i)?50<i.length&&o(e,t,r,"Maxim 50 caractere."):o(e,t,r,"Adresa de email invalida.")},this.optionalEmail=function(e,t,n,r){var i=e[n][r];i&&0<i.length&&!a(i)?o(e,t,r,"Adresa de email invalida."):i&&50<i.length&&o(e,t,r,"Maxim 50 caractere.")},this.optional50=function(e,t,n,r){var i=e[n][r];i&&50<i.length&&o(e,t,r,"Maxim 50 caractere.")},this.requiredDate=function(e,t,n,r){var i=e[n][r];c(i)?o(e,t,r,"Acest camp este obligatoriu."):i instanceof Date==!1?o(e,t,r,"Data invalida."):50<i.length&&o(e,t,r,"Maxim 50 caractere.")},this.updateValidity=function(n,r,e){angular.forEach(e,function(e,t){o(n,r,e.field,e.msg)})},this.setAllFildsAsValid=function(e){angular.forEach(e,function(n,e){0!==e.indexOf("$")&&angular.forEach(n.$error,function(e,t){n.$setValidity(t,null)})})}}]),app.service("modalService",["$uibModal",function(i){this.show=function(e,t){var n={},r={};return angular.extend(n,e),angular.extend(r,t),n.controller||(n.controller=["$scope","$uibModalInstance",function(e,t){e.modalOptions=r,e.modalOptions.ok=function(e){t.close(e)},e.modalOptions.close=function(e){t.dismiss("cancel")}}]),i.open(n).result},this.confirm=function(e){var t={closeButtonText:"Renunta",actionButtonText:"Sterge",headerText:"Sterge",bodyTitle:"Esti sigur ca vrei sa stergi aceasta inregistrare?",bodyDetails:""};return angular.extend(t,e),this.show({animation:!1,templateUrl:"app/common/templates/confirm.html"},t)},this.showImage=function(e){return this.show({animation:!1,size:"lg",templateUrl:"app/common/templates/showImage.html"},e)}}]),angular.module("celebrate-taste").component("orderLine",{templateUrl:"app/order/orderLine/orderLine.html",controllerAs:"vm",controller:["$route","$window","$location","orderLineService","helperValidator","toastr","$q","preferenceService","customerEmployeeService","helperService",function(e,t,n,r,i,o,a,c,u,s){var l,d,f=this,p={},m=n.search();function g(e,t){var n="orderLine";i.setAllFildsAsValid(t),i.required50(e,t,n,"employeeName"),i.required50(e,t,n,"eatSeries")}function h(e){return s.getObjFromString(e)}function v(e,t){f.orderLine.option1&&(f.orderLine.option1=f.orderLine.option1.toUpperCase()),f.orderLine.option2&&(f.orderLine.option2=f.orderLine.option2.toUpperCase())}f.$onInit=function(){f.orderLine={},f.errors={},f.isFocusOnName=!f.isEditMode,f.obj={},f.customerEmployees=[],f.eatSeriesList=[{name:"Seria 1"},{name:"Seria 2"},{name:"Seria 3"}],l=u.getAll().then(function(e){f.customerEmployees=e}).catch(function(e){alert(JSON.stringify(e,null,4))})},f.$routerOnActivate=function(e,t){f.orderId=e.params.id,f.orderLineId=e.params.id2,f.isEditMode="edit"===e.routeData.data.action,f.isEditMode?(f.pageTitle="Editeaza linia din comanda",d=r.getById(f.orderLineId).then(function(e){(f.orderLine=e).orderDate&&(f.orderDateAsString=h(e.orderDate).dateAsShortString),c.getByEmployeeAndDate(e.employeeName,e.orderDate).then(function(e){1===e.length&&(f.orderLine.option1=e[0].option1,f.orderLine.option2=e[0].option2,p=e[0])})}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))}),a.all([l,d]).then(function(e){f.obj.selectedEmployee=_.find(f.customerEmployees,{name:f.orderLine.employeeName})},function(e){alert("Failed: "+e)})):(f.pageTitle="Adauga o line la comanda",m.orderDate&&(f.orderLine.orderDate=m.orderDate,f.orderLine.orderId=f.orderId,f.orderDateAsString=h(m.orderDate).dateAsShortString))},f.create=function(t){if(g(f,t),t.$invalid)return!1;v(f.orderLine.option1,f.orderLine.option2),p&&p.option1&&f.orderLine.option1&&f.orderLine.option1.toLowerCase()===p.option1.toLowerCase()&&(f.orderLine.fromOwnerOpt1=!0),p&&p.option2&&f.orderLine.option2&&f.orderLine.option2.toLowerCase()===p.option2.toLowerCase()&&(f.orderLine.fromOwnerOpt2=!0),r.create(f.orderLine).then(function(e){n.path("/admin/orders/"+f.orderId)}).catch(function(e){e.data.errors?i.updateValidity(f,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},f.update=function(t){if(g(f,t),t.$invalid)return!1;v(f.orderLine.option1,f.orderLine.option2),p&&p.option1&&f.orderLine.option1&&f.orderLine.option1.toLowerCase()===p.option1.toLowerCase()?f.orderLine.fromOwnerOpt1=!0:delete f.orderLine.fromOwnerOpt1,p&&p.option2&&f.orderLine.option2&&f.orderLine.option2.toLowerCase()===p.option2.toLowerCase()?f.orderLine.fromOwnerOpt2=!0:delete f.orderLine.fromOwnerOpt2,r.update(f.orderLine).then(function(e){n.path("/admin/orders/"+f.orderId)}).catch(function(e){e.data.errors?i.updateValidity(f,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},f.selectEmployee=function(e,t){f.orderLine.employeeName=f.obj.selectedEmployee.name,c.getByEmployeeAndDate(f.orderLine.employeeName,f.orderLine.orderDate).then(function(e){1===e.length?(f.orderLine.option1=e[0].option1,f.orderLine.option2=e[0].option2,p=e[0]):(f.orderLine.option1=void 0,f.orderLine.option2=void 0)}).catch(function(e){alert(JSON.stringify(e,null,4))})},f.goBack=function(){t.history.back()}}]}),angular.module("celebrate-taste").component("orderLineImport",{templateUrl:"app/order/orderLine/orderLineImport.html",controllerAs:"vm",controller:["$route","$window","$location","orderLineService","helperValidator","toastr","helperService",function(e,t,i,o,a,n,r){var c=this,u=i.search();c.$onInit=function(){c.user={},c.errors={},c.importData={},c.eatSeriesList=[{name:"Seria 1"},{name:"Seria 2"},{name:"Seria 3"}],c.pageTitle="Importa comanda"},c.$routerOnActivate=function(e,t){var n;c.orderId=e.params.id,u.orderDate&&(c.importData.orderDate=u.orderDate,c.importData.orderId=c.orderId,c.orderDateAsString=(n=u.orderDate,r.getObjFromString(n)).dateAsShortString)},c.create=function(t){var e,n,r;if(e=c,n=t,r="importData",a.setAllFildsAsValid(n),a.required(e,n,r,"employeesName"),a.required50(e,n,r,"eatSeries"),t.$invalid)return!1;o.import(c.importData).then(function(e){i.path("/admin/orders/"+c.orderId)}).catch(function(e){e.data.errors?a.updateValidity(c,t,e.data.errors):alert(JSON.stringify(e.data,null,4))})},c.goBack=function(){t.history.back()}}]}),angular.module("celebrate-taste").component("orderLineList",{bindings:{orderId:"<",orderDate:"<"},templateUrl:"app/order/orderLine/orderLineList.html",controllerAs:"vm",controller:["$location","$window","orderLineService","modalService","toastr",function(n,e,r,i,t){var o=this;function a(){r.getAllWithBadgeInfo(o.orderId).then(function(e){o.orderLines=e,o.eatSeriesList=_.chain(o.orderLines).map("eatSeries").uniq().sortBy().value();var t=n.search();t.eatSeries?o.selectedEatSeries=t.eatSeries:o.selectedEatSeries="Toate seriile",t.preference?o.selectedPreference=t.preference:o.selectedPreference="Toate pref.",t.onlyNoBadges?o.obj.onlyNoBadges=!0:o.obj.onlyNoBadges=!1}).catch(function(e){401!==e.status&&alert(JSON.stringify(e,null,4))})}o.$onInit=function(){o.pageTitle="Utilizatori",o.orderLines=[],o.errors={},o.preferences=["A","B","C","D"],o.obj={},o.obj.onlyNoBadges=!1,a()},o.create=function(){n.path("/admin/orders/"+o.orderId+"/orderLines/create"),n.search("orderDate",o.orderDate)},o.import=function(){n.path("/admin/orders/"+o.orderId+"/orderLines/import"),n.search("orderDate",o.orderDate)},o.delete=function(t){var e={bodyDetails:"Comanda pentru "+t.employeeName};i.confirm(e).then(function(e){r.delete(t._id).then(function(){_.remove(o.orderLines,{_id:t._id})}).catch(function(e){o.errors=JSON.stringify(e.data,null,4),alert(o.errors)})},function(){})},o.filterBySearch=function(e){var t=!1;return o.search?(new RegExp(o.search,"i").test(e.name)||new RegExp(o.search,"i").test(e.email))&&(t=!0):t=!0,t},o.refresh=function(){a()},o.goBack=function(){e.history.back()},o.preferencesFilter=function(e){return"Toate pref."===o.selectedPreference||("A"===o.selectedPreference||"B"===o.selectedPreference?e.option1===o.selectedPreference:"C"===o.selectedPreference||"D"===o.selectedPreference?e.option2===o.selectedPreference:"Fara pref."===o.selectedPreference?!(e.option1&&e.option2):void 0)},o.eatSeriesFilter=function(e){return"Toate seriile"===o.selectedEatSeries||e.eatSeries===o.selectedEatSeries},o.badgesFilter=function(e){return!o.obj.onlyNoBadges||!e.badgeCode},o.selectOnlyNoBadges=function(){!1===o.obj.onlyNoBadges?(o.obj.onlyNoBadges=!0,n.search("onlyNoBadges",null)):(o.obj.onlyNoBadges=!1,n.search("onlyNoBadges",!0))},o.selectEatSeries=function(e){"Toate seriile"===e?(o.selectedEatSeries="Toate seriile",n.search("eatSeries",null)):(o.selectedEatSeries=e,n.search("eatSeries",e))},o.selectPreference=function(e){"Toate pref."===e?(o.selectedPreference="Toate pref.",n.search("preference",null)):(o.selectedPreference=e,n.search("preference",e))}}]}),app.factory("orderLineService",["$http",function(i){var e={},o="/api/orderLines/";return e.getAll=function(e){var t="?$filter=orderId eq '"+e+"'";return i.get(o+"/getAllWithBadgeInfo"+t).then(function(e){return e.data})},e.getAllWithBadgeInfo=function(e){var t="?$filter=orderId eq '"+e+"'";return i.get(o+"/getAllWithBadgeInfo"+t).then(function(e){return e.data})},e.getEatSeriesDetails=function(e,t){var n="?$filter=orderId eq '"+e+"' and eatSeries eq '"+t+"'";return i.get(o+n).then(function(e){return e.data})},e.getOrderLinesByBadge=function(e,t){var n="?$filter=orderId eq '"+e+"' and badgeCode eq '"+encodeURIComponent(t)+"'";return i.get(o+n).then(function(e){return e.data})},e.getOrderLinesByEmployeeName=function(e,t){var n="?$filter=orderId eq '"+e+"' and employeeName eq '"+encodeURIComponent(t)+"'";return i.get(o+n).then(function(e){return e.data})},e.getOrderLinesBySeriesAndStatus=function(e,t,n){var r="?$filter=orderId eq '"+e+"' and eatSeries eq '"+t+"' and status eq '"+n+"'";return i.get(o+"/getAllWithBadgeInfo"+r).then(function(e){return e.data})},e.create=function(e){return i.post(o,e)},e.getById=function(e){return i.get(o+e).then(function(e){return e.data})},e.update=function(e){return i.put(o,e)},e.delete=function(e){return i.delete(o+e)},e.import=function(e){return i.post(o+"rpc/import",e)},e}]);